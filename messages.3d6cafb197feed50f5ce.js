"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[5871],{22941:(e,t,n)=>{n.d(t,{PO:()=>a,nj:()=>o,wt:()=>r});const i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a=62,o=(e,t)=>{if(10===t||![2,8,16,62].includes(t))return e;const n=[];let a,o,r,s,l;for(;e.length>0;){for(r="",a=0,o=0;o<e.length;o++)s=Number(e[o]),s=10*a+s,l=parseInt((s/t).toString(),10).toString(),"0"===l&&""===r||(r+=l),a=s%t;e=r,n.push(a)}return n.reverse().map((e=>i[e])).join("")},r=(e,t)=>{const n=[];let a,o,r,s,l;for(;e.length>0;){for(r="",a=0,o=0;o<e.length;o++)s=i.indexOf(e[o]),s=a*t+s,l=i[parseInt((s/10).toString(),10)],"0"===l&&""===r||(r+=l),a=s%10;e=r,n.push(a)}return n.reverse().join("")}},8585:(e,t,n)=>{n.d(t,{E:()=>d,y:()=>c});var i=n(40099),a=n(91498);let o=null,r=!1,s=!1;const l=()=>{var e,t,i,a;s&&r&&!o&&(e=void 0,t=void 0,a=function*(){const e=document.createElement("meta");e.setAttribute("http-equiv","origin-trial"),e.setAttribute("content","A7kLbZZF0sNV1Ncyw+UODqZel/HZ7YnQCMCa2Zz4XvT8uKV2Hp5maAbj5zsGZwUDmwt401QEhO8LNkGmAEh0hV4AAABoeyJvcmlnaW4iOiJodHRwczovL3Rpa3Rvay5jb206NDQzIiwiZmVhdHVyZSI6Im1zQWNxdWlzaXRpb25JbmZvIiwiZXhwaXJ5IjoxNzMzNTAzNjc5LCJpc1N1YmRvbWFpbiI6dHJ1ZX0="),document.head.appendChild(e);const t=(yield n.e(5269).then(n.bind(n,62779))).default;o=new t({ti:"187137935"})},new((i=void 0)||(i=Promise))((function(n,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((a=a.apply(e,t||[])).next())})))},d=()=>{(0,i.useEffect)((()=>{"msft"===(0,a.o7)()&&(s=!0),l()}),[])},c=()=>(0,i.useCallback)((e=>{r=e,l()}),[])},75774:(e,t,n)=>{n.d(t,{xw:()=>j});var i=n(40099),a=n(11060),o=n(60484),r=n(49057),s=n(71281),l=n(34871),d=n(4912),c=n(71777),u=n(36272),p=n(5441),g=n(6523),h=n(97086),m=n(2301),v=n(99129),_=n(55462),f=n(6752),b=n(25941),y=n(87864),C=n(35014),x=n(88920),k=n(243),S=n.n(k),M=n(40407),w=n(56203),I=n(93608),T=n(22941),R=n(73580),F=n(31974),D=n(42721),Y=n(88874),L=n(8585),E=n(26740),O=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};function A(){return O(this,void 0,void 0,(function*(){try{const{data:e}=yield S().app.getWid();return(0,T.wt)(e,T.PO)}catch(e){return}}))}function j(e,t,n,k,S,T,j){const{isRefactorGroup:U}=(0,x.pJ)();!function(e,t,n,o,s,l){var _;if(!e)return;const{pathname:b}=(0,a.zy)(),{abTestVersion:y}=null!==(_=(0,r.W)((()=>["abTestVersion"]),[]))&&void 0!==_?_:{},x=(0,g.wW)();(0,d.tF)((()=>{var e,n,i;return{page_name:t,enter_from:t,ui_type:s,vidab:null!==(e=null==y?void 0:y.versionName)&&void 0!==e?e:"",seo_vidab:(null!==(n=null==x?void 0:x.vidList)&&void 0!==n?n:[]).join(","),[D.ET]:(0,h.fU)()||null===(i=(0,Y.YI)(D.FR))||void 0===i?void 0:i[D.ET],page_category:l}}),[t,n,b,l]);const k=(0,d.ct)({eParams:o});(0,i.useEffect)((()=>{!(null==o?void 0:o.notReady)&&k()}),[k,n]),(0,d.LT)();const[{isMiniPlayerShowing:S},M]=(0,c.Sp)();(0,i.useEffect)((()=>{S&&M.closeMiniPlayer({playMode:null,enter_method:"click_navigation"})}),[b,n]);const w=(0,u.u4)();(0,i.useEffect)((()=>{w.initPortraitHub()}),[w]);const{isElectronApp:T}=(0,p.B)();(0,i.useEffect)((()=>{T&&function(){O(this,void 0,void 0,(function*(){if(T){const e=yield A();I.f.config({commonHeaderConfig:{"header.custom":{webapp_wid:e}}})}}))}()}),[]),(0,v.M$)(t),(0,L.E)(),(0,f.Ee)(t),(0,m.DQ)(t),(0,C.K)(t),(0,E.U)(t)}(U,e,t,n,S,j),function(e,t,n,x,k,S,T,j){var U;if(e)return;const{pathname:P}=(0,a.zy)();(0,d.LT)(),function(){const e=(0,R.Nj)(F.$F),t=(0,o.L$)((0,r.W)((()=>["user","wid","abTestVersion","webIdCreatedTime"]),[])),{wid:n,abTestVersion:a,webIdCreatedTime:d}=t,c=(0,s.qt)(a,"webapp_login_causal_inference"),u=(0,l.mv)(d);(0,i.useEffect)((()=>{if("v1"===c){const t=(0,M.ZC)(n||"",3,w.gb).toString();e.setEnterMethod("simulated"),e.setCloseable(!1),e.setPredictionPayload(t),e.loginNotify()}}),[u,c,e,n])}();const[{isMiniPlayerShowing:z},N]=(0,c.Sp)(),B=(0,u.u4)(),{isElectronApp:V}=(0,p.B)();(0,i.useEffect)((()=>{z&&N.closeMiniPlayer({playMode:null,enter_method:"click_navigation"})}),[P,n]),(0,i.useEffect)((()=>{B.initPortraitHub()}),[B]),(0,i.useEffect)((()=>{!function(){O(this,void 0,void 0,(function*(){if(V){const e=yield A();I.f.config({commonHeaderConfig:{"header.custom":{webapp_wid:e}}})}}))}()}),[]);const{abTestVersion:$}=null!==(U=(0,r.W)((()=>["abTestVersion"]),[]))&&void 0!==U?U:{},G=(0,g.wW)();(0,d.tF)((()=>{var e,n,i;return{page_name:t,enter_from:t,ui_type:S,vidab:null!==(e=null==$?void 0:$.versionName)&&void 0!==e?e:"",seo_vidab:(null!==(n=null==G?void 0:G.vidList)&&void 0!==n?n:[]).join(","),[D.ET]:(0,h.fU)()||null===(i=(0,Y.YI)(D.FR))||void 0===i?void 0:i[D.ET],page_category:j}}),[t,n,P,j]),(0,d.ym)(T),(0,m.DQ)(t);const H=(0,d.ct)({eParams:x});(0,i.useEffect)((()=>{!(null==x?void 0:x.notReady)&&H()}),[H,n]),(0,v.M$)(t),(0,_.rF)({pid:null!=k?k:t}),(0,L.E)(),(0,f.Ee)(t),(0,b.P)(),(0,y._U)(t),(0,C.K)(t),(0,E.U)(t)}(U,e,t,n,k,S,T,j)}},71098:(e,t,n)=>{n.d(t,{q:()=>r});var i=n(40099),a=n(88920),o=n(65444);const r=()=>{const{hasCommonVideoFirst:e}=(0,a.lP)();(0,i.useEffect)((()=>{e&&o.aY.updateCommonLoadEvent()}),[e])}},71893:(e,t,n)=>{n.r(t),n.d(t,{default:()=>dr});var i=n(2787),a=n(4474),o=n(40099),r=n(28591),s=n(11060),l=n(71615),d=n(80704),c=n(43108),u=n(88920),p=n(49057),g=n(25616),h=n(34012),m=n(29474),v=n(32125),_=n(77985),f=n(75774),b=n(42952),y=n(60484),C=n(51250),x=n(63581),k=n(72688),S=n(90159),M=n(85349),w=n(25754),I=n(92846),T=n(53737),R=n(33147),F=n(58305),D=n(48831),Y=n(24643),L=n(65329),E=n(62186),O=n(72153);const A=(0,E.default)("div",{target:"edkezb90"})((({theme:{colors:e}})=>({width:"100%",height:"100%",display:"flex",flexDirection:"column-reverse",backgroundColor:e.BGPrimary})),"label:DivEmojiSuggestionContainer;"),j=(0,E.default)("ul",{target:"edkezb91"})((({theme:{colors:e}})=>({listStyleType:"none",margin:0,padding:0,order:1,flex:"0 0 38px",borderTop:`1px solid ${e.LineSecondary}`,display:"flex",flexDirection:"row"})),"label:UlNavContainer;"),U=(0,E.default)("div",{target:"edkezb92"})((({theme:{colors:e}})=>({order:2,flex:"1 1 100%",overflowY:"scroll",scrollbarWidth:"none","::-webkit-scrollbar":{width:4},"::-webkit-scrollbar-track":{marginTop:8},"::-webkit-scrollbar-thumb":{borderRadius:2,backgroundColor:e.LineSecondary},":hover::-webkit-scrollbar-thumb":{backgroundColor:e.TextQuaternary}})),"label:DivPanelContainer;"),P=(0,E.default)("ul",{target:"edkezb93"})({listStyleType:"none",margin:0,padding:0,width:"100%",height:"100%",display:"flex",flexWrap:"wrap",userSelect:"none","&:focus-visible":{outlineStyle:"auto"}},"label:UlPanelList;"),z=(0,E.default)("li",{target:"edkezb94"})((({theme:e,theme:{colors:t,isDark:n},isActive:i})=>[(0,O.zy)({theme:e,color:"ConstBGInverse",typography:"H4"}),{listStyleType:"none",flex:"0 0 auto",width:40,height:40,lineHeight:"46px",margin:"5px 6px",cursor:"pointer",textAlign:"center",backgroundColor:i?n?t.BGTertiary2:t.BGInput:t.BGPrimary,borderRadius:8,userSelect:"none",":hover":{backgroundColor:t.BGInput}}]),"label:LiItem;"),N=(0,o.memo)((function({emojis:e,onSelect:t}){const n=(0,o.useRef)(-1),i=(0,o.useCallback)((e=>{const t=e.target;if("li"===t.nodeName.toLocaleLowerCase()){const e=t.getAttribute("data-index");n.current=e?Number(e):-1}}),[]),a=(0,o.useCallback)((i=>{(0,F.Gu)(i);const a=n.current;-1!==a&&t(e[a].emoji)}),[e,t]),r=(0,o.useCallback)((n=>i=>{13!==i.keyCode&&32!==i.keyCode||((0,F.Gu)(i),t(e[n].emoji))}),[e,t]);return(0,Y.jsx)(P,{id:"emoji-panel-container",onMouseOver:i,onClick:a,role:"tabpanel",tabIndex:0,children:e.map(((e,t)=>(0,Y.jsx)(z,{"data-index":t,isActive:!1,tabIndex:0,role:"button","aria-label":e.alias,onKeyDown:r(t),children:e.emoji},e.alias)))})})),B=[{name:"basic",data:L.A,iconIndex:11}],V=(0,o.memo)((function(e){const[t,n]=(0,o.useState)(0),i=(0,o.useCallback)((e=>{(0,F.Gu)(e);const t=e.target;if("li"===t.nodeName.toLocaleLowerCase()){const e=t.getAttribute("data-index");n(e?Number(e):0)}}),[]);return(0,Y.jsxs)(A,{id:"emoji-suggestion-container",children:[(0,Y.jsx)(j,{onClick:i,role:"tablist",children:B.map((({name:e,data:n,iconIndex:i},a)=>(0,Y.jsx)(z,{"data-index":a,isActive:a===t,role:"tab",tabIndex:0,"aria-selected":a===t,"aria-controls":"emoji-panel-container",children:n[i].emoji},e)))}),(0,Y.jsx)(U,{children:(0,Y.jsx)(N,{emojis:B[t].data,onSelect:e.onSelect},B[t].name)})]})}));var $=n(62413),G=n(95197);const H=(0,n(47236).Ay)({resolved:{},chunkName:()=>"editor",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!n.m[t]},importAsync:()=>Promise.all([n.e(2939),n.e(9187),n.e(8395),n.e(6008)]).then(n.bind(n,30267)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then((e=>(this.resolved[t]=!0,e)))},requireSync(e){const t=this.resolve(e);return n(t)},resolve:()=>30267}),q="webapp-dm-accepted-list",W="support_webapp_sharing_chat_page_video_card_3";var K,Z,J,X;!function(e){e[e.OpenPrivacySetting=0]="OpenPrivacySetting",e[e.Report=1]="Report",e[e.Feedback=2]="Feedback"}(K||(K={})),function(e){e[e.Default=0]="Default",e[e.Report=1]="Report"}(Z||(Z={})),function(e){e[e.Default=0]="Default",e[e.Narrow=1]="Narrow",e[e.FullSideNav=2]="FullSideNav"}(J||(J={})),function(e){e[e.Ok=0]="Ok",e[e.FollowersOnly=10222]="FollowersOnly",e[e.FriendsOnly=10240]="FriendsOnly",e[e.Deleted=10241]="Deleted",e[e.Block=10242]="Block",e[e.PhotoVideo=10239]="PhotoVideo",e[e.SubOnly=203005]="SubOnly"}(X||(X={}));const Q={10222:"support_webapp_sharing_chat_page_video_card_1",10240:"support_webapp_sharing_chat_page_video_card_2",10241:W,10242:W,10239:"photo_post_unavailable_title",203005:"subVideo_unavailableScreen_title"};var ee,te,ne,ie;!function(e){e.ConversationModalTitle="messages-conversation-header",e.ConversationFieldLegend="message-setting-radio-group-legend",e.ConversationFieldDesc="message-setting-radio-group-description",e.BizMessageSwitchTitle="message-business-switch-title",e.BizMessageSwitchDesc="message-business-switch-description",e.ReportModalTitle="messages-report-modal-header",e.ReportDetailModalTitle="messages-report-detail-modal-header",e.StrangerDeleteModalTitle="messages-stranger-delete-modal-title",e.StrangerDeleteModalDesc="messages-stranger-delete-modal-description"}(ee||(ee={})),function(e){e[e.IMG=1]="IMG",e[e.VIDEO=2]="VIDEO",e[e.AUDIO=3]="AUDIO",e[e.FILE=4]="FILE",e[e.OTHER=10]="OTHER"}(te||(te={})),function(e){e.MediaMessage="media_message",e.MediaPreview="media_preview",e.StickerMessage="sticker_message"}(ne||(ne={})),function(e){e[e.SERVER_UNAVAILABLE=4]="SERVER_UNAVAILABLE",e[e.SEND_MESSAGE_BLOCKED=7170]="SEND_MESSAGE_BLOCKED",e[e.MESSAGE_VIOLATION_COMMUNITY_GUIDELINES_ERROR_CODE=7195]="MESSAGE_VIOLATION_COMMUNITY_GUIDELINES_ERROR_CODE",e[e.DIRTY_WORD_ERROR_CODE=7179]="DIRTY_WORD_ERROR_CODE",e[e.NOT_FOLLOW_USER_ERROR_CODE=7281]="NOT_FOLLOW_USER_ERROR_CODE",e[e.NOT_FRIENDS_ERROR_CODE=7282]="NOT_FRIENDS_ERROR_CODE",e[e.RECEIVER_PERMISSION_NO_ONE_ERROR_CODE=7283]="RECEIVER_PERMISSION_NO_ONE_ERROR_CODE",e[e.SENDER_PERMISSION_NO_ONE_ERROR_CODE=7284]="SENDER_PERMISSION_NO_ONE_ERROR_CODE",e[e.SENDER_ACCOUNT_BANNED_ERROR_CODE=7289]="SENDER_ACCOUNT_BANNED_ERROR_CODE",e[e.RECEIVER_ACCOUNT_BANNED_ERROR_CODE=7290]="RECEIVER_ACCOUNT_BANNED_ERROR_CODE",e[e.RECEIVER_ACCOUNT_BANNED_VIEW_ONLY_ERROR_CODE=7291]="RECEIVER_ACCOUNT_BANNED_VIEW_ONLY_ERROR_CODE",e[e.SENDER_UNDERAGE_ERROR_CODE=7393]="SENDER_UNDERAGE_ERROR_CODE",e[e.RECEIVER_UNDERAGE_ERROR_CODE=7394]="RECEIVER_UNDERAGE_ERROR_CODE"}(ie||(ie={}));var ae=n(58632),oe=n(64162),re=n(4126),se=n(93995),le=n(340),de=n(72916),ce=n(23999),ue=n(20259),pe=n(35572),ge=n(95719),he=n(46657),me=n(24451),ve=n(26324),_e=n(64356),fe=n(17953),be=n(63700),ye=n(68628),Ce=n(98812),xe=n(62564),ke=n(8536),Se=n(74690),Me=n(80339),we=n(95868),Ie=n(55322),Te=n(27375),Re=n(60212),Fe=n(55306),De=n(34178),Ye=n(91543);let Le=class extends oe.E{constructor(e,t){super(),this.userModule=e,this.userService=t,this.defaultState={users:{}}}multiSetUsers(e,t){const{users:n}=e;return{users:Object.assign(Object.assign({},n),t)}}setUserRelation(e,{uid:t,relation:n}){const i=e.users[t];i&&(i.relation=n)}blockUser(e){return e.pipe((0,me.E)(this.state$),(0,ke.Z)((([{uid:e,isBlock:t},{users:n}])=>{var i;const{secUid:a="",uniqueId:o=""}=null!==(i=n[e])&&void 0!==i?i:{};return this.userService.blockUser({sec_user_id:a,block_type:t?1:0}).pipe((0,ke.Z)((n=>{const{status_code:i}=n,a=t?4:0;return 0!==i?he.w:(0,ce.of)(this.getActions().setUserRelation({uid:e,relation:a}),this.userModule.getActions().setUserRelation({uniqueId:o,relation:a}))})),(0,Ie.n)({}))})))}};(0,ae.__decorate)([(0,re.HI)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Object]),(0,ae.__metadata)("design:returntype",void 0)],Le.prototype,"multiSetUsers",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Object]),(0,ae.__metadata)("design:returntype",void 0)],Le.prototype,"setUserRelation",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Le.prototype,"blockUser",null),Le=(0,ae.__decorate)([(0,se.n)("MessageUserModule"),(0,ae.__metadata)("design:paramtypes",[Fe.U,Ye.D])],Le);var Ee=n(4725),Oe=n(7672),Ae=n(55099);let je=class{constructor(e){this.fetch=e}getBaLabelMapping(){return this.fetch.get("/api/ba/business/suite/contact/label/mapping",{baseUrlType:2})}};je=(0,ae.__decorate)([(0,Oe._)(),(0,ae.__metadata)("design:paramtypes",[Ae.p])],je);var Ue=n(82970);let Pe=class extends oe.E{constructor(e){super(),this.service=e,this.defaultState={allConversationTagGroupList:[],allConversationTagList:[],selectedConversationTagList:[],unreadOnly:!1,isLoading:!0}}setSelectedConversationTagList(e,t){e.selectedConversationTagList=t}setAllConversationTagGroupList(e,t){e.allConversationTagGroupList=t}setAllConversationTagList(e,t){e.allConversationTagList=t}setUnreadOnly(e,t){e.unreadOnly=t}setLoading(e,t){e.isLoading=t}getAllConversationTags(e){return e.pipe((0,pe.p)((()=>(0,Ue.z)([this.service.getBaLabelMapping()]).pipe((0,pe.p)((([e])=>{const t=e.label_groups,n=(null!=t?t:[]).filter((e=>e.labels&&e.labels.length>0)).map((e=>e.labels)).flat(2);return(0,ce.of)(this.getActions().setAllConversationTagGroupList(null!=t?t:[]),this.getActions().setAllConversationTagList(n))})),(0,Se.Z)(this.getActions().setLoading(!0)),(0,Me.q)(this.getActions().setLoading(!1))))))}};(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],Pe.prototype,"setSelectedConversationTagList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],Pe.prototype,"setAllConversationTagGroupList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],Pe.prototype,"setAllConversationTagList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],Pe.prototype,"setUnreadOnly",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],Pe.prototype,"setLoading",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Pe.prototype,"getAllConversationTags",null),Pe=(0,ae.__decorate)([(0,se.n)("ConversationTagModule"),(0,ae.__metadata)("design:paramtypes",[je])],Pe);const ze="web_dm_storage_";let Ne=class extends oe.E{constructor(e,t,n,i,a,o){super(),this.service=e,this.user=t,this.conversation=n,this.messageUser=i,this.slardar=a,this.conversationTag=o,this.defaultState={initialized:!1,messageCount:0,recentUserList:[],recentUserNameList:[],recentUidList:[],allUidList:[],followingUser:{list:[],nicknameList:[],uidList:[],hasMore:!0,maxCursor:0,minCursor:0},isFollowingLoading:!1,isSendMessageFailed:!1,isSendMessageLoading:!1,conversationMap:{},allConversationList:[],conversationList:[],strangerConversationList:[],successSentMessageCount:0,isListLoading:!0,hasMoreFriends:!0,hasMoreStranger:!0,otherUid:"",isMediaSafeTipShown:!0,isMediaSelectionTipShown:!0,videoPlayerVolume:0},this.recentUids="",this.friendsCursor=20}initSDK(e){return e.pipe((0,ge.M)((e=>{this.service.options$.next(e)})),(0,xe.T)((()=>this.noop())))}initWebDMLocalStorage(e){return e.pipe((0,ke.Z)((e=>{const t=`${ze}${e}`;let n=!0;try{localStorage.getItem(t)}catch(e){n=!1}if(!n)return he.w;const i=(0,F._S)(t);let a={},o=!1;try{i&&(a=JSON.parse(i))}catch(e){o=!0}i&&!o&&"object"==typeof a||((0,F.AP)(t,"{}"),a={});const r=[];return a.isMediaSafeTipShown||r.push(this.getActions().setIsMediaSafeTipShown(!1)),a.isMediaSelectionTipShown||r.push(this.getActions().setIsMediaSelectionTipShown(!1)),"number"==typeof a.videoPlayerVolume&&r.push(this.getActions().setVideoPlayerVolume(a.videoPlayerVolume)),(0,ce.of)(...r)})))}closeMediaSafeTip(e){return e.pipe((0,xe.T)((e=>((0,Ee.L9)(`${ze}${e}`,"isMediaSafeTipShown",!0),this.getActions().setIsMediaSafeTipShown(!0)))))}closeMediaSelectionTip(e){return e.pipe((0,xe.T)((e=>((0,Ee.L9)(`${ze}${e}`,"isMediaSelectionTipShown",!0),this.getActions().setIsMediaSelectionTipShown(!0)))))}saveVideoPlayerVolume(e){return e.pipe((0,xe.T)((({uid:e,volume:t})=>((0,Ee.L9)(`${ze}${e}`,"videoPlayerVolume",t),this.getActions().setVideoPlayerVolume(t)))))}startRefreshMessage(e){return(0,be.h)(this.service.refreshMessage$,e).pipe((0,xe.T)((()=>this.noop())))}setMessageCount(e,t){e.messageCount=t,(0,Ee.Hz)("new-message",{count:t})}setConversationMap(e,t){e.conversationMap=Object.assign({},t)}setConversationList(e,t){t.sort(((e,t)=>{if(e.isStickOnTop&&t.isStickOnTop||!e.isStickOnTop&&!t.isStickOnTop){const n=Math.max(e.customLocalLike?e.customLocalLike.date.getTime():-1,e.lastVisibleMessage?e.lastVisibleMessage.createdAt.getTime():-1);return Math.max(t.customLocalLike?t.customLocalLike.date.getTime():-1,t.lastVisibleMessage?t.lastVisibleMessage.createdAt.getTime():-1)-n}return 0})),e.conversationList=[...t]}setAllConversationList(e,t){e.allConversationList=[...t]}setStrangerConversationList(e,t){e.strangerConversationList=[...t]}setHasMoreStranger(e,t){e.hasMoreStranger=t}setListLoading(e,t){e.isListLoading=t}updateRecentUserList(e,t){const{uniqueIdList:n,nicknameList:i,uidList:a}=t;e.recentUserList=[...n],e.recentUserNameList=[...i],e.recentUidList=[...a]}updateFollowingUserList(e,t){e.followingUser=t}setFollowingLoading(e,t){e.isFollowingLoading=t}setUidList(e,t){e.allUidList=t}addSentMessageSuccessCount(e){e.successSentMessageCount=e.successSentMessageCount+1}setSendMessageStatus(e,t){var n,i;e.isSendMessageFailed=null!==(n=t.isFailed)&&void 0!==n&&n,e.isSendMessageLoading=null!==(i=t.isLoading)&&void 0!==i&&i,void 0!==t.successCount&&(e.successSentMessageCount=t.successCount)}setOtherUid(e,t){e.otherUid=t}setInitialized(e,t){e.initialized=t}setIsMediaSafeTipShown(e,t){e.isMediaSafeTipShown=t}setIsMediaSelectionTipShown(e,t){e.isMediaSelectionTipShown=t}setVideoPlayerVolume(e,t){e.videoPlayerVolume=t}handleImEvent(e){return e.pipe((0,xe.T)((({event:e,sdk:t,params:n,uid:i,abTestVersion:a})=>{switch(e){case t.IMEvent.ConversationChange:return this.getActions().startConversationChange();case t.IMEvent.MessageSend:return this.conversation.getActions().handleMessageSend(Object.assign(Object.assign({},n),{abTestVersion:a}));case t.IMEvent.ReceiveNewMessage:return this.conversation.getActions().handleReceiveNewMessage(Object.assign(Object.assign({},n),{abTestVersion:a}));case t.IMEvent.MessageDelete:return this.conversation.getActions().handleMessageDelete(Object.assign(Object.assign({},n),{abTestVersion:a}));case t.IMEvent.MessagePropertyUpsert:return this.conversation.getActions().handleMessagePropertyUpsert(Object.assign(Object.assign({},n),{uid:i}));case t.IMEvent.RefreshMessage:return this.conversation.getActions().handleRefreshMessage(Object.assign({},n));case t.IMEvent.MessageUpsert:return this.conversation.getActions().handleMessageUpsert({message:n,abTestVersion:a});default:return this.noop()}})))}startConversationChange(e){return e.pipe((0,ke.Z)((()=>this.service.getConversationListOnline())),(0,me.E)(this.state$,this.conversation.state$),(0,ke.Z)((([e=[],{otherUid:t},{selectedConversation:n}])=>{const i=[],a={};t&&i.push(t);const o=e.reduce(((e,o)=>{const{id:r,mode:s,isStrangerConversation:l,toParticipantUserId:d,unreadCount:c,isMuted:u,inboxType:p}=o;if(1===p)return e;if(0===s&&!l){const s=d;if(s&&(s!==t&&i.push(s),a[s]=o),0!==c&&!u&&r!==(null==n?void 0:n.id))return e+1}return e}),0),r=i.slice(0,20);return(0,ce.of)(this.getActions().setMessageCount(o),this.getActions().setConversationMap(a),this.getActions().setAllConversationList(e),this.getActions().setConversationList(e.slice(0,this.friendsCursor)),this.getActions().setUidList(i),this.getActions().setInitialized(!0),this.getActions().getStrangerPreview(),this.getActions().getMultiUsersByUids({uidList:r,isGetRecentUsers:!0}),this.conversation.getActions().multiSetConversation({list:e,isStranger:!1}),this.getActions().getConversationListWithFilter())})),(0,Se.Z)(this.getActions().setListLoading(!0)),(0,Ie.n)({}))}getMoreConversationList(e){return e.pipe((0,me.E)(this.state$),(0,ke.Z)((([e,{allUidList:t,allConversationList:n}])=>{if(this.friendsCursor>=n.length)return he.w;const i=this.friendsCursor;return this.friendsCursor=this.friendsCursor+15,(0,ce.of)(this.getActions().getMultiUsersByUids({uidList:t.slice(i,this.friendsCursor)}),this.getActions().setConversationList(n.slice(0,this.friendsCursor)),this.getActions().setListLoading(!0))})))}getConversationListWithFilter(e){return e.pipe((0,me.E)(this.conversationTag.state$),(0,ke.Z)((([e,{unreadOnly:t,selectedConversationTagList:n}])=>{const i=e=>{for(const t of n)if(!e.userConversationTags.includes(String(t.label_id)))return!1;return!0};return t?this.service.getConversationListOnline((e=>e.unreadCount>0&&i(e))).pipe((0,pe.p)(((e=[])=>(0,ce.of)(this.getActions().setConversationList(e))))):this.service.getConversationListOnline((e=>i(e))).pipe((0,pe.p)(((e=[])=>(0,ce.of)(this.getActions().setConversationList(e)))))})))}getStrangerPreview(e){return e.pipe((0,me.E)(this.messageUser.state$,this.state$),(0,ke.Z)((([e,{users:t},{allConversationList:n,conversationList:i}])=>this.service.getStrangerPreview().pipe((0,ke.Z)((e=>{var a,o;const r=null==e?void 0:e.conversation,s=null==r?void 0:r.toParticipantUserId;if(!s)return he.w;const l=[...n],d=[...i],c=null!==(o=null===(a=null==r?void 0:r.lastVisibleMessage)||void 0===a?void 0:a.createdAt.getTime())&&void 0!==o?o:-1;l.some(((e,t)=>{var n,i;if((null!==(i=null===(n=null==e?void 0:e.lastVisibleMessage)||void 0===n?void 0:n.createdAt.getTime())&&void 0!==i?i:-1)<c&&!(null==e?void 0:e.isStickOnTop))return l.splice(t,0,r),!0;t===l.length-1&&l.splice(t+1,0,r)})),d.some(((e,t)=>{var n,i;if((null!==(i=null===(n=null==e?void 0:e.lastVisibleMessage)||void 0===n?void 0:n.createdAt.getTime())&&void 0!==i?i:-1)<c&&!(null==e?void 0:e.isStickOnTop))return d.splice(t,0,r),!0;t===d.length-1&&d.splice(t+1,0,r)})),l.length||(l.splice(0,0,r),d.splice(0,0,r));const u=[this.getActions().setAllConversationList(l),this.getActions().setConversationList(d),this.conversation.getActions().multiSetConversation({list:[r],isStranger:!0})];return t[s]||u.push(this.getActions().getMultiUsersByUids({uidList:[s]})),(0,ce.of)(...u)})),(0,Ie.n)({})))))}getStrangerConversationList(e){return e.pipe((0,me.E)(this.state$,this.conversation.state$),(0,ke.Z)((([{isLoadMore:e},{strangerConversationList:t},{strangers:n}])=>this.service.getStrangerConversationList({cursor:e?this.strangerCursor:0,limit:15}).pipe((0,me.E)(this.state$),(0,ke.Z)((([{conversation:e,hasMore:t,cursor:i},{strangerConversationList:a}])=>{this.strangerCursor=i;const o=a.reduce(((e,t)=>(e[t.id]=t,e)),{}),r=e.filter((e=>!n[e.id]||!o[e.id]));if(1!==e.length&&!r.length)return he.w;const s=r.map((e=>{var t;return null!==(t=e.toParticipantUserId)&&void 0!==t?t:""}));return(0,ce.of)(this.getActions().setStrangerConversationList([...e]),this.conversation.getActions().multiSetConversation({list:r,isStranger:!0}),this.getActions().setHasMoreStranger(t),this.getActions().getMultiUsersByUids({uidList:s}))})),(0,Se.Z)(t.length?this.noop():this.getActions().setListLoading(!0)),(0,Me.q)(this.getActions().setListLoading(!1))))))}getMultiUsersByUids(e){return e.pipe((0,me.E)(this.messageUser.state$,this.state$),(0,pe.p)((([{uidList:e,isGetRecentUsers:t},{users:n},{otherUid:i}])=>{const{pathname:a}=location;if(!(0,we.tO)(a)&&5===(0,we.M5)(a))return he.w;const o=String(e),r=e.filter((e=>void 0===(null==n?void 0:n[e])));return e.length&&this.recentUids!==o&&r.length?(this.recentUids=o,this.service.getMultiUsersByUids(o).pipe((0,pe.p)((n=>{var a;const o=null!==(a=null==n?void 0:n.userMap)&&void 0!==a?a:{},r=[],s=[],l=[],d=e.map((e=>{if(o[e])return i===e&&(0,Ee.Hz)("user-select",{uid:e,uniqueId:o[e].uniqueId,from:"message-init"}),o[e].id=e,r.push(o[e].uniqueId),s.push(o[e].nickname),l.push(e),o[e];o[e]=null})).filter((e=>e));if(!d.length)return(0,ce.of)(this.noop(),this.getActions().setListLoading(!1));(0,R.py)().multiSetUsers(o);const c=[this.user.getActions().multiSetUser(d)];return t&&c.push(this.getActions().updateRecentUserList({uniqueIdList:r,nicknameList:s,uidList:l})),(0,ce.of)(...c)})),(0,Me.q)(this.getActions().setListLoading(!1)))):(0,ce.of)(this.getActions().setListLoading(!1))})),(0,Ie.n)({}))}getFollowingUserListWithCanShare(e){return e.pipe((0,me.E)(this.state$),(0,xe.T)((([{count:e},t])=>Object.assign(Object.assign({},t.followingUser),{count:e}))),(0,ke.Z)((e=>{var{list:t,nicknameList:n,uidList:i}=e,a=(0,ae.__rest)(e,["list","nicknameList","uidList"]);return this.service.getFollowingUserListWithCanShare(a).pipe((0,pe.p)((e=>{const{status_code:a,max_time:o,min_time:r,followings:s=[],has_more:l}=e,d=[],c=[],u=[];if(0===a){let e=[];return s&&(e=s.map((e=>{var t;return d.push(null!==(t=e.unique_id)&&void 0!==t?t:""),c.push(e.nickname),u.push(e.uid),(0,Te.RS)(e)}))),(0,ce.of)(this.getActions().updateFollowingUserList({list:[...t,...d],nicknameList:[...n,...c],uidList:[...i,...u],maxCursor:o,minCursor:r,hasMore:Boolean(l)}),this.user.getActions().multiSetUser(null!=e?e:[]),this.getActions().setFollowingLoading(!1))}return(0,ce.of)(this.noop(),this.getActions().setFollowingLoading(!1))})),(0,Se.Z)(this.getActions().setFollowingLoading(!0)))})),(0,Ie.n)({}))}sendMessage(e){return e.pipe((0,me.E)(this.conversation.state$),(0,ke.Z)((([{uid:e,relation:t=0,type:n,content:i,hasConversation:a,chatType:o,messageType:r,convId:s,fileInfo:l},{friends:d,strangers:c}])=>{var u;return(a?(0,ce.of)({type:n,content:i,conversation:null!==(u=d[s])&&void 0!==u?u:c[s],fileInfo:l}):this.service.createConversation({uid:e}).pipe((0,xe.T)((({payload:e})=>({type:n,content:i,conversation:null!=e?e:{},fileInfo:l}))),(0,Ie.n)({}))).pipe((0,ke.Z)((({type:e,content:t,conversation:n,fileInfo:i})=>this.service.createMessage({conversation:n,type:e,content:JSON.stringify(t),fileInfo:i}))),(0,ke.Z)((e=>49999===n?he.w:this.service.sendMessage({message:e}))),(0,ke.Z)((n=>{var i,a,s;const{success:l,checkMsg:d,payload:c}=n,u=[this.getActions().setSendMessageStatus({isFailed:!1,isLoading:!1}),this.getActions().addSentMessageSuccessCount()];return l?(w.w.handleSendMessage({chat_type:null!=o?o:"private",conversation_id:null!==(i=null==c?void 0:c.conversationId)&&void 0!==i?i:"",message_type:null!=r?r:"share_video",relation_tag:t,to_user_id:e}),(0,Ee.Hz)("message-send",{uid:e})):(w.w.handleFailSendMessage({chat_type:null!=o?o:"private",conversation_id:null!==(a=null==c?void 0:c.conversationId)&&void 0!==a?a:"",message_type:null!=r?r:"share_video",error_code:null!==(s=JSON.parse(null!=d?d:"{}").status_code)&&void 0!==s?s:-1,relation_tag:t,to_user_id:e}),(null==c?void 0:c.clientId)&&u.push(this.conversation.getActions().addFailedMessage({[null==c?void 0:c.clientId]:null!=d?d:"null"}))),(0,ce.of)(...u)})),(0,ue.W)((()=>(w.w.handleFailSendMessage({chat_type:null!=o?o:"private",conversation_id:"",message_type:null!=r?r:"share_video",error_code:-1,relation_tag:t,to_user_id:e}),(0,ce.of)(this.getActions().setSendMessageStatus({isFailed:!0,isLoading:!1}))))))})),(0,Ie.n)({}),(0,Se.Z)(this.getActions().setSendMessageStatus({isFailed:!1,isLoading:!1})))}batchSendMessages(e){return e.pipe((0,me.E)(this.conversation.state$),(0,ke.Z)((([{uid:e,relation:t=0,hasConversation:n,chatType:i,convId:a,batchList:o},{friends:r,strangers:s}])=>{var l;return(n?(0,ce.of)({conversation:null!==(l=r[a])&&void 0!==l?l:s[a],batchList:o}):this.service.createConversation({uid:e}).pipe((0,xe.T)((({payload:e})=>({conversation:null!=e?e:{},batchList:o}))),(0,Ie.n)({}))).pipe((0,ke.Z)((({conversation:n,batchList:a})=>(0,ye.H)(a).pipe((0,Ce.H)((e=>{const{type:t,content:i,fileInfo:a}=e;return this.service.createMessage({conversation:n,type:t,content:JSON.stringify(i),fileInfo:a}).pipe((0,xe.T)((t=>({message:t,messageParams:e}))))})),(0,ke.Z)((({message:e,messageParams:t})=>this.service.sendMessage({message:e}).pipe((0,xe.T)((e=>({res:e,messageParams:t})))))),(0,ke.Z)((({res:n,messageParams:a})=>{var o,r,s,l;const{success:d,checkMsg:c,payload:u,statusCode:p,statusMsg:g,innerError:h}=n,m=[this.getActions().addSentMessageSuccessCount(),this.conversation.getActions().setSendingProgress({messageId:null!==(o=null==u?void 0:u.clientId)&&void 0!==o?o:"",sendingProgress:{finished:!0}})],v=[],_={chat_type:null!=i?i:"private",conversation_id:null!==(r=null==u?void 0:u.conversationId)&&void 0!==r?r:"",message_type:null!==(s=a.messageType)&&void 0!==s?s:"default",relation_tag:t,to_user_id:e};if(d)w.w.handleSendMessage(_),(0,Ee.Hz)("message-send",{uid:e});else{(null==u?void 0:u.clientId)&&v.push(this.conversation.getActions().addFailedMessage({[u.clientId]:null!=c?c:"null"}));const e=Object.assign(Object.assign({},_),{error_code:null!==(l=JSON.parse(null!=c?c:"{}").status_code)&&void 0!==l?l:-1,status_code:null!=p?p:-1,status_msg:null!=g?g:""});w.w.handleFailSendMessage(e),this.slardar.handleSendMediaFail(Object.assign(Object.assign({},e),{inner_error:`${h}`}))}return(0,ce.of)(...m,...v)})),(0,ue.W)((()=>(w.w.handleFailSendMessage({chat_type:null!=i?i:"private",conversation_id:"",message_type:"media",error_code:-1,relation_tag:t,to_user_id:e}),(0,ce.of)(this.getActions().setSendMessageStatus({isFailed:!0,isLoading:!1})))))))))})),(0,Ie.n)({}),(0,Se.Z)(this.getActions().setSendMessageStatus({isFailed:!1,isLoading:!1})))}};(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"initSDK",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"initWebDMLocalStorage",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"closeMediaSafeTip",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"closeMediaSelectionTip",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"saveVideoPlayerVolume",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"startRefreshMessage",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Number]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setMessageCount",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Object]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setConversationMap",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setConversationList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setAllConversationList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setStrangerConversationList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setHasMoreStranger",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setListLoading",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Object]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"updateRecentUserList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Object]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"updateFollowingUserList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setFollowingLoading",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setUidList",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"addSentMessageSuccessCount",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Object]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setSendMessageStatus",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,String]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setOtherUid",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setInitialized",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setIsMediaSafeTipShown",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setIsMediaSelectionTipShown",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Number]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"setVideoPlayerVolume",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",ve.c)],Ne.prototype,"handleImEvent",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"startConversationChange",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"getMoreConversationList",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"getConversationListWithFilter",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"getStrangerPreview",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"getStrangerConversationList",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"getMultiUsersByUids",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"getFollowingUserListWithCanShare",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"sendMessage",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],Ne.prototype,"batchSendMessages",null),Ne=(0,ae.__decorate)([(0,se.n)("MessageModule"),(0,ae.__metadata)("design:paramtypes",[fe.b,Fe.U,De._,Le,Re.Z,Pe])],Ne);var Be=n(11983),Ve=n(26325);let $e=class{constructor(e){this.fetch=e}getConvNotice(e){const{secUid:t,conversationId:n}=e;return this.fetch.get("/api/im/chat/notice/",{query:{sec_to_user_id:t,conversation_id:n,aid:1988},baseUrlType:2})}acceptStranger({id:e,uid:t}){return this.fetch.post("/api/im/stranger/unlimit/",{query:{aid:1988},headers:{[Ve.nk]:this.fetch.csrfToken},body:a.stringify({conversation_id:e,to_user_id:t}),baseUrlType:2})}getReportReasons(e,t){return this.fetch.get("/node/report/reasons",{query:{report_type:"im",lang:e,api_version:t?3:2},baseUrlType:2})}postReport(e){return this.fetch.post("/aweme/v2/aweme/feedback/",{query:e,baseUrlType:2})}};function Ge(){var e;let t=[];try{const n=null!==(e=localStorage.getItem(q))&&void 0!==e?e:"";t=Array.isArray(JSON.parse(n))?JSON.parse(n):[]}catch(e){t=[]}return t}$e=(0,ae.__decorate)([(0,Oe._)(),(0,ae.__metadata)("design:paramtypes",[Ae.p])],$e);let He=class extends oe.E{constructor(e,t,n,i,a){super(),this.service=e,this.messageService=t,this.messageModule=n,this.conversationModule=i,this.t=a,this.defaultState={conversationListType:"friends",chatMode:0,notice:"",clickableNotice:null,showSettingModal:!1,acceptedStrangerList:[],reportReasons:[],selectedReportReasons:[],isShowReportSelectModal:!1,isShowReportSuccessModal:!1,isShowContactButton:!1,isUsingV3Reasons:!0}}setIsUsingV3Reasons(e,t){e.isUsingV3Reasons=t}setConversationListType(e,t){e.conversationListType=t}setChatMode(e,t){e.chatMode=t}setNotice(e,t){e.notice=t}setClickableNotice(e,t){e.clickableNotice=t}addAcceptedStranger(e,t){e.acceptedStrangerList=[...e.acceptedStrangerList,t]}setReportReasons(e,t){e.reportReasons=t}setSelectedReportReasons(e,t){e.selectedReportReasons=t}setIsShowReportSelectModal(e,t){e.isShowReportSelectModal=t}setIsShowContactButton(e,t){e.isShowContactButton=t}setIsShowReportSuccessModal(e,t){e.isShowReportSuccessModal=t}getConversationNotice(e){return e.pipe((0,de.n)((({secUid:e,conversationId:t})=>e&&t?this.service.getConvNotice({secUid:e,conversationId:t}).pipe((0,de.n)((({data:e})=>{if(1022===(null==e?void 0:e.msg_type)){const{tips:t,template:n}=e.msg_content;if(n){const{key:e,name:i}=n[0]||{};return(0,ce.of)(this.getActions().setClickableNotice({desc:t,clickText:i,template:`{{${e}}}`,action:0}))}return(0,ce.of)(this.getActions().setNotice(t),this.getActions().setClickableNotice(null))}return(0,ce.of)(this.getActions().setNotice(""),this.getActions().setClickableNotice(null))})),(0,ue.W)((()=>(0,ce.of)(this.getActions().setNotice(""),this.getActions().setClickableNotice(null))))):(0,ce.of)(this.getActions().setNotice(""),this.getActions().setClickableNotice(null)))))}acceptStranger(e){return e.pipe((0,pe.p)((({id:e,uid:t})=>this.service.acceptStranger({id:e,uid:t}).pipe((0,ge.M)((({status_code:t})=>{if(0===t){const t=Ge();t.push(e),localStorage.setItem(q,JSON.stringify(t))}})),(0,pe.p)((({status_code:t})=>0===t?(0,ce.of)(this.getActions().addAcceptedStranger(e)):he.w))))))}deleteStranger(e){return e.pipe((0,pe.p)((({conversation:e})=>this.messageService.deleteStrangerConversation({conversation:e}).pipe((0,me.E)(this.messageModule.state$),(0,pe.p)((([t,{strangerConversationList:n}])=>(0,ce.of)(this.messageModule.getActions().setStrangerConversationList(n.filter((t=>t.id!==e.id))),this.conversationModule.getActions().setSelectedConversation(void 0))))))))}getReportReasons(e){return e.pipe((0,me.E)(this.state$),(0,pe.p)((([e,t])=>this.service.getReportReasons(e,t.isUsingV3Reasons).pipe((0,pe.p)((({body:e=[]})=>(0,ce.of)(this.getActions().setReportReasons(e))))))))}postReport(e){return e.pipe((0,pe.p)((e=>this.service.postReport(e).pipe((0,ge.M)((({status_code:e})=>{0!==e&&Be.F.open({content:this.t("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"})})),(0,pe.p)((({status_code:e})=>0!==e?he.w:(0,ce.of)(this.getActions().setChatMode(0),this.getActions().setIsShowReportSuccessModal(!0)))),(0,ue.W)((()=>(Be.F.open({content:this.t("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"}),he.w)))))))}};(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setIsUsingV3Reasons",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,String]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setConversationListType",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Number]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setChatMode",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,String]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setNotice",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Object]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setClickableNotice",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,String]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"addAcceptedStranger",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setReportReasons",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Array]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setSelectedReportReasons",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setIsShowReportSelectModal",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setIsShowContactButton",null),(0,ae.__decorate)([(0,re.h5)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[Object,Boolean]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"setIsShowReportSuccessModal",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"getConversationNotice",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"acceptStranger",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"deleteStranger",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"getReportReasons",null),(0,ae.__decorate)([(0,re.Mj)(),(0,ae.__metadata)("design:type",Function),(0,ae.__metadata)("design:paramtypes",[ve.c]),(0,ae.__metadata)("design:returntype",void 0)],He.prototype,"postReport",null),He=(0,ae.__decorate)([(0,se.n)("MessagePageModule"),(0,ae.__param)(4,(0,le.y)(_e.hp)),(0,ae.__metadata)("design:paramtypes",[$e,fe.b,Ne,De._,Function])],He);var qe=n(38597),We=n(44815),Ke=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};function Ze({uid:e="",conversation:t}){var n;const i=(0,R.L_)(),a=(0,m.Xq)(),r=null!==(n=t.id)&&void 0!==n?n:"";return{handleUnblockUser:(0,o.useCallback)((()=>Ke(this,void 0,void 0,(function*(){yield i.blockUser({uid:e,isBlock:!1}),qe.h.handleBlock({to_user_id:e,conversation_id:r,chat_type:"private"},!1)}))),[i,e,r]),handleStrangerAccept:(0,o.useCallback)((()=>Ke(this,void 0,void 0,(function*(){const t=yield a.acceptStranger({id:r,uid:e});w.w.handleAcceptStrangerChat();const{status_code:n}=t;0===n&&a.setConversationListType("friends")}))),[a,r,e]),handleStrangerDelete:(0,o.useCallback)((()=>Ke(this,void 0,void 0,(function*(){yield a.deleteStranger({conversation:t}),w.w.handleDeleteChat({is_stranger:!0,conversation_id:r})}))),[a,t,r]),handleReportStranger:(0,o.useCallback)((()=>{a.setIsShowReportSelectModal(!0),We.o.handleShowReport({enter_from:"chat",is_stranger:!0,conversation_id:r})}),[r,a])}}function Je(){return{toast:(0,o.useCallback)((({content:e,duration:t=3})=>{const n=document.createElement("div");Object.assign(n.style,{position:"fixed",top:0,left:0,width:"100%",zIndex:99999}),document.body.appendChild(n),Be.F.open({content:e,duration:t,widthType:"half",getContainer:()=>n,onClose:()=>{setTimeout((()=>{var e;null===(e=n.parentNode)||void 0===e||e.removeChild(n)}),500)}})}),[])}}var Xe=n(95481),Qe=n(97397);const et=(0,E.default)("div",{target:"e1yd01ac0"})((({theme:{colors:e}})=>({display:"flex",flexDirection:"column",alignItems:"center",width:"400px",padding:"32px",background:e.BGPrimary,boxShadow:"0 2px 12px rgba(0, 0, 0, .12)",borderRadius:"8px",textAlign:"center"})),"label:DivDeleteConfirmContainer;"),tt=(0,E.default)("p",{target:"e1yd01ac1"})((({theme:e})=>[{wordBreak:"break-word"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"bold",typography:"P0"})]),"label:PTitle;"),nt=(0,E.default)("p",{target:"e1yd01ac2"})((({theme:e})=>[{marginTop:"8px"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P2",color:"TextSecondary"})]),"label:PDesc;"),it=(0,E.default)("div",{target:"e1yd01ac3"})({display:"flex",justifyContent:"space-between",marginTop:"24px",width:"100%"},"label:DivButtonContainer;"),at=(0,E.default)(Qe.y,{target:"e1yd01ac4"})({minWidth:"160px",width:"160px",height:"46px"},"label:StyledButton;"),ot=(0,o.memo)((function({onCancel:e,onDelete:t}){const n=(0,g.s)();return(0,i.Y)(Xe.aF,{visible:!0,closeAble:!1,autoFocus:!0,onClose:e,children:(0,i.FD)(et,{role:"dialog","aria-modal":!0,"aria-labelledby":"messages-stranger-delete-modal-title","aria-describedby":"messages-stranger-delete-modal-description",children:[(0,i.Y)(tt,{id:"messages-stranger-delete-modal-title",children:n("dm_stranger_delete_this_message_header")}),(0,i.Y)(nt,{id:"messages-stranger-delete-modal-description",children:n("dm_stranger_delete_this_message_body")}),(0,i.FD)(it,{className:"button-container",children:[(0,i.Y)(at,{buttonTheme:"default",onClick:e,children:n("cancel")}),(0,i.Y)(at,{buttonTheme:"primary",onClick:t,children:n("delete")})]})]})})}));var rt=n(16188),st=n(17592),lt=n(84987);const dt={id:"send-139eb28a",use:"send-139eb28a-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="send-139eb28a"><path fill="#FE2C55" fill-rule="evenodd" d="M30.488 4.667A1.33 1.33 0 0 0 29.333 4H2.667a1.333 1.333 0 0 0-.987 2.23l6.96 7.65c.37.406.948.544 1.46.35l9.667-3.674c.112-.043.163-.025.186-.016a.3.3 0 0 1 .138.13.3.3 0 0 1 .047.184c-.003.023-.012.077-.104.154l-7.936 6.732c-.41.347-.57.905-.41 1.417l3.04 9.67a1.333 1.333 0 0 0 2.427.266L30.488 6c.238-.413.238-.92 0-1.333" clip-rule="evenodd" /></symbol>'};function ct(e){const t=(0,o.useContext)(lt.X);return(0,o.useLayoutEffect)((()=>(t.add(dt),()=>{t.remove("send-139eb28a")})),[]),(0,Y.jsx)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor"},e,{children:(0,Y.jsx)("use",{xlinkHref:"#send-139eb28a"},void 0)}),void 0)}const ut=(0,E.default)("div",{target:"e1823izs0"})({display:"flex",flexDirection:"column",width:"100%",padding:"12px 16px",borderTop:".5px solid rgba(22, 24, 35, .12)"},"label:DivChatBottom;"),pt=(0,E.default)("div",{target:"e1823izs1"})({display:"flex",width:"100%",alignItems:"flex-end"},"label:DivMessageInputAndSendButton;"),gt=(0,E.default)("div",{target:"e1823izs2"})((({hasContent:e,theme:{direction:t}})=>({width:e?"calc(100% - 32px)":"calc(100%)",transition:"rtl"===t?"none":"width 150ms cubic-bezier(.4, .14, .3, 1)"})),"label:DivEditorContainer;"),ht=(0,E.default)(ct,{target:"e1823izs3"})((({theme:{direction:e}})=>[{width:"32px",height:"32px",marginBottom:"3px",cursor:"pointer"},(0,O.mp)({direction:e,marginStart:"16px"})]),"label:StyledSendButton;");ht.defaultProps=Object.assign(Object.assign({},ht.defaultProps),{"data-e2e":"message-send"});const mt=(0,E.default)("div",{target:"e1823izs4"})((({theme:e,theme:{colors:t},isFocus:n})=>[{position:"relative",display:"flex",flexDirection:"row",flex:1,width:"100%",alignItems:"center",backgroundColor:t.BGInput,boxSizing:"border-box",border:"1px solid",borderColor:n?t.LinePrimary:"transparent",borderRadius:8,padding:"10px 16px",fontSize:"15px",lineHeight:"18px"},(0,O.zy)({theme:e,fontFamily:"TikTokFont"})]),"label:DivInputAreaContainer;");mt.defaultProps=Object.assign(Object.assign({},mt.defaultProps),{"data-e2e":"message-input-area"});const vt=(0,E.default)("div",{target:"e1823izs5"})((({theme:{direction:e}})=>[{position:"absolute",bottom:"2px",flex:"0 0 32px",width:32,height:32,padding:4,cursor:"pointer",backgroundColor:"transparent",borderRadius:8,svg:{width:"100%",height:"100%"}},(0,O.mp)({direction:e,end:"11px"})]),"label:DivEmojiButton;"),_t=(0,E.default)("div",{target:"e1823izs6"})((({theme:{direction:e}})=>[{position:"absolute",bottom:"2px",flex:"0 0 32px",width:32,height:32,padding:4,cursor:"pointer",backgroundColor:"transparent",borderRadius:8,svg:{width:"100%",height:"100%"}},(0,O.mp)({direction:e,end:"40px"})]),"label:DivImageButton;"),ft=(0,E.default)("div",{target:"e1823izs7"})((({theme:{colors:e,direction:t,isDark:n}})=>[{position:"absolute",width:368,height:300,top:-300,borderRadius:8,overflow:"hidden",backgroundColor:n?e.BGQuaternary:e.BGPrimary,boxShadow:n?`${e.BGCreation5} 0px 2px 12px 0px`:`${e.ShadowPrimary} 0px 4px 16px 0px`,outline:0,zIndex:1},(0,O.mp)({direction:t,end:12})]),"label:DivEmojiPanelContainer;"),bt=(0,E.default)("div",{target:"e1823izs8"})({},"label:DivStrangerBox;"),yt=(0,E.default)("div",{target:"e1823izs9"})((({theme:{colors:e}})=>({padding:"18px 36px 14px",backgroundColor:e.BGView,textAlign:"center"})),"label:DivHint;"),Ct=(0,E.default)("p",{target:"e1823izs10"})((({theme:e})=>[{fontSize:"18px",lineHeight:"24px"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"bold"})]),"label:PStrangerTitle;"),xt=(0,E.default)("p",{target:"e1823izs11"})((({theme:e})=>[{marginTop:"4px"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P3"})]),"label:PStrangerDesc;"),kt=(0,E.default)("span",{target:"e1823izs12"})((({theme:e})=>[{cursor:"pointer"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"bold"})]),"label:SpanReportText;"),St=(0,E.default)("div",{target:"e1823izs13"})({display:"flex",alignItems:"center",width:"100%",height:"64px",borderTop:"1px solid rgba(33, 33, 33, .08)"},"label:DivOperation;"),Mt=(0,E.default)("div",{target:"e1823izs14"})({width:"1px",height:"24px",background:"rgba(22, 24, 35, .12)"},"label:DivSplit;"),wt=(0,E.default)("div",{target:"e1823izs15"})((({isAccept:e,theme:t})=>[{flex:"1",fontSize:"16px",textAlign:"center",cursor:"pointer"},(0,O.zy)({theme:t,fontFamily:"TikTokFont",fontWeight:e?"semiBold":"normal",color:e?"TextPrimary":"TextSecondary"})]),"label:DivItem;"),It=(0,E.default)("div",{target:"e1823izs16"})({height:"64px",borderTop:"1px solid rgba(22, 24, 35, .12)",textAlign:"center",fontSize:"14px",lineHeight:"64px"},"label:DivBlockBox;"),Tt=(0,E.default)("p",{target:"e1823izs17"})((({theme:e})=>[{cursor:"pointer"},(0,O.zy)({theme:e,fontFamily:"TikTokFont"})]),"label:PBlockDesc;"),Rt=(0,E.default)("span",{target:"e1823izs18"})((({theme:e})=>[{cursor:"pointer"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"bold"})]),"label:SpanBlockText;"),Ft=(0,E.default)(rt.A,{target:"e1823izs19"})({"&:hover":{opacity:.75}},"label:StyledEmojiIcon;"),Dt=(0,E.default)(st.A,{target:"e1823izs20"})({"&:hover":{opacity:.75}},"label:StyledMediaIcon;"),Yt=(0,E.default)("div",{target:"e1823izs21"})({borderTop:"1px solid rgba(22, 24, 35, .12)",textAlign:"center",padding:"18px 36px 0"},"label:DivChatSuspendBox;"),Lt=(0,E.default)("p",{target:"e1823izs22"})((({theme:e})=>[{padding:"24px 0"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P3"})]),"label:PChatSuspendedDesc;"),Et=(0,E.default)("span",{target:"e1823izs23"})((({theme:e})=>[(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"bold"})]),"label:SuspendedTimeText;"),Ot=(0,E.default)("div",{target:"e1823izs24"})((({theme:e})=>[{display:"flex",padding:"4px 16px 14px 0px",justifyContent:"center",alignItems:"center",gap:"10px",alignSelf:"stretch"},(0,O.zy)({theme:e,color:"UIText3",fontFamily:"TikTokFont"})]),"label:DivRefMessage;"),At=(0,E.default)("div",{target:"e1823izs25"})((()=>[{wordBreak:"break-word",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.15em",maxHeight:"2.3em"}]),"label:DivMaxTwoLine;"),jt=(0,E.default)("div",{target:"e1823izs26"})((({theme:e})=>[{flexGrow:1,textAlign:"start",fontSize:"14px"},(0,O.zy)({theme:e,color:"UIText3",fontFamily:"TikTokFont"})]),"label:DivChatBottomRefMessageContent;"),Ut=(0,E.default)("div",{target:"e1823izs27"})((({theme:e})=>[{flexShrink:0,flexGrow:0,width:"16px",height:"16px",cursor:"pointer"},(0,O.zy)({theme:e,color:"UIText3"})]),"label:SpanRefMessageExit;");var Pt=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const zt=(0,o.memo)((function({uid:e,nickname:t,conversation:n,isBusinessInvitation:a}){const r=(0,g.s)(),[s,l]=(0,o.useState)(!1),d=r(a?"dm_tcm_request_link_report":"dm_message_request_report");let c=r(a?"dm_tcm_request_desc_business_wants_send_msg":"dm_message_request",{report_this_user:d});const u=c.indexOf(d),p=a?"dm_tcm_request_title_business_wants_send_msg":"dm_message_request_title";c=c.replace(d,"");const{handleStrangerAccept:h,handleStrangerDelete:m,handleReportStranger:v}=Ze({uid:e,conversation:n}),_=(0,o.useCallback)((()=>{l(!0)}),[]),f=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||l(!0)}),[]),b=(0,o.useCallback)((()=>Pt(this,void 0,void 0,(function*(){yield h()}))),[h]),y=(0,o.useCallback)((e=>Pt(this,void 0,void 0,(function*(){13!==e.keyCode&&32!==e.keyCode||(yield h())}))),[]),C=(0,o.useCallback)((()=>Pt(this,void 0,void 0,(function*(){l(!1),yield m()}))),[m]),x=(0,o.useCallback)((()=>{l(!1)}),[]);return(0,i.FD)(i.FK,{children:[(0,i.FD)(bt,{children:[(0,i.FD)(yt,{children:[(0,i.Y)(Ct,{children:r(p,{username:t})}),(0,i.FD)(xt,{children:[c.slice(0,u),(0,i.Y)(kt,{onClick:v,children:d}),c.slice(u)]})]}),(0,i.FD)(St,{children:[(0,i.Y)(wt,{role:"button",tabIndex:0,onClick:_,onKeyDown:f,children:r("dm_delete")}),(0,i.Y)(Mt,{}),(0,i.Y)(wt,{isAccept:!0,role:"button",tabIndex:0,onClick:b,onKeyDown:y,children:r("dm_accept")})]})]}),s&&(0,i.Y)(ot,{onDelete:C,onCancel:x})]})})),Nt=(0,E.default)("label",{target:"e1tydil30"})({display:"block",cursor:"pointer"},"label:LabelMediaButton;"),Bt=(0,E.default)("input",{target:"e1tydil31"})({display:"none"},"label:InputMediaButton;"),Vt=["image/jpeg","image/jpg","image/png","video/mp4"],$t=e=>{const t=Array.from(e).filter((e=>Vt.some((t=>e.type===t)))).map((e=>({fileName:e.name,fileSize:e.size,fileType:e.type,fileHandler:e,isVideo:e.type.startsWith("video/")})));return Promise.all(t.map((e=>new Promise((t=>{if(e.isVideo){const n=document.createElement("video");n.src=URL.createObjectURL(e.fileHandler),n.onloadedmetadata=()=>{e.width=n.videoWidth,e.height=n.videoHeight,e.duration=n.duration,t(e)}}else if(e.fileType.startsWith("image/")){const n=document.createElement("img");n.src=URL.createObjectURL(e.fileHandler),n.onload=()=>{e.width=n.width,e.height=n.height,t(e)}}})))))},Gt=({onSelectFiles:e})=>{const t=(0,g.s)(),{toast:n}=Je(),a=(0,o.useCallback)((i=>{var a;const o=[...null!==(a=i.target.files)&&void 0!==a?a:[]];i.target.value="",o.length&&$t(o).then((i=>{e(i),i.length<o.length&&n({content:t("webCreation_uploadSingle_formatError_toast")})}))}),[e,t,n]);return(0,i.FD)("div",{"aria-haspopup":"true","aria-controls":"image-selection-container",children:[(0,i.Y)(Nt,{htmlFor:"file-input-select-image",children:(0,i.Y)(Dt,{})}),(0,i.Y)(Bt,{id:"file-input-select-image",type:"file",multiple:!0,accept:Vt.join(","),onChange:a})]})};var Ht=n(88091),qt=n(81138),Wt=n(41664),Kt=n(79189),Zt=n(30543),Jt=n(10263);const Xt=(0,E.default)("div",{target:"eryi0zf0"})((({theme:{colors:e}})=>({display:"flex",flexDirection:"column",alignItems:"center",background:e.BGTertiary,boxShadow:"0 2px 12px rgba(0, 0, 0, .12)",borderRadius:8})),"label:DivModalPanel;"),Qt=(0,E.default)("div",{target:"eryi0zf1"})((({theme:{colors:e}})=>({position:"relative",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:24,color:e.TextPrimary,fontWeight:700,height:80,width:"100%",padding:"0 24px","::after":Object.assign({content:'""',background:e.LinePrimary2},(0,O.WB)("bottom"))})),"label:DivModalPanelHeader;"),en=(0,E.default)(Zt.A,{target:"eryi0zf2"})((({theme:{colors:e}})=>({color:e.TextSecondary,fontSize:32,cursor:"pointer"})),"label:DivModalPanelCloseBtn;"),tn=(0,E.default)("div",{target:"eryi0zf3"})({display:"flex",maxHeight:350,padding:"20px 54px",overflow:"auto"},"label:DivModalPanelBody;"),nn=(0,E.default)("div",{target:"eryi0zf4"})({width:"100%",display:"flex",flexDirection:"row",alignItems:"center",height:54,padding:"0 24px",backgroundColor:"rgba(255, 76, 58, .09)",color:"#FF4C3A",fontSize:16},"label:DivErrorTipContainer;"),an=(0,E.default)("div",{target:"eryi0zf5"})((({theme:{colors:e}})=>({position:"relative",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:16,height:80,width:"100%",padding:"0 24px","::after":Object.assign({content:'""',background:e.LinePrimary2},(0,O.WB)("top"))})),"label:DivModalPanelFooter;"),on=(0,E.default)(Jt.A,{target:"eryi0zf6"})({fontSize:20,color:"#fff",cursor:"pointer","&:hover":{opacity:.75}},"label:StyledDeleteIcon;"),rn=(0,E.default)("img",{target:"eryi0zf7"})((({hasError:e})=>({width:"100%",height:"100%",objectFit:"cover",opacity:e?.3:1})),"label:ImgImageItem;"),sn=(0,E.default)("video",{target:"eryi0zf8"})((({hasError:e})=>({width:"100%",height:"100%",objectFit:"cover",opacity:e?.3:1})),"label:VideoVideoItem;"),ln=(0,E.default)("div",{target:"eryi0zf9"})({position:"absolute",bottom:0,left:0,width:"100%",height:50,padding:"0 12px",display:"flex",justifyContent:"space-between",alignItems:"center",background:"linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, .4) 100%)"},"label:DivItemFooter;"),dn=(0,E.default)("div",{target:"eryi0zf10"})({display:"flex",justifyContent:"center",alignItems:"center",position:"relative",width:"180px",height:"180px",overflow:"hidden",borderRadius:8},"label:DivItemContent;"),cn=(0,E.default)("div",{target:"eryi0zf11"})({color:"#fff",display:"flex",alignItems:"center",fontSize:16},"label:DivItemVideoDuration;"),un=(0,E.default)("div",{target:"eryi0zf12"})((({count:e})=>({display:"grid",gridTemplateColumns:`repeat(${e<3?e||1:3}, 1fr)`,gridGap:"20px"})),"label:DivItemGrid;");var pn,gn=n(55291);!function(e){e.TooManyFiles="dm_cam_select_nine_toast",e.TooLongVideo="dm_cam_mediaTooLong_error",e.TooLargeImage="dm_cam_imageLimit_error",e.TooLargeVideo="dm_cam_videoLimit_error"}(pn||(pn={}));const hn=({file:e,hasError:t})=>{const[n,a]=(0,o.useState)(URL.createObjectURL(e.fileHandler));return(0,o.useEffect)((()=>{a(URL.createObjectURL(e.fileHandler))}),[e.fileHandler]),(0,i.Y)(rn,{src:n,alt:e.fileName,hasError:t})},mn=({file:e,hasError:t})=>{const[n,a]=(0,o.useState)(URL.createObjectURL(e.fileHandler));return(0,o.useEffect)((()=>{a(URL.createObjectURL(e.fileHandler))}),[e.fileHandler]),(0,i.Y)(sn,{src:n,duration:e.duration,hasError:t})},vn=({files:e,onAddFiles:t,onDeleteFile:n,sendMedia:a,modalRef:r})=>{var s;const l=(0,g.s)(),[d,c]=(0,o.useState)(void 0),[u,h]=(0,o.useState)(15),[m,v]=(0,o.useState)(10),[{isMediaSelectionTipShown:_},f]=(0,T.D1)((e=>({isMediaSelectionTipShown:e.isMediaSelectionTipShown}))),{user:b}=null!==(s=(0,p.W)((()=>["user"]),[]))&&void 0!==s?s:{},y=(0,o.useRef)(null),C=(0,Ht.eb)(),{toast:x}=Je(),k=(0,o.useCallback)((e=>{var n;const i=[...null!==(n=e.target.files)&&void 0!==n?n:[]];e.target.value="",i.length&&$t(i).then((e=>{t(e),e.length<i.length&&x({content:l("webCreation_uploadSingle_formatError_toast")})}))}),[t,l,x]),S=(0,o.useCallback)((()=>{C.close()}),[C]),M=(0,o.useCallback)((t=>{n(e[t],t)}),[e,n]),w=(0,o.useCallback)((e=>{27===e.keyCode&&C.close()}),[C]),I=(0,o.useCallback)((()=>{e.length&&(a(e),C.close())}),[e,a,C]),{videoFileSizeLimit:R,imageFileSizeLimit:F}=(0,gn.Q)();(0,o.useEffect)((()=>{R&&h(R),F&&v(F)}),[F,R]),(0,o.useEffect)((()=>{r.current=C}),[C,r]),(0,o.useEffect)((()=>{let t;for(const n of e){if(n.duration&&n.duration>15){t=pn.TooLongVideo;break}if(n.isVideo&&n.fileSize>1024*u*1024){t=pn.TooLargeVideo;break}if(n.fileType.startsWith("image/")&&n.fileSize>1024*m*1024){t=pn.TooLargeImage;break}}!t&&e.length>9&&(t=pn.TooManyFiles),c(t)}),[e,m,u]),(0,o.useEffect)((()=>{var e;C.isOpen&&!_&&(f.closeMediaSelectionTip(null!==(e=null==b?void 0:b.secUid)&&void 0!==e?e:""),setTimeout((()=>{x({content:l("dm_cam_upload_feature_gen_reminder_msg"),duration:6})}),500))}),[f,_,C.isOpen,l,x,null==b?void 0:b.secUid]);const D=(0,o.useCallback)((e=>{switch(e){case pn.TooManyFiles:case pn.TooLongVideo:return l(e);case pn.TooLargeVideo:return l(e,{num:`${u}`});case pn.TooLargeImage:return l(e,{num:`${m}`});default:return""}}),[m,u,l]);return(0,i.Y)("div",{onKeyDown:w,children:(0,i.Y)(Ht.nO,Object.assign(Object.assign({},C),{width:"Compact",height:"Compact",style:{backgroundColor:"transparent",borderRadius:0,margin:"48px 24px",boxShadow:"none"},children:(0,i.FD)(Xt,{children:[(0,i.FD)(Qt,{children:[(0,i.Y)("div",{children:l("dm_cam_sendMedia_header")}),(0,i.Y)(en,{onClick:S})]}),d?(0,i.FD)(nn,{children:[(0,i.Y)(qt.A,{style:{fontSize:20,marginRight:10,minWidth:20}}),(0,i.Y)("span",{children:D(d)})]}):null,(0,i.Y)(tn,{children:(0,i.FD)(un,{count:e.length,children:[!e.length&&(0,i.Y)(dn,{children:l("dm_cam_selectMediaToSend")}),e.map(((e,t)=>{const n=e.duration&&e.duration>15||e.isVideo&&e.fileSize>1024*u*1024||e.fileType.startsWith("image/")&&e.fileSize>1024*m*1024;return(0,i.FD)(dn,{children:[e.fileType.startsWith("image/")?(0,i.Y)(hn,{file:e,hasError:n}):(0,i.Y)(mn,{file:e,hasError:n}),(0,i.FD)(ln,{children:[(0,i.FD)(cn,{children:[n?(0,i.Y)(Wt.A,{style:{fontSize:20,marginRight:4}}):null,(0,i.Y)("span",{children:e.duration?new Date(1e3*e.duration).toISOString().slice(11,19):null})]}),(0,i.Y)(on,{onClick:()=>M(t)})]})]},t)}))]})}),(0,i.FD)(an,{children:[(0,i.Y)(Ht.I0,{label:l("sticker_create_add_btn"),variant:"secondary",icon:(0,i.Y)(Kt.A,{}),onClick:()=>{var e;null===(e=y.current)||void 0===e||e.click()}}),(0,i.Y)(Bt,{id:"file-input-add-image",ref:y,type:"file",multiple:!0,accept:Vt.join(","),onChange:k}),(0,i.Y)(Ht.I0,{disabled:Boolean(d)||!e.length,label:`${l("support_webapp_sharing_send_button")} (${e.length})`,variant:"primary",onClick:I})]})]})}))})};var _n=n(46682),fn=n(81230),bn=n(26456),yn=n(4408),Cn=n.n(yn);const xn=e=>(new Date).toString().slice(0,15)===e.toString().slice(0,15)?bn.Ay.format(e,"LT"):bn.Ay.format(e,"LLL"),kn=e=>Cn().unix(e).format("MMMM D, h:m A"),Sn=(0,o.memo)((function({conversation:e}){const t=(0,g.s)(),n=Number(e.banExpiryTime),a=(0,_n.w)(fn.s),r=n>0?kn(n):"";let s=e.groupOwnerCanAppealBan?t("dm_riskyGroupChat_groupSuspend_body",{s_date_time:kn(n)},"This group chat is temporarily suspended until {s_date_time} due to violations of our Community Guidelines. If you think this was a mistake, you may submit an appeal."):t("dm_riskyGroupChat_groupSuspend_noAppeal_body",{s_date_time:kn(n)},"This group is temporarily suspended until {s_date_time} due to violations of our Community Guidelines.");const l=s.indexOf(r);s=s.replace(r,"");const d=(0,o.useCallback)((()=>{window.open("https://www.tiktok.com/community-guidelines/en","_blank")}),[]),c=(0,o.useCallback)((()=>{var t,n,i,o,r,s;a.setViolationAppealInfo({objectId:null!==(n=null===(t=e.banAppealParams)||void 0===t?void 0:t.object_id)&&void 0!==n?n:"",objectType:null!==(o=null===(i=e.banAppealParams)||void 0===i?void 0:i.object_type)&&void 0!==o?o:"",punishKey:null!==(s=null===(r=e.banAppealParams)||void 0===r?void 0:r.punish_key)&&void 0!==s?s:""}),a.setVisible(!0)}),[a,e.banAppealParams]);return n<0?(0,i.Y)(i.FK,{children:(0,i.FD)(Yt,{children:[(0,i.Y)(Ht.Fm,{type:"P3-Bold",children:t("dm_riskyGroupChat_groupClosed_header",void 0,"Group closed")}),(0,i.Y)(Lt,{children:e.groupOwnerCanAppealBan?t("dm_riskyGroupChat_groupClosed_body",void 0,"This group chat is closed due to violations of our Community Guidelines. If you think this was a mistake, you may submit an appeal."):t("dm_riskyGroupChat_groupClosed_noAppeal_body",void 0,"This group chat is closed due to violations of our Community Guidelines.")}),e.groupOwnerCanAppealBan?(0,i.FD)(St,{children:[(0,i.Y)(wt,{role:"button",tabIndex:0,onClick:d,onKeyDown:d,children:t("dm_riskyGroupChat_groupClosed_viewDetail_cta",void 0,"View details")}),(0,i.Y)(Mt,{}),(0,i.Y)(wt,{isAccept:!0,role:"button",tabIndex:0,onClick:c,onKeyDown:c,children:t("dm_riskyGroupChat_groupClosed_appeal_cta",void 0,"Appeal")})]}):(0,i.Y)(St,{children:(0,i.Y)(wt,{role:"button",tabIndex:0,onClick:d,onKeyDown:d,children:t("dm_riskyGroupChat_groupClosed_viewDetail_cta",void 0,"View details")})})]})}):(0,i.Y)(i.FK,{children:(0,i.FD)(Yt,{children:[(0,i.Y)(Ht.Fm,{type:"P3-Bold",children:t("dm_riskyGroupChat_groupSuspend_header",void 0,"Group temporarily suspended")}),(0,i.FD)(Lt,{children:[s.slice(0,l),(0,i.Y)(Et,{children:r}),s.slice(l)]}),e.groupOwnerCanAppealBan?(0,i.FD)(St,{children:[(0,i.Y)(wt,{role:"button",tabIndex:0,onClick:d,onKeyDown:d,children:t("dm_riskyGroupChat_groupClosed_viewDetail_cta",void 0,"View details")}),(0,i.Y)(Mt,{}),(0,i.Y)(wt,{isAccept:!0,role:"button",tabIndex:0,onClick:c,onKeyDown:c,children:t("dm_riskyGroupChat_groupClosed_appeal_cta",void 0,"Appeal")})]}):(0,i.Y)(St,{children:(0,i.Y)(wt,{role:"button",tabIndex:0,onClick:d,onKeyDown:d,children:t("dm_riskyGroupChat_groupClosed_viewDetail_cta",void 0,"View details")})})]})})}));var Mn=n(9350),wn=n(60072),In=n(61918),Tn=n(82290),Rn=n(73551),Fn=n(43626),Dn=n(71281),Yn=n(87379),Ln=n(48712),En=n(67518),On=n(41271),An=n(96370),jn=n(10084),Un=n(25435),Pn=n(44786),zn=n(82454),Nn=n(92467),Bn=n(17566),Vn=n(52333),$n=n(53438),Gn=n(17781);const Hn=(0,E.default)("div",{target:"e1mkvjne0"})((({theme:{colors:e},loading:t,error:n,isReport:i})=>({position:"relative",width:"180px",height:"320px",borderRadius:"8px",border:"1px solid rgba(22, 24, 35, .12)",cursor:t||n||i?"default":"pointer",backgroundColor:n?e.BGView:e.BGPrimary,backgroundSize:"cover",backgroundPosition:"center center",[Jn.toString()]:{color:n?e.TextSecondary:"rgba(255, 255, 255, .9)"}})),"label:DivVideoContainer;"),qn=(0,E.default)("div",{target:"e1mkvjne1"})({display:"flex",flexDirection:"column",alignItems:"center",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"label:DivErrorMain;"),Wn=(0,E.default)("p",{target:"e1mkvjne2"})((({theme:e})=>[{width:"156px",marginTop:"12px",textAlign:"center"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P3",color:"TextSecondary"})]),"label:PDesc;"),Kn=(0,E.default)("div",{target:"e1mkvjne3"})({position:"absolute",bottom:"0",left:"0",width:"180px",height:"72px",borderRadius:"0 0 8px 8px",background:"linear-gradient(180deg, rgba(22, 24, 35, 0.0001) 2.92%, rgba(22, 24, 35, .5) 98.99%)"},"label:DivAuthorOutsideContainer;"),Zn=(0,E.default)("div",{target:"e1mkvjne4"})({position:"absolute",display:"flex",bottom:"12px",left:"12px",right:"12px"},"label:DivAuthorInnerContainer;"),Jn=(0,E.default)("p",{target:"e1mkvjne5"})((({theme:e,theme:{direction:t}})=>[{maxWidth:"124px",fontSize:"16px",lineHeight:"24px",color:"rgba(255, 255, 255, .9)"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"semiBold"}),(0,O.mp)({direction:t,marginStart:"4px"}),O.PR]),"label:PNickname;"),Xn=(0,E.default)("div",{target:"e1mkvjne6"})((({theme:{direction:e}})=>[Object.assign({position:"absolute",top:"12px",color:"#fff"},(0,Gn.I)()),(0,O.mp)({direction:e,end:"12px"})]),"label:DivPhotoIconContainer;");var Qn=n(89311),ei=n(40070),ti=n(38017),ni=n(99179),ii=n(12527),ai=n(73635),oi=n(58542);const ri=(0,E.default)("div",{target:"ediam1h0"})((({theme:{direction:e,colors:t},isReport:n,isBusinessAccount:i=!1,isFullSideNav:a=!1})=>[{zIndex:n?99999:"unset",display:"flex",flexDirection:"column",width:a||i?"100%":"728px",height:a?"100vh":"100%",background:a?oi.Tj4.UIPageFlat1:t.BGSecondary,boxShadow:a?"unset":"0 2px 8px rgba(0, 0, 0, .06)",borderRadius:"8px"},!n&&!a&&(0,O.mp)({direction:e,marginStart:"16px"})]),"label:DivChatBox;"),si=(0,E.default)("div",{target:"ediam1h1"})((({theme:{direction:e,colors:t},isReport:n})=>[{position:"relative",display:"flex",boxSizing:"border-box",width:"100%",height:n?"56px":"80px",padding:"16px 0",borderBottom:`.5px solid ${t.LineSecondary}`,boxShadow:n?"0 2px 8px rgba(0, 0, 0, .06)":"unset"},(0,O.mp)({direction:e,paddingStart:"16px"})]),"label:DivChatHeader;"),li=(0,E.default)("div",{target:"ediam1h2"})({display:"flex"},"label:DivChatHeaderContentWrapper;"),di=(0,E.default)("div",{target:"ediam1h3"})({height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},"label:DivIconContainer;"),ci=(0,E.default)("div",{target:"ediam1h4"})((({theme:{direction:e}})=>(0,O.mp)({direction:e,marginStart:"12px"})),"label:DivNameContainer;"),ui=(0,E.default)("p",{target:"ediam1h5"})((({theme:e})=>[{lineHeight:"24px",maxWidth:"640px"},O.PR,(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"semiBold",typography:"P1"})]),"label:PNickname;");ui.defaultProps=Object.assign(Object.assign({},ui.defaultProps),{"data-e2e":"chat-nickname"});const pi=(0,E.default)("p",{target:"ediam1h6"})((({theme:e})=>[(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P2",color:"TextSecondary"}),{marginTop:"2px"}]),"label:PUniqueId;");pi.defaultProps=Object.assign(Object.assign({},pi.defaultProps),{"data-e2e":"chat-uniqueid"});const gi=(0,E.default)("p",{target:"ediam1h7"})((({theme:e})=>[(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P2",color:"TextTertiary"}),{marginTop:"2px"}]),"label:PGroupSize;"),hi=(0,E.default)("div",{target:"ediam1h8"})({display:"flex",flexDirection:"column-reverse",flex:"1",overflowY:"auto",width:"100%",padding:"24px 0 16px"},"label:DivChatMain;"),mi=(0,E.default)("div",{target:"ediam1h9"})((({theme:e,isFirst:t})=>[(0,O.zy)({theme:e,fontFamily:"TikTokFont",color:"TextTertiary"}),{marginTop:t?"0":"8px",paddingTop:t?"20px":"unset",marginBottom:"8px",fontSize:"12px",lineHeight:"15px",textAlign:"center"}]),"label:DivTimeContainer;"),vi=(0,E.default)(ni.N_,{target:"ediam1h10"})({"&:hover":{textDecoration:"none"}},"label:StyledLink;"),_i=(0,E.default)("div",{target:"ediam1h11"})({display:"flex",width:"100%"},"label:DivLeftPart;"),fi=(0,E.default)("div",{target:"ediam1h12"})((({theme:{direction:e}})=>[{marginTop:"3px",cursor:"pointer",transform:"rtl"===e?"rotateY(180deg)":"unset"},(0,O.mp)({direction:e,marginStart:"7px"})]),"label:DivBackIconContainer;"),bi=(0,E.default)(ii.A,{target:"ediam1h13"})({width:"18px",height:"18px"},"label:StyledChevronLeftOffset;"),yi=(0,E.default)("div",{target:"ediam1h14"})((({theme:{direction:e}})=>[{position:"absolute",top:"16px",cursor:"pointer"},(0,O.mp)({direction:e,end:"20px"})]),"label:DivCloseIconContainer;"),Ci=(0,E.default)(ai.A,{target:"ediam1h15"})({width:"24px",height:"24px"},"label:StyledXMark;"),xi=(0,E.default)("div",{target:"ediam1h16"})((({theme:e,theme:{direction:t}})=>[(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"semiBold",typography:"P1"}),{flex:1,fontSize:"18px",lineHeight:"24px"},(0,O.mp)({direction:t,marginStart:"12px",marginEnd:"50px"}),O.PR]),"label:DivReportText;"),ki=(0,E.default)("span",{target:"ediam1h17"})((({theme:{colors:e,isDark:t}})=>({color:t?e.TextPrimary:"rgba(22, 24, 35, .5)"})),"label:SpanReportTitle;"),Si=(0,E.default)("span",{target:"ediam1h18"})({},"label:SpanReportReason;"),Mi=(0,E.default)("div",{target:"ediam1h19"})((({theme:e})=>({display:"flex",alignItems:"center",width:"100%",height:"66px",padding:"13px 16px",borderTop:`.5px solid ${e.colors.LineSecondary}`})),"label:DivChatBottom;"),wi=(0,E.default)("p",{target:"ediam1h20"})((({theme:e})=>[(0,O.zy)({theme:e,fontFamily:"TikTokFont",color:"TextSecondary"}),{flex:1,fontSize:"16px",lineHeight:"40px"},O.PR]),"label:PMessageSelected;"),Ii=(0,E.default)(Qe.y,{target:"ediam1h21"})((({theme:{direction:e}})=>[{width:"100px",height:"36px"},(0,O.mp)({direction:e,marginStart:"20px",marginEnd:"8px"})]),"label:StyledButtonSubmit;"),Ti=(0,E.default)("div",{target:"ediam1h22"})((({theme:{colors:e},isActive:t,isMessage:n,isDisabled:i,isFullSideNav:a})=>[{display:"flex",alignItems:"flex-start"},t?{backgroundColor:a?oi.Tj4.UIShapeNeutral4:e.BGSecondary2}:null,n?{"&:hover":{backgroundColor:a?oi.Tj4.UIShapeNeutral4:e.BGSecondary2}}:{display:"block"},i?{opacity:.35}:null]),"label:DivReportModeContainer;"),Ri=(0,E.default)(Qe.y,{target:"ediam1h24"})((({theme:{direction:e}})=>[{position:"absolute",top:"22px",height:"36px",minWidth:"154px"},(0,O.mp)({direction:e,end:"16px"})]),"label:StyledButtonContact;"),Fi=(0,E.default)("span",{target:"ediam1h25"})((({theme:{fontFamilies:e,colors:t,direction:n}})=>[{fontFamily:e.TikTokFont,fontSize:"16px",fontWeight:"600",lineHeight:"24px",color:t.TextPrimary},(0,O.mp)({direction:n,marginStart:"6px"})]),"label:SpanContactText;"),Di=(0,E.default)("div",{target:"ediam1h26"})({},"label:DivChatMainContent;");var Yi=n(54731),Li=n(38030),Ei=n(34034),Oi=n(68512);const Ai=({message:e,isMyself:t,reactingFlag:n,currentReaction:a})=>{var r;const[s,l]=(0,o.useState)(!1),{user:d}=null!==(r=(0,p.W)((()=>["user"]),[]))&&void 0!==r?r:{},{users:c}=(0,R.EL)((e=>e)),{reactionCountList:u,reactionList:g}=(0,o.useMemo)((()=>{var t,n;const i={},a={},o=Object.keys(e.property);if(0===o.length||!(null===(t=e.property["e:love"])||void 0===t?void 0:t.length))return{};a["e:love"]={count:e.property["e:love"].length,latestCreateTime:e.property["e:love"][0].createTime,hasMyReaction:!1,emoji:""},e.property["e:love"].forEach((e=>{i[e.userId]={reaction:e,emoji:""}})),o.forEach((t=>{if("e:love"===t||"e:"===t)return;const n=t.split(":")[1],o=e.property[t];a["e:love"]=Object.assign(Object.assign({},a["e:love"]),{count:a["e:love"].count-o.length}),a[t]={emoji:n,count:o.length,latestCreateTime:o[0].createTime,hasMyReaction:void 0!==e.property[t].find((e=>e.userId===(null==d?void 0:d.uid)))},o.forEach((e=>{e.createTime>a[t].latestCreateTime&&(a[t].latestCreateTime=e.createTime),i[e.userId]={reaction:e,emoji:n}}))})),e.property["e:love"].forEach((e=>{i[e.userId].reaction===e&&e.createTime>a["e:love"].latestCreateTime&&(a["e:love"].latestCreateTime=e.createTime,""===i[e.userId].emoji&&(a["e:love"].hasMyReaction=!0))})),null===(n=e.property["e:"])||void 0===n||n.forEach((e=>{i[e.userId]&&e.createTime>a["e:love"].latestCreateTime&&(a["e:love"].latestCreateTime=e.createTime,""===i[e.userId].emoji&&(a["e:love"].hasMyReaction=!0))}));const r=(null==d?void 0:d.uid)&&i[d.uid];r&&delete i[d.uid];const s=Object.values(i).sort(((e,t)=>t.reaction.createTime.getTime()-e.reaction.createTime.getTime()));return r&&s.unshift(r),{reactionCountList:Object.values(a).filter((({count:e})=>e>0)).sort(((e,t)=>e.hasMyReaction?-1:t.hasMyReaction?1:e.count===t.count?t.latestCreateTime.getTime()-e.latestCreateTime.getTime():t.count-e.count)),reactionList:s}}),[e.property]),h=(0,o.useCallback)((()=>{n.current=!1}),[n]);return(null==u?void 0:u.length)&&(null==g?void 0:g.length)?(0,i.Y)(oi.nb1,{open:s,onOpenChange:l,noArrow:!1,placement:"top",style:{width:330,maxHeight:225,overflowY:"auto"},trigger:(0,i.Y)(Ln.AG,{isMyself:t,tabIndex:0,children:u.map((({emoji:e,count:t,hasMyReaction:o})=>(0,i.FD)(Ln.h6,{children:[(0,i.Y)(Ln.yC,{animate:!!(null==a?void 0:a.includes(e))&&o&&n.current,onAnimationEnd:h,children:e}),t>1&&(0,i.Y)("span",{children:t})]},e)))},e.clientId),children:g.map((({reaction:e,emoji:t})=>{const{avatarThumb:n,nickname:a}=(null==c?void 0:c[e.userId])||{},o=(null==d?void 0:d.uid)===e.userId?null==d?void 0:d.avatarUri[0]:n;return(0,i.Y)(Ln.kT,{role:"menuitem",children:(0,i.Y)(oi.KhS,{role:"button",tabIndex:0,style:{width:"100%",height:56,padding:"0px 8px 0px 16px"},children:(0,i.FD)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,i.Y)(I.e,{src:o,size:40,style:{flexShrink:0},alt:""}),(0,i.Y)(oi.rxD,{gap:"2px",direction:"column",style:{width:"100%"},children:(0,i.Y)(oi.Fm,{as:"div",size:14,weight:"medium",truncate:!0,children:a})}),(0,i.Y)("span",{style:{display:"flex",alignItems:"center",padding:"0px 14px",fontSize:24},children:t})]})})},e.userId)}))},e.clientId):null};var ji,Ui=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};!function(e){e.Actions="Actions",e.Reply="Reply",e.Reaction="Reaction",e.More="More"}(ji||(ji={}));const Pi=["","","","","","","","","","","",""],zi=(0,o.memo)((function({message:e,shouldShowSenderUserName:t=!1,shouldShowSenderAvatar:n,onReport:a}){var r,s,l;const d=(0,Dn.d)("web_dm_quote_message"),c="v2"===(0,Dn.d)("web_dm_message_reaction"),u=(0,g.s)(),{user:h}=null!==(r=(0,p.W)((()=>["user"]),[]))&&void 0!==r?r:{},[_,f]=(0,o.useState)(new Set),y=(0,o.useCallback)((e=>{f((t=>{const n=new Set(t);return n.add(e),n}))}),[]),C=(0,o.useCallback)((e=>{f((t=>{const n=new Set(t);return n.delete(e),n}))}),[]),x=(0,o.useCallback)((()=>{f(new Set)}),[]),S=(0,o.useRef)(null),M=(0,o.useRef)(null),{selectedConversation:w,failedMessageMap:T}=(0,b.by)((e=>({selectedConversation:e.selectedConversation,failedMessageMap:e.failedMessageMap}))),F=(0,b.Yl)(),{chatMode:D}=(0,m.g9)((e=>({chatMode:e.chatMode})),v.bN),{toParticipantUserId:Y,isStrangerConversation:L,inboxType:E}=null!=w?w:{},O=e.sender,A=e.sender===(null==h?void 0:h.uid),j=Boolean(T[e.clientId]),U=null===(s=e.property["e:love"])||void 0===s?void 0:s.some((e=>e.userId===(null==h?void 0:h.uid)));let P=U?Object.keys(e.property).filter((t=>{var n;return"e:love"!==t&&!!(null===(n=e.property[t])||void 0===n?void 0:n.some((e=>e.userId===(null==h?void 0:h.uid))))}))[0]:void 0;!P&&U&&(P="e:");const{uniqueId:z="",avatar:N,nickname:B}=Wa((null==w?void 0:w.isGroupChat)?O:Y,A),V=(0,k.fJR)({uniqueId:z}),{handleReport:$,handleDeleteMessage:G,handleReactToMessage:H,handleLikeMessage:q}=Ka({message:e,messageText:e.content,conversation:w,isLiked:U,currentReaction:P}),{content:W,contentHtml:K,isDefault:Z}=function(e,t,n,a){const r=(0,g.s)(),{enableMultimediaMessage:s}=(0,gn.Q)();return(0,o.useMemo)((()=>{var l,d,c,u,p,g,h,m,v,_;let f={};try{e.content&&"placeholder"!==e.content&&(f=JSON.parse(e.content))}catch(e){console.error(e)}let b=!1,y="",C=null;const x=()=>{b=!0,y=`[${r("webdm_message_not_supported")}]`,C=(0,i.Y)(Ln.Mm,{children:(0,i.Y)(Ln.mI,{children:y})})};switch(e.type){case 1:y=f.tips,C=(0,i.Y)(Ln.Ro,{children:y});break;case 1031:const b=f.aweType,S=f.max_display_subject_users,M=f.max_display_object_users;let w,I,T;switch(void 0===f.subject_users&&(f.subject_users=[]),void 0===f.object_users&&(f.object_users=[]),b){case 103101:y=r("group_chat_76_notice_create_group",void 0,"%s created the group"),w=f.subject_users.slice(0,Math.min(f.subject_users.length,S)),T={"%s":(0,i.Y)(i.FK,{children:w.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))})},C=(0,Yn.s)(new RegExp("%s"),y,T);break;case 103102:y=r("group_chat_84_notice_remove_user",void 0,"%1$s removed %2$s"),w=f.subject_users.slice(0,Math.min(f.subject_users.length,S)),I=f.object_users.slice(0,Math.min(f.object_users.length,M)),T={"%1$s":(0,i.Y)(i.FK,{children:w.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))}),"%2$s":(0,i.Y)(i.FK,{children:I.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==I.length-1&&(0,i.Y)("span",{children:","})]})}))})},C=(0,Yn.s)(new RegExp(/(\%[1|2]\$s)/g),y,T);break;case 103103:y=r("group_chat_85_notice_become_admin",void 0,"%s became group admin"),w=f.subject_users.slice(0,Math.min(f.subject_users.length,S)),T={"%s":(0,i.Y)(i.FK,{children:w.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))})},C=(0,Yn.s)(new RegExp("%s"),y,T);break;case 103104:y=r("group_chat_87_notice_user_left_group",void 0,"%s left the group"),w=f.subject_users.slice(0,Math.min(f.subject_users.length,S)),T={"%s":(0,i.Y)(i.FK,{children:w.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))})},C=(0,Yn.s)(new RegExp("%s"),y,T);break;case 103105:y=r("group_chat_77_notice_add_member",void 0,"%1$s added %2$s to this group"),w=f.subject_users.slice(0,Math.min(f.subject_users.length,S)),I=f.object_users.slice(0,Math.min(f.object_users.length,M)),T={"%1$s":(0,i.Y)(i.FK,{children:w.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))}),"%2$s":(0,i.FD)(i.FK,{children:[(0,i.Y)(i.FK,{children:I.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==I.length-1&&(0,i.Y)("span",{children:","})]})}))}),f.object_users.length>2?(0,i.Y)("span",{children:r("group_chat_more_members",void 0,"%1$s and %2$s more members").replace("%1$s","").replace("%2$s",String(f.object_users.length-2))}):null]})},C=(0,Yn.s)(new RegExp(/(\%[1|2]\$s)/g),y,T);break;case 103106:y=r("groupChat_chatpage_inline_changedGroupName",void 0,"%1$s changed group name to %2$s");const e=f.group_name;w=f.subject_users.slice(0,Math.min(f.subject_users.length,S)),T={"%1$s":(0,i.Y)(i.FK,{children:w.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))}),"%2$s":(0,i.Y)("span",{children:e})},C=(0,Yn.s)(new RegExp(/(\%[1|2]\$s)/g),y,T);break;case 103107:y=r("group_chat_81_notice_risk_to_group",void 0,"%s is not friends with anyone in this group. Report this user if you receive an inappropriate message (such as fraud, spam, threats, or predatory behavior)."),w=f.subject_users.slice(0,Math.min(f.subject_users.length,S)),T={"%s":(0,i.Y)(i.FK,{children:w.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))})},C=(0,Yn.s)(new RegExp("%s"),y,T);break;case 103108:y=r("groupChatSafety_groupDM_inChatLink_resetGroupDesc",void 0,"This group chat name has been reset because the original name violated our Community Guidelines."),C=(0,i.Y)(Ln.Ro,{children:y});break;case 103109:default:x();break;case 103110:case 103114:y=r("groupChatSafety_groupDM_inChatLink_reportNoticeDesc",void 0,"Your safety is our priority. If you find any inappropriate messages within the group, %s"),T={"%s":(0,i.Y)(Ln.M9,{onClick:n,children:r("groupChatSafety_groupDM_inChatLink_reportNoticeLink",void 0,"submit a report")},"report")},C=(0,Yn.s)(new RegExp("%s"),y,T);break;case 103111:y=r("groupchat_groupChat_u18_removed",void 0,"%s was removed from the group"),w=f.subject_users.slice(0,Math.min(f.subject_users.length,S)),T={"%s":(0,i.Y)(i.FK,{children:w.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))})},C=(0,Yn.s)(new RegExp("%s"),y,T);break;case 103112:let t,a,o,s,v,_,b,F;switch(w=f.subject_users,I=f.object_users,I.length){case 0:case 1:y=r("group_chat_76_notice_create_group",void 0,"%s created the group"),t=w.slice(0,Math.min(w.length,S)),T={"%s":(0,i.Y)(i.FK,{children:t.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))})},F=new RegExp(/(\%[1|2]\$s)/g);break;case 2:y=r("groupChat_chatpage_inline_creation_2More",void 0,"%1$s created this group chat and added %2$s and %3$s"),t=w.slice(0,Math.min(w.length,S)),a=(0,R.py)().getUser(I[0].uid),o=(0,k.fJR)({uniqueId:null!==(l=null==a?void 0:a.uniqueId)&&void 0!==l?l:"",secUid:I[0].sec_uid}),s=(0,R.py)().getUser(I[1].uid),v=(0,k.fJR)({uniqueId:null!==(d=null==s?void 0:s.uniqueId)&&void 0!==d?d:"",secUid:I[1].sec_uid}),T={"%1$s":(0,i.Y)(i.FK,{children:t.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))}),"%2$s":(0,i.Y)(i.FK,{children:(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:I[0].nickname})}),"%3$s":(0,i.Y)(i.FK,{children:(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:v,children:I[1].nickname})})},F=new RegExp(/(\%[1|2|3]\$s)/g);break;case 3:y=r("groupChat_chatpage_inline_creation_3More",void 0,"%1$s created this group chat and added %2$s, %3$s and %4$s"),t=w.slice(0,Math.min(w.length,S)),a=(0,R.py)().getUser(I[0].uid),o=(0,k.fJR)({uniqueId:null!==(c=null==a?void 0:a.uniqueId)&&void 0!==c?c:"",secUid:I[0].sec_uid}),s=(0,R.py)().getUser(I[1].uid),v=(0,k.fJR)({uniqueId:null!==(u=null==s?void 0:s.uniqueId)&&void 0!==u?u:"",secUid:I[1].sec_uid}),_=(0,R.py)().getUser(I[2].uid),b=(0,k.fJR)({uniqueId:null!==(p=null==_?void 0:_.uniqueId)&&void 0!==p?p:"",secUid:I[2].sec_uid}),T={"%1$s":(0,i.Y)(i.FK,{children:t.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))}),"%2$s":(0,i.Y)(i.FK,{children:(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:I[0].nickname})}),"%3$s":(0,i.Y)(i.FK,{children:(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:v,children:I[1].nickname})}),"%4$s":(0,i.Y)(i.FK,{children:(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:b,children:I[2].nickname})})},F=new RegExp(/(\%[1|2|3|4]\$s)/g);break;default:y=r("groupChat_chatpage_inline_creation_3More_plus",{num:I.length},"%1$s created this group chat and added %2$s, %3$s and %4$s and %5$d more."),t=w.slice(0,Math.min(w.length,S)),a=(0,R.py)().getUser(I[0].uid),o=(0,k.fJR)({uniqueId:null!==(g=null==a?void 0:a.uniqueId)&&void 0!==g?g:"",secUid:I[0].sec_uid}),s=(0,R.py)().getUser(I[1].uid),v=(0,k.fJR)({uniqueId:null!==(h=null==s?void 0:s.uniqueId)&&void 0!==h?h:"",secUid:I[1].sec_uid}),_=(0,R.py)().getUser(I[2].uid),b=(0,k.fJR)({uniqueId:null!==(m=null==_?void 0:_.uniqueId)&&void 0!==m?m:"",secUid:I[2].sec_uid}),T={"%1$s":(0,i.Y)(i.FK,{children:t.map(((e,t)=>{var n;const a=(0,R.py)().getUser(e.uid),o=(0,k.fJR)({uniqueId:null!==(n=null==a?void 0:a.uniqueId)&&void 0!==n?n:"",secUid:e.sec_uid});return(0,i.FD)(i.FK,{children:[(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:e.nickname}),t!==w.length-1&&(0,i.Y)("span",{children:","})]})}))}),"%2$s":(0,i.Y)(i.FK,{children:(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:o,children:I[0].nickname})}),"%3$s":(0,i.Y)(i.FK,{children:(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:v,children:I[1].nickname})}),"%4$s":(0,i.Y)(i.FK,{children:(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:b,children:I[2].nickname})}),"%5$d":(0,i.Y)("span",{children:I.length-3})},F=new RegExp(/(\%[1|2|3|4|5]\$[s|d])/g)}C=(0,Yn.s)(F,y,T)}break;case 7:y=null!==(v=f.text)&&void 0!==v?v:"";const F=/(https:\/\/(www|m|t|vm|vt)\.tiktok\.com\/)[a-zA-Z0-9#?/&=+%*~\-$@_,':;|!.[\]()]*[a-zA-Z0-9#?/&=+%*~\-$@_]/g,D=y.match(F);if(D){const{length:e}=D;let t=0,n=D.map((e=>{const n=y.slice(t).indexOf(e)+t,i=n+e.length;return t=i,[n,i]}));C=(0,i.Y)(Ln.Mm,{children:(0,i.Y)("p",{children:n.map(((t,a)=>{let r=0;return 0!==a&&(r=n[a-1][1]),(0,i.FD)(o.Fragment,{children:[(0,i.Y)("span",{children:y.slice(r,t[0])}),(0,i.Y)(Ln.TG,{target:"_blank",rel:"noopener noreferrer",href:D[a],children:D[a]}),a===e-1&&(0,i.Y)("span",{children:y.slice(t[1],y.length)})]},a)}))})})}else C=(0,i.Y)(Ln.Mm,{children:(0,i.Y)(Ln.mI,{children:y})});break;case 1039:y="",C=null;break;case 8:const{content_name:Y,content_thumb:L,itemId:E}=f,O=null===(_=null==L?void 0:L.url_list)||void 0===_?void 0:_[0];C=(0,i.Y)(Ln.GY,{isMyself:t,children:(0,i.Y)(Wi,{itemId:E,avatarUrl:O,nickname:Y,message:e})});break;case 1805:case 5:C=(0,i.Y)(Ln.GY,{isMyself:t,children:(0,i.Y)(Ki.Bn,{message:e})});break;case 1802:s&&!(null==a?void 0:a.isGroupChat)?C=(0,i.Y)(Ln.GY,{isMyself:t,children:(0,i.Y)(Ga,{type:1,message:e,isMyself:t})}):x();break;case 1803:s&&!(null==a?void 0:a.isGroupChat)?C=(0,i.Y)(Ln.GY,{isMyself:t,children:(0,i.Y)(Ga,{type:2,message:e,isMyself:t})}):x();break;case 1037:y=`[${r("dm_tcm_card_title_business_invitation")} - ${r("webdm_message_not_supported")}]`,C=(0,i.Y)(Ln.Mm,{children:(0,i.Y)(Ln.mI,{children:y})});break;default:x()}return C=(0,i.Y)(Ha,{fallback:null,children:C}),{isDefault:b,content:y,contentHtml:C}}),[e,s])}(e,A,$,w),{referenceHtml:J,referenceHeadText:X}=function(e,t,n){const a=(0,g.s)(),{isReport:r}=(0,o.useContext)(Hi),s=(0,wn.F3)(),{showBrowserMode:l}=(0,o.useContext)(Fn.g),d=(0,Dn.d)("web_dm_quote_message"),{currentMessage:{refMsgMap:c},failedVideoCodeMap:u}=(0,b.by)((e=>({currentMessage:e.currentMessage,failedVideoCodeMap:e.failedVideoCodeMap})),v.bN),{referenceInfo:p}=e;return(0,o.useMemo)((()=>{var o;if(!p||"v3"!==d)return;const{hint:g,ref_message_type:h,referenced_message_status:m,sender:v,referenced_message_id:_}=p;let f;try{f=JSON.parse(g)}catch(e){}const y=(null==f?void 0:f.refmsg_uid)||(null==v?void 0:v.toString());if(!y)return void console.error("ref message has no sender info");const C=e.sender===(null==t?void 0:t.uid),x=y===(null==t?void 0:t.uid);let k,S,M="";if(null==n?void 0:n.isGroupChat)if(C&&x)M=a("guided_reply_you_replied_yourselfNilColon",{},"You replied to yourself");else if(C&&!x){const e=(0,R.py)().getUser(y);M=a("guided_reply_you_replied_nickNilColon",{s_nickname:null==e?void 0:e.nickname},"You replied to {s_nickname}")}else if(y===e.sender){const t=(0,R.py)().getUser(e.sender);M=a("guided_reply_quoted_reply_themselvesNilColon",{s_nickname:null==t?void 0:t.nickname},"{s_nickname} replied to themselves")}else if(!C&&x){const t=(0,R.py)().getUser(e.sender);M=a("guided_reply_quoted_reply_groupNilColon",{s_nickname:null==t?void 0:t.nickname},"{s_nickname} replied to you")}else{const t=(0,R.py)().getUser(e.sender),n=(0,R.py)().getUser(y);M=a("guided_reply_nick_replied_nickNilColon",{s_nickname1:null==t?void 0:t.nickname,s_nickname2:null==n?void 0:n.nickname},"{s_nickname1} replied to {s_nickname2}")}else M=C?a("guided_reply_youReplied",{},"You replied:"):x?a("chat_optimize_repliedToYou",{},"Replied to you:"):a("chat_optimize_repliedToThemself",{},"Replied to themselves");if(4!==m&&3!==m&&1!==m||(k=(0,i.Y)(Ln.B7,{isMyself:C,children:a("im_reply_message_deleted")})),2===m&&(k=h.toString()===8..toString()?(0,i.Y)(Ln.B7,{isMyself:C,children:a("dm_chatPage_quotedCard_vidUnavailable")}):(0,i.Y)(Ln.B7,{isMyself:C,children:a("dm_chatPage_quotedCard_MessageUnavail")})),k)return{referenceHtml:k,referenceHeadText:M};try{S=JSON.parse(f.content)}catch(e){console.error("ref message content parse error",e)}switch(null==f?void 0:f.refmsg_type){case 7:try{const{text:e}=S||{};k=(0,i.Y)(Ln.B7,{isMyself:C,children:(0,i.Y)(At,{children:e})})}catch(e){console.error(e)}break;case 5:case 1805:{const e=c.get(_.toString());k=(0,i.Y)(Ln.B4,{isMyself:C,isLoading:!e,children:e&&(0,i.Y)(Ki.Bn,{message:e,isRefMsg:!0})});break}case 8:{const{itemId:e}=S||{},{video:t}=s[e]||{},n=u[e];if(n){const e=a(null!==(o=Q[n])&&void 0!==o?o:"dm_chatPage_quotedCard_vidUnavailable");k=(0,i.Y)(Ln.B7,{isMyself:C,children:(0,i.Y)(At,{children:e})});break}t||(0,b.IA)().getSingleItem(e);const d=t&&Za(t);k=(0,i.Y)(Ln.r$,{isMyself:C,isLoading:!d,style:{backgroundImage:`url(${d})`},onClick:()=>{if(r)return;const t=(0,In.Cg)().getBrowserList();(0,In.Cg)().setItemListById({list:[e]}),l({index:0,afterCloseBrowserMode:()=>(0,In.Cg)().setItemListById({list:t})})},children:(0,i.Y)(Nn.A,{fill:"white",width:24,height:24})});break}case 1803:case 1802:{if(null==n?void 0:n.isGroupChat){k=(0,i.Y)(Ln.B7,{isMyself:C,children:a("dm_chatPage_quotedCard_MessageUnavail")});break}const e=c.get(_.toString());if(!e){k=(0,i.Y)(Ln.Cy,{isMyself:C,isLoading:!0});break}const t=3===Number(e.ext["a:moderation_result"]||1),o="true"===e["a:is_violative"];k=t||o?(0,i.Y)(Ln.B7,{isMyself:C,children:a("dm_chatPage_quotedCard_MessageUnavail")}):(0,i.Y)(Ln.Cy,{isMyself:C,isLoading:!1,children:(0,i.Y)(Ga,{type:1802===(null==f?void 0:f.refmsg_type)?1:2,message:e,isMyself:C,isRefMySelf:x,isRefMsg:!0})});break}default:k=(0,i.Y)(Ln.B7,{isMyself:C,children:(0,i.Y)(At,{children:a("dm_chatPage_quotedCard_MessageUnavail")})})}return{referenceHtml:k,referenceHeadText:M}}),[e,null==p?void 0:p.referenced_message_status,s,c.size,u])}(e,h,w)||{},{noticeHtml:ee}=function({conversation:e,message:t,isMyself:n,messageText:a}){var r,s,l,d,c;let u,p,h,m,_,f;const y=(0,g.s)(),{failedMessageMap:C,moderationResultMap:x}=(0,b.by)((e=>({failedMessageMap:e.failedMessageMap,moderationResultMap:e.moderationResultMap})),v.bN),[k,S]=(0,o.useState)(Number(t.ext["a:moderation_result"]||1)),{enableMultimediaMessage:M}=(0,gn.Q)();(0,o.useEffect)((()=>{const e=x[t.serverId];e&&k!==e&&S(e)}),[t.serverId,k,x]);try{h=JSON.parse(C[t.clientId].checkMsg).status_code}catch(e){h=-1}try{({ext:u}=JSON.parse(t.content))}catch(e){u={}}try{m=JSON.parse(C[t.clientId].checkMsg),f=C[t.clientId].serverMessageId}catch(e){m={},f=""}const{handleReport:w,handleFeedback:I}=Ka({conversation:e,messageText:a,message:t,checkMsg:m,failedMessageServerId:f});if(M&&[1802,1803].includes(t.type)){if(4===k&&!n)return{noticeHtml:(0,i.Y)(Ln.th,{children:(0,i.Y)(Ln.kz,{children:y("direct_meaasge_risk_notice",{1:(0,i.Y)(Ln.M9,{onClick:w,children:y("webdm_report")},"report")})})})};if(3===k&&n)return{noticeHtml:(0,i.Y)(Ln.th,{children:(0,i.Y)(Ln.kz,{children:y("direct_meaasge_sending_ban_notice",{1:(0,i.Y)(Ln.M9,{onClick:I,children:y("dm_webappSticker_giveFeedback_feedback")},"feedback")})})})}}if(!(null==u?void 0:u.new_tips)){if(h===ie.DIRTY_WORD_ERROR_CODE){const e=y("direct_meaasge_sending_ban_feedback");let t=y("direct_meaasge_sending_ban_notice",{1:e});const n=t.indexOf(e);return t=t.replace(e,""),_=(0,i.Y)(Ln.th,{children:(0,i.FD)(Ln.kz,{children:[t.slice(0,n),(0,i.Y)(Ln.M9,{onClick:I,children:e}),t.slice(n)]})}),{noticeHtml:_}}if(h===ie.MESSAGE_VIOLATION_COMMUNITY_GUIDELINES_ERROR_CODE){const e=null===(l=null===(s=null===(r=null==m?void 0:m.status_msg)||void 0===r?void 0:r.msg_content)||void 0===s?void 0:s.template[0])||void 0===l?void 0:l.name;let t=null===(c=null===(d=null==m?void 0:m.status_msg)||void 0===d?void 0:d.msg_content)||void 0===c?void 0:c.tips;const n=t.indexOf("{{1}}");return t&&e&&n>-1?(t=t.replace("{{1}}",""),_=(0,i.Y)(Ln.th,{children:(0,i.FD)(Ln.kz,{children:[t.slice(0,n),(0,i.Y)(Ln.M9,{onClick:I,children:e}),t.slice(n)]})}),{noticeHtml:_}):{noticeHtml:null}}return{noticeHtml:null}}{const{new_tips:e,new_template:t}=u;p={tips:e,template:t}}let T="",R="",F=-1,D=p.tips;if(p.template.length){T=p.template[0].name,R=p.template[0].key;const e=`{{${R}}}`;F=D.indexOf(e),D=D.replace(e,"")}return _=(0,i.Y)(Ln.th,{children:(0,i.FD)(Ln.kz,{children:[D.slice(0,F),F>-1&&(0,i.Y)(Ln.M9,{onClick:w,children:T}),D.slice(F)]})}),{noticeHtml:n?null:_}}({conversation:w,message:e,isMyself:A,messageText:W}),te=L||3===E&&(null===(l=null==w?void 0:w.ext)||void 0===l?void 0:l.stranger)===(null==h?void 0:h.uid),ne=1===D,ae=!te&&!ne&&!j,oe=(0,o.useCallback)((e=>{if(!ae)return;const t=e.currentTarget.dataset.area;t&&y(t)}),[y,ae]),re=(0,o.useCallback)((e=>{const t=e.currentTarget.dataset.area;t&&C(t)}),[C]),se=(0,o.useCallback)((e=>Ui(this,void 0,void 0,(function*(){if(!ae)return;const t=e.currentTarget.dataset.area;if(t)switch(t){case ji.Actions:y(ji.Actions);break;case ji.Reply:y(ji.Reply)}}))),[y,ae]),le=(0,o.useCallback)((e=>Ui(this,void 0,void 0,(function*(){const t=e.currentTarget.dataset.area;t&&t===ji.Reply&&C(ji.Reply)}))),[C]),de=(0,o.useCallback)((()=>{$(),null==a||a(e)}),[$,e,a]),ce=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||q()}),[q]),ue=(0,o.useRef)(!1),pe=(0,o.useCallback)((e=>Ui(this,void 0,void 0,(function*(){if(ue.current)return;const t=`e:${e}`;ue.current=!0,yield H(t),t===P&&(ue.current=!1)}))),[H,P]),ge=(0,o.useCallback)((e=>{const t=e.currentTarget.dataset.emoji;t&&(pe(t),setTimeout((()=>{x()}),0))}),[pe,x]),he=(0,o.useCallback)((e=>{if(13===e.keyCode||32===e.keyCode){const t=e.currentTarget.dataset.emoji;if(!t)return;pe(t),setTimeout((()=>{C(ji.Reaction)}),0)}}),[pe,C]),me=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||G()}),[G]),ve=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||de()}),[de]),_e=(0,o.useCallback)((()=>{ae&&y(ji.Actions)}),[ae,y]),fe=(0,o.useCallback)((e=>{9!==e.keyCode||_.has(ji.More)||setTimeout((()=>{var e,t;(null===(t=Array.from(null===(e=S.current)||void 0===e?void 0:e.querySelectorAll("*")))||void 0===t?void 0:t.includes(document.activeElement))||x()}),0)}),[_,x]),be=(0,o.useCallback)((()=>{ne||F.setRefMessage(e)}),[e,ne,F]),ye=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||(be(),setTimeout((()=>{x()}),0))}),[be,x]),Ce=(0,o.useCallback)((e=>{var t;e?y(ji.More):(null===(t=M.current)||void 0===t||t.focus(),C(ji.More))}),[y,C]),xe=(0,o.useCallback)((e=>{var t;console.log("isOpen: ",e),e?y(ji.Reaction):(null===(t=M.current)||void 0===t||t.focus(),C(ji.Reaction))}),[y,C]);return 1===e.type||1031===e.type?(0,i.Y)(Ln.G2,{children:K}):(0,i.FD)(Ln.G2,{isReportMode:ne,ref:S,onFocus:_e,onKeyDown:fe,children:[(0,i.FD)(Ln.my,{children:[X?(0,i.Y)(Ln.IU,{isMyself:A,children:X}):t&&(0,i.Y)(vi,{to:V,target:"_blank",rel:"opener",tabIndex:-1,children:(0,i.Y)(Ln.IU,{children:B})}),J,(0,i.FD)(Ln.e$,{isMyself:A,tabIndex:0,"data-area":ji.Actions,onMouseEnter:oe,onMouseLeave:re,onFocus:se,onBlur:le,children:[n?(0,i.Y)(vi,{to:V,target:"_blank",rel:"opener",tabIndex:-1,children:(0,i.Y)(I.e,{src:N,e2eTag:"chat-avatar",alt:""})}):(0,i.Y)(Ln.kl,{}),(0,i.Y)("div",{children:K}),(0,i.Y)("div",{"data-e2e":"dm-warning",children:j&&A&&(0,i.Y)(Ln.NX,{})}),(0,i.FD)(Ln.Z5,{show:_.has(ji.Actions)||_.size>0,isMyself:A,children:[(0,i.FD)(oi.nb1,{role:"menu",trigger:(0,i.Y)(Ln.pZ,{role:"button",ref:M,tabIndex:0,"data-area":ji.More,onMouseEnter:oe,onMouseLeave:re,children:(0,i.Y)(Yi.s,{size:20})}),root:S,open:_.has(ji.More),noArrow:!1,placement:"top","data-area":ji.More,onMouseEnter:oe,onMouseLeave:re,onOpenChange:Ce,style:{position:"relative"},children:[!c&&(0,i.Y)("div",{role:"menuitem",children:(0,i.Y)(oi.KhS,{leadingIcon:(0,i.Y)(Li.r,{}),onClick:q,onKeyDown:ce,role:"button",tabIndex:0,children:u(U?"webdm_unlike":"Like")})}),(0,i.Y)("div",{role:"menuitem",children:(0,i.Y)(oi.KhS,{leadingIcon:(0,i.Y)(Jt.u,{}),destructive:!0,onClick:G,onKeyDown:me,role:"button",tabIndex:0,children:u("delete")})}),!A&&(0,i.Y)(oi.KhS,{destructive:!0,leadingIcon:(0,i.Y)(Ei.Z,{}),onClick:de,onKeyDown:ve,children:u("webdm_report")}),(0,i.Y)(Ln.Mt,{})]}),"v3"===d&&(0,i.Y)(oi.N0Y,{content:(0,i.Y)("div",{style:{fontSize:"14px"},children:u("im_reply")}),variant:"secondary",hideIndicator:!1,visible:_.has(ji.Reply),children:(0,i.Y)(Ln.pZ,{tabIndex:0,role:"button","data-area":ji.Reply,onClick:be,onKeyDown:ye,onFocus:se,onBlur:le,onMouseEnter:oe,onMouseLeave:re,children:(0,i.Y)(Oi.B,{size:20})})}),c&&!Z&&(0,i.Y)(oi.Xwo,{trigger:(0,i.Y)(Ln.pZ,{tabIndex:0,role:"button","data-area":ji.Reaction,onMouseEnter:oe,onMouseLeave:re,children:(0,i.Y)(oi.TIk,{size:"20"})}),root:S,style:{position:"relative"},"data-area":ji.Reaction,open:_.has(ji.Reaction),onMouseEnter:oe,onMouseLeave:re,onOpenChange:xe,children:(0,i.FD)(Ln.N3,{children:[Pi.map((e=>(0,i.Y)(Ln.oK,{selected:P===`e:${e}`,children:(0,i.Y)(Ln.T1,{tabIndex:0,"data-emoji":e,onClick:ge,onKeyDown:he,children:e})},e))),(0,i.Y)(Ln.Mt,{})]})})]})]}),c&&(0,i.Y)(Ai,{message:e,isMyself:A,currentReaction:P,reactingFlag:ue},e.clientId)]}),e.property["e:love"]&&!c&&(0,i.FD)(Ln._T,{isMyself:A,isReportMode:ne,tabIndex:0,children:[(0,i.Y)(ti.A,{className:"icon-like",width:18,height:18}),e.property["e:love"].map((e=>{const t=(0,R.py)().getUser(e.userId);return(0,i.Y)(Ln.dl,{src:e.userId===(null==h?void 0:h.uid)?null==h?void 0:h.avatarUri[0]:null==t?void 0:t.avatarThumb,size:17},e.userId)}))]}),ee]})}));var Ni=n(42617);const Bi=(0,E.default)("div",{target:"e6avghz0"})((({isFullSideNav:e})=>({zIndex:99999,width:e?"100%":"unset","& .modal-like-focus-locker":{height:"100%"}})),"label:DivFocusLockerWrapper;"),Vi=(0,E.default)("div",{target:"e6avghz1"})((({theme:{direction:e}})=>[(0,O.mp)({direction:e,marginStart:"16px"})]),"label:DivContentWrapper;"),$i=(0,o.memo)((function({autoFocus:e=!1,returnFocus:t=!0,children:n,id:a,manualReturnFocusId:r,ariaLabelledby:s,onKeyDown:l}){const d=(0,u.rl)(),c=(0,o.useRef)(null),p=(0,o.useRef)(!1);(0,o.useEffect)((()=>{e&&setTimeout((()=>{var e;null===(e=c.current)||void 0===e||e.focus()}),0)}),[e]);const g=(0,o.useCallback)((e=>{var t;null==l||l(e),p.current||9!==e.keyCode||(null===(t=c.current)||void 0===t||t.setAttribute("tabindex","-1"),p.current=!0)}),[l]),h=(0,o.useCallback)((()=>{r&&setTimeout((()=>{var e;null===(e=document.querySelector(`#${r}`))||void 0===e||e.focus()}),0)}),[r]);return(0,i.Y)(Bi,{isFullSideNav:d,children:(0,i.Y)(Ni.Ay,{autoFocus:!0,returnFocus:t,className:"modal-like-focus-locker",onDeactivation:h,children:(0,i.Y)(Vi,{id:a,tabIndex:0,className:"modal-like-focus-locker",ref:c,onKeyDown:g,role:"dialog","aria-modal":!0,"aria-labelledby":s,children:n})})})}));var Gi=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const Hi=(0,o.createContext)({isReport:!1}),qi=(0,o.memo)((function({reportMessageId:e}){var t,n;const a=(0,u.rl)(),r=(0,g.s)(),{user:s,region:l="",appId:d=1988,abTestVersion:c}=null!==(t=(0,p.W)((()=>["region","user","appId","abTestVersion"]),[]))&&void 0!==t?t:{},[{selectedReportReasons:h,isUsingV3Reasons:_},f]=(0,m.Ks)((e=>({selectedReportReasons:e.selectedReportReasons,isUsingV3Reasons:e.isUsingV3Reasons})),v.bN),[{selectedConversation:y,currentMessage:{list:C},isLoadingMoreMessage:x,currentMessage:k,failedMessageMap:M,recordedFocusOrigin:w},I]=(0,b.VI)((e=>({selectedConversation:e.selectedConversation,currentMessage:e.currentMessage,isLoadingMoreMessage:e.isLoadingMoreMessage,failedMessageMap:e.failedMessageMap,recordedFocusOrigin:e.recordedFocusOrigin})),v.bN),{shortId:T,toParticipantUserId:R=""}=null!=y?y:{},[F,D]=(0,o.useState)({}),[Y,L]=(0,o.useState)(0),E=(0,o.useRef)(0),{isRTL:O}=(0,Qn.m)();(0,o.useEffect)((()=>{e&&(D({[e]:!0}),L(1))}),[e]);const A=(0,S._g)((e=>Gi(this,void 0,void 0,(function*(){if(!e.currentTarget||!k.hasMore||x)return;const t=e.currentTarget.scrollTop||1e3;(e.currentTarget.scrollHeight||0)-(e.currentTarget.offsetHeight||0)+t<1e3&&E.current>t&&(yield I.loadMoreMessage({conversation:y,abTestVersion:c})),E.current=t}))),[y,I,k.hasMore,x],100),j=(0,o.useCallback)((()=>{f.setChatMode(0),f.setIsShowReportSelectModal(!0)}),[f]),U=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||j()}),[j]),P=(0,o.useCallback)((()=>{f.setChatMode(0)}),[f]),z=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||P()}),[P]),N=(0,o.useCallback)((e=>()=>{D(Object.assign(Object.assign({},F),{[e]:!F[e]})),L(F[e]?Y-1:Y+1)}),[F,Y]),B=(0,o.useCallback)((()=>Gi(this,void 0,void 0,(function*(){if(!Y)return;const e=[];Object.keys(F).forEach((t=>{F[t]&&e.push(t)}));const t={reason:_?h[h.length-1].reason_code:h[h.length-1].reason_type,report_type:"im",object_id:T,owner_id:R,msg_list:e.join(","),target:T,reporter_id:null==s?void 0:s.uid,current_region:l,aid:d,app_name:"tiktok_web"};yield f.postReport(t)}))),[F,Y,h,T,R,s,l,d,f]),V=(0,o.useCallback)((()=>{let e=0===Y||1===Y?r("webdm_report_01_message_selected",{X:String(Y)}):r("webdm_report_n_message_selected",{X:Y});return e=e.replace(String(Y),`<span ${50===Y?'style="color: #ff4c3a;"':""}>${Y}/50</span>`),e}),[Y,r]),$=(0,o.useCallback)((e=>{27===e.keyCode&&P()}),[P]);return(0,i.Y)(Hi.Provider,{value:{isReport:!0},children:(0,i.Y)($i,{manualReturnFocusId:w,ariaLabelledby:"messages-report-detail-modal-header",onKeyDown:$,children:(0,i.FD)(ri,{isReport:!0,isFullSideNav:a,children:[(0,i.FD)(si,{isReport:!0,children:[(0,i.FD)(_i,{children:[(0,i.Y)(fi,{tabIndex:0,role:"button",onClick:j,onKeyDown:U,"aria-label":r("Back"),children:(0,i.Y)(bi,{})}),(0,i.FD)(xi,{"data-e2e":"dm-report-title",id:"messages-report-detail-modal-header",children:[(0,i.FD)(ki,{children:[r("Report_reason"),": "]}),(0,i.Y)(Si,{children:null===(n=h[0])||void 0===n?void 0:n.text}),h[1]&&(0,i.FD)(i.FK,{children:[(0,i.Y)(Si,{className:"report-reason",children:" / "}),(0,i.Y)(Si,{className:"report-reason",children:h[1].text})]})]})]}),(0,i.Y)(yi,{tabIndex:0,role:"button",onClick:P,onKeyDown:z,children:(0,i.Y)(Ci,{"aria-hidden":!0})})]}),(0,i.Y)(hi,{onScroll:A,children:(0,i.Y)(Di,{children:C.map(((e,t)=>{const{type:n,clientId:r,serverId:s}=e,l=M[r];if(49999===e.type||l)return null;const d=C[t-1],c=!d||Number(e.createdAt)-Number(d.createdAt)>3e5,u=xn(e.createdAt),p=50===Y&&!F[s];return(0,i.FD)(o.Fragment,{children:[(0,i.FD)(Ti,{isActive:F[s],isMessage:1!==n,isDisabled:p,"data-e2e":"dm-report-message",isFullSideNav:a,children:[1!==n&&(0,i.Y)(ei.S,{value:Boolean(F[s]),size:24,disabled:p,isCircle:!1,style:{marginTop:"12px",marginLeft:O?"-18px":"16px",marginRight:O?"16px":"-18px"},e2eTag:"dm-report-message-check",onChange:N(s)}),(0,i.Y)(zi,{message:e})]}),c&&(0,i.Y)(mi,{isFirst:!d,children:u})]},r)}))})}),(0,i.FD)(Mi,{children:[(0,i.Y)(wi,{dangerouslySetInnerHTML:{__html:V()}}),(0,i.Y)(Ii,{size:"small",buttonTheme:"primary",disabled:0===Y,className:"submit-button","data-e2e":"dm-report-submit",onClick:B,children:r("Submit")})]})]})})})})),Wi=(0,o.memo)((function({message:e,itemId:t,nickname:n,avatarUrl:a}){var r;const s=(0,g.s)(),{isReport:l}=(0,o.useContext)(Hi),d=(0,Bn._u)(),{failedVideoCodeMap:c,itemListByMessageId:u}=(0,b.by)((e=>({failedVideoCodeMap:e.failedVideoCodeMap,itemListByMessageId:e.itemListByMessageId})),v.bN),p=(0,On.P)(Vn.k)[t],{video:m,avatarThumb:_}=(0,o.useMemo)((()=>null!=p?p:{}),[p]),{showBrowserMode:f}=(0,o.useContext)(Fn.g),y=c[t],C=!p&&!y,x=(0,h.Ig)(),k=((e,t,n=!1,i=!0)=>{const{zoomCover:a,cover:r="",dynamicCover:s}=e,l=null==a?void 0:a[null!=t?t:"720"],d=()=>{const{supportWebp:e,supportAvif:t}=(0,Tn.PD)(),i=(0,Rn.G)(l);return n&&s&&(1!==(0,Rn.G)(s)||e)?s:!l||1===i&&!e||2===i&&!t?r:l},[c,u]=(0,o.useState)(i?n&&s?s:l||r:d());return(0,o.useEffect)((()=>{u(d())}),[e]),c})(null!=m?m:{},"480",!1,!1),S=(0,o.useCallback)((()=>{if(C||l)return;if(x){const e=`https://www.tiktok.com${d(p)}`;return void window.open(e)}const t=u.indexOf(e.clientId);f({index:t,forceUseIndexLocation:!0})}),[e,u,f,C,l,x,p]),M=(0,o.useCallback)((e=>()=>{Be.F.destroy(),203005!==y?Be.F.open({content:e,duration:3,widthType:"half"}):Be.F.open({content:s("subVideo_nonsubs_webToast"),duration:3,widthType:"half"})}),[y,s]),w=null==p?void 0:p.isContentClassified,T=(0,$n.mx)(p),{colors:R}=(0,En.u)();if(y){const e=s(null!==(r=Q[y])&&void 0!==r?r:W),t=10239===y?Un.A:Pn.A;return(0,i.FD)(Hn,{error:!0,onClick:M(e),children:[(0,i.FD)(qn,{children:[(0,i.Y)(t,{width:40,height:40,fill:R.TextQuaternary}),(0,i.Y)(Wn,{children:e})]}),(0,i.FD)(Zn,{children:[(0,i.Y)(I.e,{size:24,src:a}),(0,i.Y)(Jn,{children:n})]})]})}if(w){const e=s(W);return(0,i.Y)(Hn,{error:!0,onClick:M(s("cc_webapp_age_video_details_body")),children:(0,i.FD)(qn,{children:[(0,i.Y)(An.A,{fontSize:40,color:R.TextQuaternary}),(0,i.Y)(Wn,{children:e})]})})}return(0,i.FD)(Hn,{loading:C,isReport:l,style:{backgroundImage:`url(${k})`},onClick:S,children:[C?(0,i.Y)(zn.A,{width:140,height:140,fill:"rgba(22, 24, 35, 0.06)",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}):(0,i.Y)(Nn.A,{fill:"white",width:32,height:32,style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}),(0,i.Y)(Kn,{children:(0,i.FD)(Zn,{children:[(0,i.Y)(I.e,{size:24,src:_}),(0,i.Y)(Jn,{children:n})]})}),T&&(0,i.Y)(Xn,{children:(0,i.Y)(jn.N,{size:20})})]})}));var Ki=n(46522);const Zi=(0,E.default)("div",{target:"ek7cw3r0"})((({theme:e,aspectRatio:t,isRefMsg:n})=>{let i,a;return!t||t<1?(i=180,a=320):t<1.2?(i=180,a=160):(i=260,a=180),n&&(i/=2,a/=2),{width:i,height:a,position:"relative",borderRadius:"8px",overflow:"hidden",backgroundSize:"cover",backgroundPosition:"center center",backgroundColor:e.colors.UIShapeNeutral4,cursor:"pointer"}}),"label:DivImageVideoMessageContainer;"),Ji=(0,E.default)(Ht.DA,{target:"ek7cw3r1"})((({theme:e})=>[{position:"fixed",top:20,left:24,color:e.colors.ConstTextInverse,backgroundColor:e.colors.ConstBGInverse4,zIndex:999999}]),"label:ButtonModalClose;");var Xi,Qi=n(99372),ea=n(49473);!function(e){e[e.FileHandler=0]="FileHandler",e[e.PictureCard=1]="PictureCard",e[e.VideoCard=2]="VideoCard",e[e.InModeration=-1]="InModeration",e[e.Fallback=-2]="Fallback"}(Xi||(Xi={}));const ta=e=>{var t,n,i,a,o,r,s,l;const d=e,c=d.fileInfo,u=null==c?void 0:c.fileHandler,p=null===(t=d.contentPb)||void 0===t?void 0:t.picture_card,g=null===(n=d.contentPb)||void 0===n?void 0:n.video_card,h=null==p?void 0:p.thumbnail,m=null==p?void 0:p.image,v=null==g?void 0:g.video;let _,f,b,y="",C="";if(u)_=Xi.FileHandler,c.imagePreviewWidth&&c.imagePreviewHeight?(f=c.imagePreviewWidth,b=c.imagePreviewHeight):c.imageThumbWidth&&c.imageThumbHeight?(f=c.imageThumbWidth,b=c.imageThumbHeight):(f=Number(null===(i=d.fileInfo.ext)||void 0===i?void 0:i["s:file_ext_key_video_width"]),b=Number(null===(a=d.fileInfo.ext)||void 0===a?void 0:a["s:file_ext_key_video_height"])),y=URL.createObjectURL(u);else if(null===(o=null==m?void 0:m.url_list)||void 0===o?void 0:o.length){_=Xi.PictureCard;const{resolution:e}=m;f=Number(null==e?void 0:e.width),b=Number(null==e?void 0:e.height)}else if(null===(s=null===(r=null==v?void 0:v.cover)||void 0===r?void 0:r.url_list)||void 0===s?void 0:s.length){_=Xi.VideoCard;let{resolution:e}=v.cover;(null==e?void 0:e.width)&&e.height||({resolution:e}=v),f=Number(null==e?void 0:e.width),b=Number(null==e?void 0:e.height),C=v.cover.url_list[0]}else if(1===Number(d.ext["a:moderation_result"]))if(_=Xi.InModeration,null==m?void 0:m.resolution){const{resolution:e}=m;f=Number(e.width),b=Number(e.height)}else f=180,b=320;else _=Xi.Fallback,f=180,b=320;const x={imageSource:_,width:f,height:b,aspectRatio:f/b||.5625,blobUrl:y,src:C};let k;if(_===Xi.FileHandler)k=x;else if(null===(l=null==h?void 0:h.url_list)||void 0===l?void 0:l.length){let{resolution:e}=h;(null==e?void 0:e.width)&&e.height||!m||({resolution:e}=m);const t=Number(null==e?void 0:e.width),n=Number(null==e?void 0:e.height);k={imageSource:Xi.PictureCard,width:t,height:n,aspectRatio:t/n||.5625,blobUrl:y,src:C}}else k=x;return{imageInfo:x,thumbnailInfo:k}},na=e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%60);return`${t>0?`${t.toString().padStart(2,"0")}:`:""}${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`};var ia=n(50383),aa=n(52417),oa=n(4828),ra=n(83609);const sa=(0,E.default)("div",{target:"egh7xcb0"})((({multimediaStyle:e})=>({position:"relative",width:"100%",height:"100%",overflow:"hidden","& #multimedia_standard":Object.assign({},e)})),"label:DivVideoContainer;"),la=(0,E.default)("div",{target:"egh7xcb2"})((({isVisible:e})=>({position:"absolute",bottom:0,left:0,right:0,height:"70px",backgroundImage:"linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 1))",alignItems:"center",opacity:e?"1":"0",transition:"opacity 0.5s",display:"flex",flexDirection:"column"})),"label:DivControlsContainer;"),da=(0,E.default)("div",{target:"egh7xcb3"})({display:"flex",flexDirection:"row",alignItems:"center",width:"100%",height:"45px"},"label:DivControlMenu;"),ca=(0,E.default)("div",{target:"egh7xcb4"})((({theme:{direction:e}})=>[{display:"flex",justifyContent:"center",alignItems:"center",width:35,height:35,minWidth:35,cursor:"pointer",position:"relative","&:hover > span":{backgroundColor:"rgba(40, 40, 40, 0.8)"}},(0,O.mp)({direction:e,marginStart:12})]),"label:DivPlayPauseButton;"),ua=(0,E.default)("span",{target:"egh7xcb5"})({display:"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",transition:"background-color 0.2s"},"label:SpanPauseButtonBackground;"),pa=(0,E.default)(ia.A,{target:"egh7xcb6"})((({theme:e})=>({color:e.colors.ConstTextInverse,fontSize:"20px",zIndex:2})),"label:IconPlay;"),ga=(0,E.default)(aa.A,{target:"egh7xcb7"})((({theme:e})=>({color:e.colors.ConstTextInverse,fontSize:"20px",zIndex:2})),"label:IconPause;"),ha=(0,E.default)("div",{target:"egh7xcb8"})((({theme:{direction:e}})=>[{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"center",position:"absolute",backgroundColor:"rgba(40, 40, 40, 0.8)",borderRadius:"20px",transition:"background-color 0.2s"},(0,O.mp)({direction:e,end:12})]),"label:DivVolumeContainer;"),ma=(0,E.default)("div",{target:"egh7xcb9"})({width:"35px",height:"35px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer"},"label:DivVolumeButton;"),va=(0,E.default)("div",{target:"egh7xcb10"})({width:"85px",height:"35px",position:"relative",transition:"transform 0.2s",transformOrigin:"right center"},"label:DivVolumeProgressBarContainer;"),_a=(0,E.default)("div",{target:"egh7xcb11"})({display:"flex",flexDirection:"column",alignItems:"center",width:"100%",height:"25px"},"label:DivProgressBarContainer;"),fa=(0,E.default)("div",{target:"egh7xcb12"})({width:"100%",height:"100%",display:"flex",cursor:"pointer",padding:"0 16px",boxSizing:"border-box",userSelect:"none"},"label:DivProgressBar;"),ba=(0,E.default)("div",{target:"egh7xcb13"})({width:"100%",height:"4px",backgroundColor:"rgb(180, 180, 180)",position:"relative"},"label:DivTotalProgress;"),ya=(0,E.default)("div",{target:"egh7xcb14"})((({progress:e,isRTL:t})=>({width:`${e}%`,height:"100%",backgroundColor:"white",borderTopLeftRadius:0===e||100===e?0:t?2:0,borderBottomLeftRadius:0===e||100===e?0:t?2:0,borderTopRightRadius:0===e||100===e||t?0:2,borderBottomRightRadius:0===e||100===e||t?0:2})),"label:DivCurrentProgress;"),Ca=(0,E.default)("div",{target:"egh7xcb15"})((({totalProgressWidth:e,currentProgressWidth:t,isDisplayed:n,theme:{direction:i}})=>({width:"12px",height:"12px",backgroundColor:"rgba(255, 255, 255, 1)",borderRadius:"50%",position:"absolute",top:"-4px",["rtl"===i?"right":"left"]:`${Math.max(-6,Math.min(e-6,t-6))}px`,transition:"opacity 0.2s",opacity:n?"1":"0"})),"label:DivCurrentProgressButton;"),xa=(0,E.default)("div",{target:"egh7xcb16"})((({position:e,isVisible:t})=>[{width:6,height:4,borderTopLeftRadius:"left"===e?2:0,borderBottomLeftRadius:"left"===e?2:0,borderTopRightRadius:"left"===e?0:2,borderBottomRightRadius:"left"===e?0:2,backgroundColor:t?"white":"rgb(180, 180, 180)"}]),"label:DivProgressEdgePlaceholder;"),ka=(0,E.default)("div",{target:"egh7xcb17"})((({theme:{direction:e}})=>[{color:"#fff",fontSize:"14px",whiteSpace:"nowrap"},(0,O.mp)({direction:e,marginStart:10})]),"label:DivTimeInfo;"),Sa=(0,E.default)(oa.A,{target:"egh7xcb18"})((({theme:e})=>({color:e.colors.ConstTextInverse,fontSize:"20px"})),"label:IconSpeaker;"),Ma=(0,E.default)(ra.A,{target:"egh7xcb19"})((({theme:e})=>({color:e.colors.ConstTextInverse,fontSize:"20px",marginRight:-1})),"label:IconMuted;");var wa=n(45009),Ia=n(5135);Ia.w_.preparePlayer(2);class Ta extends Ia.j8{constructor(){super(),this.init=()=>{this.onHook("component:didMount",(()=>{})),this.onHook("component:didUnmount",(()=>{})),this.onHook("player:available",(e=>{const t=Ia.w_.getPlayer(e);t&&t.element&&(t.element.style.width="100%",t.element.style.height="100%",t.element.style.position="relative",t.element.style.objectFit="cover",t.element.style.cursor="pointer")}))},this.init()}}const Ra=e=>{const{onDragStart:t,onDragMove:n,onDragEnd:a}=e,r=(0,o.useRef)(null),s=(0,o.useRef)(null),[l,d]=(0,o.useState)(e.progress),[c,u]=(0,o.useState)(!1),[p,g]=(0,o.useState)(!1),[h,m]=(0,o.useState)(0),[v,_]=(0,o.useState)(0),f=(0,wa.W)(),b=(0,o.useCallback)((e=>{if(!s.current)return 0;const{width:t,left:n,right:i}=s.current.getBoundingClientRect(),a=window.innerWidth;if(0===t)return-1;const o=f?a-i:n,r=f?a-e.clientX:e.clientX,l=Math.min(t,Math.max(0,r-o)),c=l/t,u=100*(c>1?1:c);return d(u),_(l),u}),[f]),y=(0,o.useCallback)((e=>{g(!0),t(l),b(e)}),[t,l,b]),C=(0,o.useCallback)((()=>{p&&(g(!1),a(l))}),[p,a,l]),x=(0,o.useCallback)((e=>{if(p){const t=b(e);if(t<0)return;n(t)}}),[p,n,b]),k=(0,o.useCallback)((()=>{u(!0)}),[]),S=(0,o.useCallback)((()=>{u(!1)}),[]);return(0,o.useEffect)((()=>{const e=s.current;if(e){const t=new ResizeObserver((e=>{for(const t of e)m(t.contentRect.width)}));return t.observe(e),()=>{t.unobserve(e)}}}),[]),(0,o.useEffect)((()=>{d(e.progress),_(e.progress/100*h)}),[e.progress,h]),(0,o.useEffect)((()=>(document.addEventListener("mousemove",x),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",C)})),[x,C]),(0,i.FD)(fa,{ref:r,onMouseDown:y,onMouseEnter:k,onMouseLeave:S,style:e.style,children:[(0,i.Y)(xa,{position:f?"right":"left",isVisible:l>0}),(0,i.FD)(ba,{ref:s,children:[(0,i.Y)(ya,{progress:l,isRTL:f}),(0,i.Y)(Ca,{isDisplayed:c||p,totalProgressWidth:h,currentProgressWidth:v})]}),(0,i.Y)(xa,{position:f?"left":"right",isVisible:100===l})]})},Fa=new Ta;Ia.Uc.install(Fa);const Da=({src:e,style:t={},videoStyle:n={},autoPlay:a=!1,initVolume:r=0,onVolumeChange:s,onContextMenu:l,onLoadedMetadata:d})=>{const[c,u]=(0,o.useState)(0),[p,g]=(0,o.useState)(!1),[h,m]=(0,o.useState)(!1),[v,_]=(0,o.useState)(!1),[f,b]=(0,o.useState)(!1),[y,C]=(0,o.useState)(!1),[x,k]=(0,o.useState)(0),S=(0,o.useRef)(!1),M=(0,o.useRef)(null),w=(0,o.useRef)(null),[I,T]=(0,o.useState)(0),[R,F]=(0,o.useState)(Math.max(0,Math.min(1,r))),[D,Y]=(0,o.useState)(.3),[L,E]=(0,o.useState)(!1),[O,A]=(0,o.useState)(!1),j=(0,wa.W)(),U=()=>{const e=M.current;e&&(e.pause(),g(!1))},P=()=>!S.current,z=()=>{M.current&&(p?P()&&U():(()=>{const e=M.current;e&&(e.play().finally((()=>{S.current=!1})),S.current=!0,g(!0))})())},N=(0,o.useCallback)((e=>{const t=M.current;t&&(t.currentTime=e/100*t.duration)}),[]),B=(0,o.useCallback)((e=>{m(p),N(e),P()&&U()}),[p,N]),V=(0,o.useCallback)((e=>{if(N(e),h){const e=M.current;e&&!p&&(e.play().finally((()=>{S.current=!1})),S.current=!0,g(!0))}}),[p,h,N]),$=(0,o.useCallback)((e=>{N(e)}),[N]);(0,o.useEffect)((()=>{const e=M.current;e&&(e.volume=R),0!==R||O?R>0&&O&&A(!1):A(!0)}),[O,R]);const G=f||y,H=v||L;return(0,o.useEffect)((()=>{var e;H||null===(e=w.current)||void 0===e||e.blur()}),[H]),(0,o.useEffect)((()=>{s&&s(R)}),[s,R]),(0,i.FD)(sa,{onMouseEnter:()=>{_(!0)},onMouseLeave:()=>{_(!1)},style:t,multimediaStyle:n,children:[(0,i.Y)(Ia.Ce,{ref:M,autoPlay:a,src:e,onPlay:()=>{g(!0);const e=M.current;e&&e.currentTime>=e.duration&&k(0)},onPause:()=>{g(!1)},onEnded:()=>{g(!1),_(!0)},onTimeUpdate:()=>{const e=M.current;if(e){const{currentTime:t}=e,n=t/e.duration;u(100*n),k(e.currentTime)}},onLoadedMetadata:e=>{T(e.currentTarget.duration),d&&d(e)},onClick:z,onContextMenu:l,style:n}),(0,i.FD)(la,{isVisible:H,children:[(0,i.FD)(da,{children:[(0,i.FD)(ca,{onClick:z,children:[(0,i.Y)(ua,{}),p?(0,i.Y)(ga,{}):(0,i.Y)(pa,{})]}),(0,i.FD)(ka,{children:[na(j?I:x)," / ",na(j?x:I)]}),(0,i.FD)(ha,{onMouseLeave:()=>{b(!1)},onFocus:()=>{C(!0)},onBlur:()=>{C(!1)},style:G?void 0:{backgroundColor:"transparent"},tabIndex:0,ref:w,children:[(0,i.Y)(va,{style:G?void 0:{transform:"scaleX(0)"},children:(0,i.Y)(Ra,{progress:100*R,onDragStart:e=>{E(!0),F(e/100)},onDragMove:e=>{L&&F(e/100)},onDragEnd:e=>{E(!1);const t=e/100;F(t),0!==t&&Y(t)},style:Object.assign(Object.assign({width:"100%",height:35,alignItems:"center"},j?{paddingLeft:2}:{paddingRight:2}),G?void 0:{opacity:0})})}),(0,i.Y)(ma,{onClick:()=>(({ignorePrevious:e=!1}={})=>{M.current&&(O?(A(!1),e||F(0===D?.3:D)):(A(!0),Y(R),F(0)))})(),onMouseEnter:()=>{b(!0)},children:0===R||O?(0,i.Y)(Ma,{}):(0,i.Y)(Sa,{})})]})]}),(0,i.Y)(_a,{children:(0,i.Y)(Ra,{progress:c,onDragStart:B,onDragMove:$,onDragEnd:V})})]})]})};var Ya=n(94893);const La=(0,E.default)("div",{target:"e8c2vut0"})((()=>[{width:100,height:100,display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer"}]),"label:DivRetry;");var Ea;!function(e){e[e.Init=0]="Init",e[e.Compatible=1]="Compatible",e[e.Incompatible=2]="Incompatible"}(Ea||(Ea={}));const Oa=({message:e})=>{const t=(0,b.Yl)(),[n]=(0,o.useState)((()=>ta(e).imageInfo)),a=(0,o.useCallback)((()=>{return t=void 0,n=void 0,a=function*(){return(0,Mn.fI)().decryptMedia({message:e})},new((i=void 0)||(i=Promise))((function(e,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}l((a=a.apply(t,n||[])).next())}));var t,n,i,a}),[e]),{imageSource:r,blobUrl:s}=n,l=(0,o.useCallback)((n=>{var i,a;const o=null===(i=e.contentPb)||void 0===i?void 0:i.picture_card,r=(null==o?void 0:o.image)||(null==o?void 0:o.thumbnail),s=(null===(a=null==r?void 0:r.url_list)||void 0===a?void 0:a[0])||"";t.handleLoadMediaFail({message:e,mediaType:1,mediaUrl:s,error:n,scene:"media_preview"})}),[t,e]);return(0,o.useEffect)((()=>{w.w.handleMediaMessageShow({media_type:1,scene:"media_preview"})}),[]),r===Xi.FileHandler||r===Xi.PictureCard?(0,i.Y)(Qi.T,{isSending:!1,moderationResult:Number(e.ext["a:moderation_result"]),type:1,decryptMedia:a,style:{minWidth:33,minHeight:33},mediaStyle:{maxHeight:"calc(100vh - 160px)"},localMediaUrl:s,onError:l}):null},Aa=({message:e})=>{var t;const[n]=(0,o.useState)((()=>ta(e).imageInfo)),[a,r]=(0,o.useState)(!0),[s,l]=(0,o.useState)(Ea.Init),[d,c]=(0,o.useState)(Date.now()),[u,g]=(0,o.useState)(0),[h,m]=(0,o.useState)(!1),[v,_]=(0,o.useState)(""),[f,y]=(0,o.useState)(""),[{lastUpdatedMap:C},x]=(0,b.VI)((e=>({lastUpdatedMap:e.lastUpdatedMap}))),[{videoPlayerVolume:k},M]=(0,T.D1)((e=>({videoPlayerVolume:e.videoPlayerVolume}))),{user:w}=null!==(t=(0,p.W)((()=>["user"]),[]))&&void 0!==t?t:{},I=(0,S._g)((e=>{var t;M.saveVideoPlayerVolume({uid:null!==(t=null==w?void 0:w.secUid)&&void 0!==t?t:"",volume:e})}),[M,null==w?void 0:w.secUid],100),R=e=>{var t,n,i;const a=null===(i=null===(n=null===(t=e.contentPb)||void 0===t?void 0:t.video_card)||void 0===n?void 0:n.video)||void 0===i?void 0:i.video_model,o=JSON.parse(a),{video_list:r}=o;return{codecType:r[0].video_meta.codec_type,mainUrl:r[0].main_url}};(0,o.useEffect)((()=>{if(n.imageSource===Xi.FileHandler)_(n.blobUrl);else if(n.imageSource===Xi.VideoCard){const{codecType:t,mainUrl:n}=R(e);y(t),_(n)}}),[n.blobUrl,n.imageSource,e]),(0,o.useEffect)((()=>{"hevc"!==f||(0,ea.AF)()?l(Ea.Compatible):l(Ea.Incompatible)}),[f]);const F=(0,o.useCallback)((()=>{x.updateMessageFromServer(e),m(!0)}),[x,e]);(0,o.useEffect)((()=>{s===Ea.Incompatible&&F()}),[s,F]),(0,o.useEffect)((()=>{const t=C[e.clientId];if(!t)return;const n=()=>{g((e=>e+1)),m(!1)};if(t.success){if(t.timestamp>d){const{codecType:i,mainUrl:a}=R(e);y(i),_(a),c(t.timestamp),n()}}else n()}),[d,C,e]),(0,o.useEffect)((()=>{if(0===u||u>=3||s!==Ea.Incompatible||h)return;const e=setTimeout((()=>{F()}),5e3);return()=>{clearTimeout(e)}}),[h,s,u,F]);const D=u<3&&(a||s!==Ea.Compatible),Y=u>=3&&s===Ea.Incompatible;return v?(0,i.FD)(i.FK,{children:[(0,i.Y)(Da,{src:v,autoPlay:!0,style:D||Y?{display:"none"}:{},videoStyle:{width:"100%",maxHeight:"calc(100vh - 160px)"},initVolume:k,onVolumeChange:I,onContextMenu:e=>e.preventDefault(),onLoadedMetadata:()=>r(!1)}),D&&(0,i.Y)(Ya.vV,{}),Y&&(0,i.Y)(La,{onClick:()=>{g(0),F()},children:(0,i.Y)(Ya.uF,{})})]}):null},ja=({mediaType:e,message:t})=>1===e?(0,i.Y)(Oa,{message:t}):2===e?(0,i.Y)(Aa,{message:t}):null;var Ua=n(33407);const Pa=(0,E.default)("div",{target:"e3ts7mk0"})((({theme:e})=>[{display:"flex",flexDirection:"row",alignItems:"center",padding:"10px 12px",backgroundColor:e.colors.UIShapeNeutral4,borderRadius:"8px",color:e.colors.UIText2}]),"label:Container;"),za=(0,E.default)("div",{target:"e3ts7mk1"})((()=>[{fontSize:13,maxWidth:168}]),"label:Description;"),Na=(0,E.default)(Ua.A,{target:"e3ts7mk2"})((()=>[{fontSize:42,marginInlineEnd:12}]),"label:BlockedIcon;"),Ba=({source:e})=>{const t=(0,g.s)();return(0,i.FD)(Pa,{children:[(0,i.Y)(Na,{}),(0,i.Y)(za,{children:t("manual"===e?"dm_web_MessageRemovedCG":"dm_cam_confirmed_violation_msg")})]})},Va=(0,E.default)("div",{target:"e1y9wcqa0"})((()=>[{width:"100%",color:"#FFF",fontSize:14,padding:12,textAlign:"center"}]),"label:DivSafeTip;"),$a=({isRefMsg:e})=>{const t=(0,g.s)();return e?(0,i.Y)(oi.lcR,{size:"24",style:{color:"#FFF"}}):(0,i.Y)(Va,{children:t("dm_web_sensitiveMediaMask")})};const Ga=(0,o.memo)((function({type:e,message:t,isMyself:n,isRefMsg:a,isRefMySelf:r}){var s,l;const[{moderationResultMap:d,sendingProgressMap:c},u]=(0,b.VI)((e=>({moderationResultMap:e.moderationResultMap,sendingProgressMap:e.sendingProgressMap}))),[{isMediaSafeTipShown:g},h]=(0,T.D1)((e=>({isMediaSafeTipShown:e.isMediaSafeTipShown}))),[m,v]=(0,o.useState)(null===(s=c[t.clientId])||void 0===s?void 0:s.uploadProgress),[_,f]=(0,o.useState)(t.flightStatus<3),[y,C]=(0,o.useState)(Number(t.ext["a:moderation_result"]||1)),[x]=(0,o.useState)((()=>ta(t).thumbnailInfo)),[k,S]=(0,o.useState)((()=>ta(t).thumbnailInfo.src)),[M,I]=(0,o.useState)(!1),{isReport:R}=(0,o.useContext)(Hi),F=(0,o.useCallback)((()=>{return e=this,n=void 0,a=function*(){return(0,Mn.fI)().decryptMedia({message:t,fetchIndex:1})},new((i=void 0)||(i=Promise))((function(t,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}l((a=a.apply(e,n||[])).next())}));var e,n,i,a}),[t]),D=(0,Ht.eb)({onOpen:()=>I(!0),onClose:()=>I(!1)}),{user:Y}=null!==(l=(0,p.W)((()=>["user"]),[]))&&void 0!==l?l:{};(0,o.useEffect)((()=>{const n=d[t.serverId];1===y&&n&&1!==n&&(C(n),2===e&&S(ta(t).thumbnailInfo.src))}),[t,t.serverId,y,d,e]),(0,o.useEffect)((()=>{const e=c[t.clientId];v(null==e?void 0:e.uploadProgress),f(t.flightStatus<3&&!(null==e?void 0:e.finished))}),[t,c]);const{imageSource:L,aspectRatio:E,blobUrl:O}=x,A=a?!g&&!r:!g&&!n,j=2===y||4===y,U=3===y,P="true"===t["a:is_violative"],z=(0,o.useCallback)((()=>{var e;R||(A?h.closeMediaSafeTip(null!==(e=null==Y?void 0:Y.secUid)&&void 0!==e?e:""):(L===Xi.FileHandler||j)&&D.open())}),[h,L,R,D,j,A,null==Y?void 0:Y.secUid]),N=(0,o.useCallback)((()=>{var n,i;if(2===e)return k;{const e=null===(n=t.contentPb)||void 0===n?void 0:n.picture_card,a=(null==e?void 0:e.image)||(null==e?void 0:e.thumbnail);return(null===(i=null==a?void 0:a.url_list)||void 0===i?void 0:i[0])||""}}),[t,e,k]),B=(0,o.useCallback)((n=>{u.handleLoadMediaFail({message:t,mediaType:e,mediaUrl:N(),error:n,scene:"media_message"})}),[u,N,t,e]);if((0,o.useEffect)((()=>{w.w.handleMediaMessageShow({media_type:e,scene:"media_message"})}),[e]),(0,o.useEffect)((()=>{if(_||1!==y)return;const n=setTimeout((()=>{u.handleMediaModerationTimeout({message:t,mediaType:e,mediaUrl:N()})}),1e4);return()=>clearTimeout(n)}),[u,N,_,t,y,e]),U||P)return(0,i.Y)(Ba,{source:P?"manual":"machine"});const V=L!==Xi.Fallback?(0,i.Y)(Qi.T,{type:e,src:2===e&&k?k:void 0,moderationResult:y,isSending:_,sendingProgress:.9*(null!=m?m:0),localMediaUrl:O,style:{width:"100%",height:"100%",objectFit:"cover",position:"relative"},mediaStyle:A?{filter:"blur(20px) brightness(0.85)"}:void 0,contentTipComponent:A?(0,i.Y)($a,{isRefMsg:a}):null,decryptMedia:1===e?F:void 0,onClick:z,onError:B}):null;return(0,i.FD)(Zi,{aspectRatio:E,isRefMsg:a,style:R||!j&&L!==Xi.FileHandler?{cursor:"auto"}:{},children:[V,(0,i.Y)(Ht.nO,Object.assign(Object.assign({},D),{width:"Compact",height:"Compact",style:{backgroundColor:"transparent",borderRadius:0,margin:"48px 24px",boxShadow:"none"},children:(0,i.Y)(ja,{mediaType:e,message:t})})),M&&(0,i.Y)(Ji,{onClick:()=>D.close(),icon:(0,i.Y)(Zt.A,{})})]})}));class Ha extends o.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(){}render(){return this.state.hasError?this.props.fallback:this.props.children}}var qa=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};function Wa(e,t){var n;const{user:i}=null!==(n=(0,p.W)((()=>["user"]),[]))&&void 0!==n?n:{},{avatarThumb:a,uniqueId:o,secUid:r,nickname:s}=(0,R.EL)((t=>{var n;return null!==(n=t.users[null!=e?e:""])&&void 0!==n?n:{}}),v.bN);return{avatar:t?null==i?void 0:i.avatarUri[0]:a,uniqueId:t?null==i?void 0:i.uniqueId:o,secUid:t?null==i?void 0:i.secUid:r,nickname:s,id:t?null==i?void 0:i.uid:e,otherAvatar:a}}function Ka({message:e,messageText:t,conversation:n,checkMsg:i,failedMessageServerId:a,isLiked:r=!1,currentReaction:s}){var l;const{user:d}=null!==(l=(0,p.W)((()=>["user"]),[]))&&void 0!==l?l:{},{shortId:c,toParticipantUserId:u="",id:g,isGroupChat:h}=null!=n?n:{},{options:v}=(0,Mn.Ye)(),{userId:_}=v,f=(0,b.Yl)(),y=(0,m.Xq)();return{handleLikeMessage:(0,o.useCallback)((()=>qa(this,void 0,void 0,(function*(){yield f.likeMessage({message:e,isLiked:r}),w.w.handleLikeMessage({conversation_id:g,to_user_id:u,chat_type:h?"group":"private"})}))),[f,g,r,e,u,h]),handleReactToMessage:(0,o.useCallback)((t=>qa(this,void 0,void 0,(function*(){var n;yield f.reactToMessage({message:e,newReaction:t,currentReaction:s}),w.w.handleLikeMessage({emoji_name:null!==(n=null==t?void 0:t.split(":")[1])&&void 0!==n?n:"",react_message_type:e.type,conversation_id:g,to_user_id:u,chat_type:h?"group":"private"})}))),[f,g,e,e.property,u,h,r,null==d?void 0:d.uid,s]),handleDeleteMessage:(0,o.useCallback)((()=>qa(this,void 0,void 0,(function*(){yield f.deleteMessage({message:e}),w.w.handleDeleteMessage({chat_type:h?"group":"private",conversation_id:g,to_user_id:u})}))),[f,g,e,u]),handleReport:(0,o.useCallback)((()=>{y.setIsShowReportSelectModal(!0),w.w.handleReportMessage({chat_type:h?"group":"private",conversation_id:g,to_user_id:u})}),[g,y,u]),handleFeedback:(0,o.useCallback)((()=>qa(this,void 0,void 0,(function*(){yield f.feedbackMessage({conversationId:g,shortId:c,uid:u,selfUid:_,content:t,messageId:e.clientId,messageType:e.type,contentPb:e.contentPbStr||"",senderUid:e.sender,serverMsgId:null!=a?a:"",checkMessageStatusCode:i.status_code})}))),[f,e,t,c,u,i,_,a,g])}}const Za=(e,t,n=!1)=>{const{zoomCover:i,cover:a="",dynamicCover:o}=e,r=null==i?void 0:i[null!=t?t:"720"],{supportWebp:s,supportAvif:l}=(0,Tn.PD)(),d=(0,Rn.G)(r);return n&&o&&(1!==(0,Rn.G)(o)||s)?o:!r||1===d&&!s||2===d&&!l?a:r},Ja=({conversation:e,user:t})=>{const n=(0,g.s)(),[{refMessage:a},r]=(0,b.VI)((e=>({refMessage:e.refMessage}))),{toParticipantUserId:s}=null!=e?e:{},l=null==a?void 0:a.sender,d=(null==a?void 0:a.sender)===(null==t?void 0:t.uid),{nickname:c}=Wa((null==e?void 0:e.isGroupChat)?l:s,d),u=d?n("im_quote_you"):c,p=(0,o.useCallback)((()=>{r.removeRefMessage()}),[r]),h=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||p()}),[p]);if(!a)return null;let m="";switch(null==a?void 0:a.type){case 7:try{const{text:e}=JSON.parse(a.content);m=e}catch(e){console.error(e)}break;case 1805:case 5:m=n("im_quote_sticker");break;case 8:case 1803:m=n("im_quote_video");break;case 1802:m=n("im_quote_photo");break;default:m=n("dm_chatPage_quotedCard_MessageUnavail")}return(0,i.FD)(Ot,{children:[(0,i.Y)(jt,{children:(0,i.Y)(At,{children:`${u}: ${m}`})}),(0,i.Y)(Ut,{tabIndex:0,role:"button",onClick:p,onKeyDown:h,children:(0,i.Y)(Zt.g,{size:16})})]})};var Xa=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const Qa=(0,o.memo)((function(){var e,t,n;const a=(0,g.s)(),{user:r}=null!==(e=(0,p.W)((()=>["user"]),[]))&&void 0!==e?e:{},s=(0,u.rl)(),[l,d]=(0,o.useState)(!1),[c,h]=(0,o.useState)(!1),[_,f]=(0,o.useState)(""),y=(0,o.useRef)(null),C=(0,o.useRef)(null),x=(0,T._q)(),{acceptedStrangerList:k}=(0,m.g9)((e=>({acceptedStrangerList:e.acceptedStrangerList})),v.bN),[{selectedConversation:S,refMessage:M},w]=(0,b.VI)((e=>({selectedConversation:e.selectedConversation,refMessage:e.refMessage})),v.bN),I=null!==(t=null==S?void 0:S.toParticipantUserId)&&void 0!==t?t:"",{relation:Y,nickname:L}=(0,R.EL)((e=>{var t;return null!==(t=e.users[I])&&void 0!==t?t:{}})),E=(0,o.useRef)({}),{enableMultimediaMessage:O}=(0,gn.Q)(),A=(null!==(n=null==_?void 0:_.trim().length)&&void 0!==n?n:0)>0,{ext:j,id:U}=null!=S?S:{},P=null==S?void 0:S.isStrangerConversation,z="tcm"===(null==j?void 0:j["a:banner_indicator"])&&(null==j?void 0:j["a:banner_setter"])!==(null==r?void 0:r.uid),N=(0,o.useCallback)((e=>{(0,F.Gu)(e),d(!l)}),[l]),B=(0,o.useCallback)((e=>{13===e.keyCode||32===e.keyCode?((0,F.Gu)(e),d(!l)):27===e.keyCode&&d(!1)}),[l]),q=(0,o.useCallback)((e=>{var t;null===(t=C.current)||void 0===t||t.handleSelectEmoji(e)}),[]),W=(0,o.useCallback)((()=>Xa(this,void 0,void 0,(function*(){var e;if(!A)return;null===(e=C.current)||void 0===e||e.clearInput(),f("");const t=/(https:\/\/(www|m|t|vm|vt)\.tiktok\.com\/)[a-zA-Z0-9#?/&=+%*~\-$@_,':;|!.[\]()]*[a-zA-Z0-9#?/&=+%*~\-$@_]/g.test(_);w.removeRefMessage(),yield x.sendMessage({convId:U,uid:I,relation:Y,type:7,content:{aweType:M?703:0,text:_},referenceMessage:M,hasConversation:!0,chatType:z?"business":(null==S?void 0:S.isGroupChat)?"group":"private",messageType:t?"url":"text"})}))),[A,_,x,I,Y,z,U,S,M,w]),K=(0,o.useRef)(null),[Z,J]=(0,o.useState)([]),X=(0,o.useCallback)((e=>{var t;J(e),null===(t=K.current)||void 0===t||t.open()}),[]),Q=(0,o.useCallback)((e=>{e.length&&J([...Z,...e])}),[Z]),ee=(0,o.useCallback)(((e,t)=>{J(Z.filter(((e,n)=>n!==t)))}),[Z]),te=(0,o.useCallback)((e=>Xa(this,void 0,void 0,(function*(){yield x.batchSendMessages({convId:U,uid:I,relation:Y,hasConversation:!0,chatType:"private",batchList:e.map((e=>{const{fileType:t}=e,n=t.startsWith("image");return e.onUploadProcess=(e,t)=>{w.setSendingProgress({messageId:e,sendingProgress:{uploadProgress:t.percent||0}})},e.onUploadComplete=e=>{w.setSendingProgress({messageId:e,sendingProgress:{uploadProgress:100}})},{fileInfo:e,type:n?1802:1803,content:"",messageType:n?"image":"camera_video"}}))})}))),[w,x,U,Y,I]),ne=(0,o.useCallback)((e=>{f(e),E.current[U]=e}),[U]),ie=(0,o.useCallback)((()=>{h(!0),$.E.handleEnterText({})}),[]),ae=(0,o.useCallback)((()=>{h(!1)}),[]);(0,o.useEffect)((()=>{var e,t;if(U){const n=null!==(e=E.current[U])&&void 0!==e?e:"";null===(t=C.current)||void 0===t||t.modifyEditorContent(n),f(n)}}),[U]),(0,o.useEffect)((()=>{var e;M&&(null===(e=C.current)||void 0===e||e.focus())}),[M]),(0,o.useEffect)((()=>{const e=()=>{l&&d(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[l]);const oe=(0,o.useCallback)((e=>{var t;27===e.keyCode&&(d(!1),null===(t=y.current)||void 0===t||t.focus())}),[]),re=(0,o.useCallback)((e=>Xa(this,void 0,void 0,(function*(){13!==e.keyCode&&32!==e.keyCode||(yield W())}))),[W]),se=Ge(),{handleUnblockUser:le}=Ze({uid:I,conversation:S});if(!S)return null;if(4===Y){const e=a("webdm_unblock_this_account");let t=a("webdm_inputbox_block_note",{webdm_unblock_this_account:e});const n=t.indexOf(e);return t=t.replace(e,""),(0,i.Y)(It,{children:(0,i.FD)(Tt,{children:[t.slice(0,n),(0,i.Y)(Rt,{className:"block-text",onClick:le,children:e}),t.slice(n)]})})}return S.isGroupChatBanned?(0,i.Y)(Sn,{conversation:S}):!P||k.includes(U)||se.includes(U)?(0,i.FD)(ut,{children:[(0,i.Y)(D.K,{}),(0,i.Y)(Ja,{conversation:S,user:r}),(0,i.FD)(pt,{children:[(0,i.FD)(mt,{isFocus:c,onFocus:ie,onBlur:ae,children:[(0,i.Y)(gt,{hasContent:A,children:(0,i.Y)(H,{ref:C,placeholder:a(M?"im_hint_reply_msg":"im_hint_send_msg"),maxInputLength:6e3,ariaLabel:a(M?"im_hint_reply_msg":"im_hint_send_msg"),onInputChange:ne,onPost:W})}),O&&!M&&0===(null==S?void 0:S.inboxType)&&(0,i.FD)(i.FK,{children:[s?(0,i.Y)(oi.N0Y,{variant:"secondary",content:a("dm_cam_clickToSendMedia"),placement:"top",style:{marginBottom:"20px"},children:(0,i.Y)(_t,{tabIndex:0,role:"button",children:(0,i.Y)(Gt,{onSelectFiles:X})})}):(0,i.Y)(G.m,{overlay:a("dm_cam_clickToSendMedia"),children:(0,i.Y)(_t,{tabIndex:0,role:"button",children:(0,i.Y)(Gt,{onSelectFiles:X})})}),(0,i.Y)(vn,{files:Z,modalRef:K,onAddFiles:Q,onDeleteFile:ee,sendMedia:te})]}),s?(0,i.Y)(oi.N0Y,{variant:"secondary",content:a("comment_tray_emoji"),placement:"top",style:{marginBottom:"20px"},children:(0,i.Y)(vt,{tabIndex:0,role:"button",ref:y,onClick:N,onKeyDown:B,"aria-expanded":l,"aria-haspopup":"true","aria-controls":"emoji-suggestion-container",children:(0,i.Y)(Ft,{})})}):(0,i.Y)(G.m,{overlay:a("comment_tray_emoji"),children:(0,i.Y)(vt,{tabIndex:0,role:"button",ref:y,onClick:N,onKeyDown:B,"aria-expanded":l,"aria-haspopup":"true","aria-controls":"emoji-suggestion-container",children:(0,i.Y)(Ft,{})})}),l&&(0,i.Y)(ft,{"data-e2e":"comment-emoji-list",onClick:F.Gu,onKeyDown:oe,children:(0,i.Y)(V,{onSelect:q})})]}),A&&(0,i.Y)(ht,{onClick:W,tabIndex:0,role:"button",onKeyDown:re})]})]}):(0,i.Y)(zt,{uid:I,nickname:L,conversation:S,isBusinessInvitation:z})}));var eo=n(81862),to=n(40935),no=n(56070),io=n(43723),ao=n(31209),oo=n(41548),ro=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const so=e=>ro(void 0,void 0,void 0,(function*(){return void 0===e?new Promise((e=>{e({status_code:0})})):no.h.post("/api/im_setting/update/v1",{query:{field:"tcm_message",value:e},headers:{[Ve.nk]:no.h.csrfToken}})})),lo=()=>{const e=(0,oo.T)();Be.F.open({content:e("Sorry, something wrong with the server, please try again."),duration:3,style:{width:"50vw"}})},co=(0,io.p)("messageSettingAtom@tiktok/webapp-atoms",{settingConfig:void 0,currentSetting:void 0,privacySetting:void 0,isLoading:!1,isSaveLoading:!1,showSettingModal:!1}),{useServiceState:uo,useServiceDispatchers:po,useAtomService:go,getStaticApi:ho}=(0,ao.i)(co,((e,t)=>({setLoading(e){t(co,(t=>Object.assign(Object.assign({},t),{isLoading:e})))},setSettings(e){t(co,(t=>Object.assign(Object.assign({},t),e)))},setSaveLoading(e){t(co,(t=>Object.assign(Object.assign({},t),{isSaveLoading:e})))},setIsShowSettingModal(e){t(co,(t=>Object.assign(Object.assign({},t),{showSettingModal:e})))},getAllSettings(){return ro(this,void 0,void 0,(function*(){try{t(co,(e=>Object.assign(Object.assign({},e),{isLoading:!0})));const[e,n,i]=yield Promise.all([ro(void 0,void 0,void 0,(function*(){return no.h.get("/api/compliance/settings/",{baseUrlType:2})})),ro(void 0,void 0,void 0,(function*(){return no.h.get("/api/user/settings/",{query:{},baseUrlType:2})})),ro(void 0,void 0,void 0,(function*(){return no.h.get("/api/privacy/setting/restriction/v1",{baseUrlType:2})}))]),a=e.private_settings,o=n.settings,r=i.privacy_restriction;t(co,(e=>Object.assign(Object.assign({},e),{settingConfig:a,currentSetting:o,privacySetting:r,isLoading:!1})))}catch(e){t(co,(e=>Object.assign(Object.assign({},e),{loading:!1})))}}))},changeMessageSetting(e){return ro(this,void 0,void 0,(function*(){try{t(co,(e=>Object.assign(Object.assign({},e),{isSaveLoading:!0})));const{messageValue:i,businessValue:a}=e,[o,r]=yield Promise.all([(n=i,ro(void 0,void 0,void 0,(function*(){return void 0===n?new Promise((e=>{e({status_code:0})})):no.h.post("/api/privacy/user/settings/update/v1",{query:{field:"direct_message",value:n},baseUrlType:2,headers:{[Ve.nk]:no.h.csrfToken}})}))),so(a)]),s=["","Everyone","Friends","No_one"];void 0!==i&&(0===o.status_code?w.w.handleChangeMessagePermission(s[i]):lo()),void 0!==a&&(0===r.status_code?w.w.handleChangeBrandMessageStatus(a?"on":"off"):lo()),t(co,(e=>Object.assign(Object.assign({},e),{isSaveLoading:!1})))}catch(e){lo(),t(co,(e=>Object.assign(Object.assign({},e),{isSaveLoading:!1})))}var n}))}}))),mo={id:"business-logo-9131b326",use:"business-logo-9131b326-usage",viewBox:"0 0 71 31",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 31" id="business-logo-9131b326"><g clip-path="url(#business-logo-9131b326_a)"><path fill="black" d="M-.059 10.786h6.341L5.7 12.575H4.055v6.614h-2.05v-6.614H-.057zm16.899 0h6.488l-.582 1.789h-1.788v6.618h-2.053v-6.618h-2.062zM6.669 13.641v-.181H8.7l.002.181.002 5.02-.006.528H6.68v-.286zm3.011-2.482v-.397h2.014v3.908l2.03-1.947h2.425l-2.546 2.437 2.851 4.023h-2.238l-1.904-2.79-.602.578v2.218H9.686v-.18zm20.862 0v-.397h2.01v3.908l2.03-1.947h2.425L34.46 15.16l2.853 4.029h-2.237l-1.903-2.795-.603.578v2.217h-2.022v-.18zm-1.15 3.248a3.5 3.5 0 0 0-.74-1.084 3.4 3.4 0 0 0-1.103-.725l-.115-.046-.043-.016-.073-.024-.056-.018-.059-.018-.067-.02h-.026a3 3 0 0 0-.297-.064h-.01l-.107-.016a4 4 0 0 0-.228-.025c-.059 0-.115-.006-.176-.008h-.173c-.064 0-.127 0-.191.01a4 4 0 0 0-.4.051l-.066.013-.06.012-.134.033c-.292.077-.573.19-.835.338a3.36 3.36 0 0 0-1.59 2.039 3.5 3.5 0 0 0 0 1.844 3.4 3.4 0 0 0 1.592 2.044q.396.223.835.339l.146.035.05.01.097.018.06.01.1.015.05.006c.054 0 .108.012.162.015.053.003.136.008.205.009h.129c.068 0 .137 0 .204-.009.068-.009.129-.011.192-.02.04 0 .08-.01.12-.016l.067-.012.085-.016.053-.012q.07-.015.139-.033.437-.117.83-.339a3.42 3.42 0 0 0 1.583-2.051 3.48 3.48 0 0 0-.15-2.269m-1.571 1.797a1.65 1.65 0 0 1-.774.995 1.8 1.8 0 0 1-.403.166 1.8 1.8 0 0 1-.384.057h-.065a2 2 0 0 1-.454-.058 1.7 1.7 0 0 1-.75-.424 1.65 1.65 0 0 1-.49-1.185 1.67 1.67 0 0 1 .491-1.186q.155-.15.343-.257a1.7 1.7 0 0 1 .86-.222h.075c.2.007.397.05.582.126a1.653 1.653 0 0 1 .968 1.982zM7.687 12.803c.565 0 1.023-.452 1.023-1.009s-.458-1.008-1.023-1.008-1.022.451-1.022 1.008.457 1.009 1.022 1.009" /><path fill="#FA2D6C" d="M39.773 14.702a.85.85 0 0 0 .858-.847.85.85 0 0 0-.858-.846.85.85 0 0 0-.858.846c0 .468.385.847.858.847" /><path fill="#22D5EC" d="M39.773 17.184a.85.85 0 0 0 .858-.847.85.85 0 0 0-.858-.846.85.85 0 0 0-.858.846c0 .468.385.847.858.847" /><path fill="black" d="M42.69 12.52a1.65 1.65 0 0 1 .493-1.188 1.7 1.7 0 0 1 1.202-.494 1.68 1.68 0 0 1 1.362.683l-.513.369a.97.97 0 0 0-.824-.425 1.1 1.1 0 0 0-.76.308 1.054 1.054 0 0 0-.005 1.5c.201.2.474.312.76.313a.99.99 0 0 0 .829-.43l.513.373a1.7 1.7 0 0 1-1.362.677 1.72 1.72 0 0 1-1.203-.495 1.67 1.67 0 0 1-.492-1.19m5.101-.564-.145.6a.7.7 0 0 0-.325-.08c-.324 0-.547.296-.547.932v.765h-.635v-2.232h.63v.473c.126-.373.383-.53.664-.53a.8.8 0 0 1 .358.072m2.467 1.3h-1.705c.068.258.28.401.586.401a.8.8 0 0 0 .591-.248l.373.368c-.213.282-.61.434-1.008.434-.693 0-1.202-.468-1.202-1.156 0-.722.553-1.171 1.202-1.171.65 0 1.173.45 1.173 1.128 0 .066-.005.143-.01.244m-.625-.407c-.02-.263-.243-.42-.529-.42a.53.53 0 0 0-.357.105.5.5 0 0 0-.194.315zm3.411-.908v2.227h-.632v-.277c-.16.225-.475.32-.728.32-.58 0-1.109-.444-1.109-1.16 0-.717.528-1.162 1.11-1.162.261 0 .571.095.727.32v-.268zm-.654 1.11a.57.57 0 0 0-.361-.536.59.59 0 0 0-.64.124.576.576 0 0 0 .414.989.59.59 0 0 0 .543-.356.6.6 0 0 0 .044-.222m2.577-.626h-.479v1.744h-.635v-1.744h-.412v-.483h.412v-.817h.635v.817h.48zm.18.626c0-.707.572-1.167 1.216-1.167s1.217.46 1.217 1.167-.572 1.161-1.217 1.161-1.216-.458-1.216-1.16m1.787 0a.56.56 0 0 0-.362-.511.58.58 0 0 0-.618.13.561.561 0 0 0 .409.959.57.57 0 0 0 .411-.168.56.56 0 0 0 .16-.41m2.748-1.095-.145.6a.7.7 0 0 0-.325-.08c-.325 0-.547.296-.547.932v.765h-.635v-2.232h.63v.473c.125-.373.383-.53.664-.53a.8.8 0 0 1 .358.072m-13.625 6.886-.242-2.04L45 18.47h-.528l-.824-1.667-.241 2.04h-.686l.412-3.293h.571l1.03 2.16 1.022-2.16h.581l.407 3.293zm3.496-2.223v2.222h-.635v-.276c-.16.219-.475.32-.727.32-.58 0-1.109-.445-1.109-1.162s.529-1.16 1.11-1.16c.261 0 .571.094.726.32v-.264zm-.655 1.109a.57.57 0 0 0-.362-.535.59.59 0 0 0-.64.126.577.577 0 0 0 .417.988.6.6 0 0 0 .418-.17.57.57 0 0 0 .17-.414zm2.901-1.099-.145.598a.66.66 0 0 0-.325-.083c-.325 0-.548.297-.548.934v.763h-.635V16.62h.63v.474c.126-.374.384-.532.664-.532a.8.8 0 0 1 .359.068m1.725 2.212-.8-.964v.964h-.636v-3.417h.635v1.872l.572-.677h.814l-.881.98 1.08 1.241zm3.106-.912h-1.702c.068.258.282.401.587.401a.8.8 0 0 0 .591-.248l.373.368c-.214.282-.61.434-1.007.434-.694 0-1.203-.468-1.203-1.156 0-.721.553-1.171 1.203-1.171s1.172.45 1.172 1.128c0 .062-.01.143-.015.244m-.625-.407c-.02-.262-.243-.42-.529-.42a.53.53 0 0 0-.355.106.5.5 0 0 0-.193.313zm2.375-.425h-.477v1.744h-.635v-1.744h-.412v-.478h.412v-.817h.635v.817h.48zm2.84.626c0 .717-.528 1.161-1.11 1.161-.257 0-.571-.095-.727-.319v1.04h-.635V16.62h.635v.268a.9.9 0 0 1 .727-.326c.576-.004 1.11.446 1.11 1.162m-.65 0a.57.57 0 0 0-.359-.535.59.59 0 0 0-.638.124.574.574 0 0 0 .416.984.58.58 0 0 0 .534-.353.6.6 0 0 0 .042-.22zm1.1-2.299h.634v3.417h-.634zm3.561 1.195v2.222h-.635v-.276c-.16.219-.475.32-.727.32-.581 0-1.11-.445-1.11-1.162s.529-1.16 1.11-1.16c.262 0 .572.094.727.32v-.264zm-.654 1.109a.57.57 0 0 0-.362-.535.6.6 0 0 0-.64.125.577.577 0 0 0 .415.989.6.6 0 0 0 .418-.17.57.57 0 0 0 .169-.414zm1.104-.009c0-.708.58-1.162 1.24-1.162a1.17 1.17 0 0 1 .953.478l-.478.33a.6.6 0 0 0-.474-.226.6.6 0 0 0-.417.17.577.577 0 0 0 0 .822.61.61 0 0 0 .891-.055l.475.329a1.14 1.14 0 0 1-.954.477c-.654.002-1.236-.458-1.236-1.163m4.788.21h-1.7c.067.258.281.401.586.401a.8.8 0 0 0 .59-.248l.374.368c-.213.282-.61.434-1.008.434-.693 0-1.2-.468-1.2-1.156 0-.721.552-1.171 1.2-1.171.649 0 1.172.45 1.172 1.128q-.008.093-.014.244m-.626-.407c-.018-.262-.241-.42-.527-.42a.53.53 0 0 0-.355.107.5.5 0 0 0-.192.312z" /></g><defs><clipPath id="business-logo-9131b326_a"><path fill="white" d="M0 .415h70.385v30H0z" /></clipPath></defs></symbol>'};function vo(e){const t=(0,o.useContext)(lt.X);return(0,o.useLayoutEffect)((()=>(t.add(mo),()=>{t.remove("business-logo-9131b326")})),[]),(0,Y.jsx)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor"},e,{children:(0,Y.jsx)("use",{xlinkHref:"#business-logo-9131b326"},void 0)}),void 0)}const _o=(0,E.default)("div",{target:"eth30fy0"})((({theme:e})=>({position:"absolute",zIndex:1,bottom:"0",left:"0",right:"0",transform:"translateY(100%)",backgroundColor:e.colors.BGSecondary})),"label:DivNoticeContainer;"),fo=(0,E.default)("div",{target:"eth30fy1"})((({isFollow:e,theme:t})=>[{width:"100%",padding:"14px 16px",backgroundColor:t.colors.BGView},e?{display:"flex",alignItems:"center",height:"68px",backgroundColor:t.colors.BGPrimary,filter:"drop-shadow(0 2px 8px rgba(0, 0, 0, .06))"}:null,(0,O.zy)({theme:t,fontFamily:"TikTokFont",typography:"P3",color:"TextSecondary"})]),"label:DivSendFailTip;"),bo=(0,E.default)("span",{target:"eth30fy2"})((({theme:e})=>[{cursor:"pointer"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P3",fontWeight:"bold"})]),"label:SpanClickText;"),yo=(0,E.default)("div",{target:"eth30fy3"})((({theme:e})=>[{display:"flex",alignItems:"center",padding:"6px 16px",boxSizing:"border-box",width:"100%",backgroundColor:"rgba(22, 24, 35, .03)"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P3",color:"TextTertiary"})]),"label:DivDescWrapper;"),Co=(0,E.default)(vo,{target:"eth30fy4"})((({theme:{direction:e}})=>[{width:"70px",height:"30px"},(0,O.mp)({direction:e,marginEnd:"16px"})]),"label:StyledBusinessLogo;"),xo=(0,E.default)("p",{target:"eth30fy5"})({},"label:PText;"),ko=(0,E.default)("p",{target:"eth30fy6"})((({theme:{direction:e}})=>[{flex:1},(0,O.mp)({direction:e,marginEnd:"24px"}),(0,O.m4)(2)]),"label:PTextFollow;"),So=(0,E.default)(Qe.y,{target:"eth30fy7"})({height:"36px"},"label:StyledFollowButton;"),Mo=(0,o.memo)((function({uniqueId:e}){var t,n,a;const r=(0,g.s)(),{notice:s,clickableNotice:l}=(0,m.g9)((e=>({notice:e.notice,clickableNotice:e.clickableNotice})),v.bN),{failedMessageMap:d,selectedConversation:c}=(0,b.by)((e=>({failedMessageMap:e.failedMessageMap,selectedConversation:e.selectedConversation})),v.bN),u=po(),{ext:h}=null!=c?c:{},{user:_}=null!==(t=(0,p.W)((()=>["user"]),[]))&&void 0!==t?t:{},{handleFollow:f,isFollowing:y,relation:C}=(0,to.Tu)({uniqueId:e}),x="tcm"===(null==h?void 0:h["a:banner_indicator"])&&(null==h?void 0:h["a:banner_setter"])!==(null==_?void 0:_.uid);let k,S,M;try{k=JSON.parse(d[null!==(a=null===(n=null==c?void 0:c.lastMessage)||void 0===n?void 0:n.clientId)&&void 0!==a?a:""].checkMsg),k.status_code!==ie.DIRTY_WORD_ERROR_CODE&&k.status_code!==ie.MESSAGE_VIOLATION_COMMUNITY_GUIDELINES_ERROR_CODE&&(S=k.status_msg.msg_content.tips,M=k.status_code!==ie.NOT_FOLLOW_USER_ERROR_CODE)}catch(e){S="",M=!0}const w=(0,o.useCallback)((e=>()=>{0===e&&u.setIsShowSettingModal(!0)}),[u]);if(null==l?void 0:l.desc){const{desc:e,clickText:t,template:n,action:a}=l,o=e.indexOf(n),r=e.replace(n,"");return(0,i.Y)(_o,{children:(0,i.Y)(fo,{children:(0,i.FD)("p",{children:[r.slice(0,o),(0,i.Y)(bo,{onClick:w(a),children:t}),r.slice(o)]})})})}return S||s?M?(0,i.Y)(_o,{children:(0,i.Y)(fo,{children:S||s})}):y?null:3===C?(0,i.Y)(_o,{children:(0,i.Y)(fo,{children:S||s})}):(0,i.Y)(_o,{children:(0,i.FD)(fo,{isFollow:!0,children:[(0,i.Y)(ko,{children:S}),(0,i.Y)(So,{"data-e2e":"follow-button",uniqueId:e,size:"small",buttonTheme:y?"default":"primary",onClick:f,children:r("Inbox_Follow_back")})]})}):x?(0,i.Y)(_o,{children:(0,i.FD)(yo,{children:[(0,i.Y)(Co,{}),(0,i.Y)(xo,{children:r("dm_tcm_banner_from_tcm")})]})}):null}));var wo=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const Io="close-card",To=(0,o.memo)((function({onReport:e}){var t,n,a;const r=(0,u.rl)(),s=(0,g.s)(),l=(0,m.Xq)(),[{selectedConversation:d,currentMessage:{list:c},isLoadingMoreMessage:_,currentMessage:f},C]=(0,b.VI)((e=>({selectedConversation:e.selectedConversation,currentMessage:e.currentMessage,isLoadingMoreMessage:e.isLoadingMoreMessage}))),T=null!==(t=null==d?void 0:d.toParticipantUserId)&&void 0!==t?t:"",{avatarThumb:F,uniqueId:D,nickname:Y,secUid:L="",relation:E}=(0,R.EL)((e=>{var t;return null!==(t=e.users[T])&&void 0!==t?t:{}}),v.bN),O=null===(n=null==d?void 0:d.coreInfo)||void 0===n?void 0:n.icon,A=null===(a=null==d?void 0:d.coreInfo)||void 0===a?void 0:a.name,j=(0,o.useRef)(0),U=(0,o.useRef)(void 0),P=(0,k.fJR)({uniqueId:D}),{abTestVersion:z}=(0,y.L$)((0,p.W)((()=>["abTestVersion"]),[])),N=(0,h.Ig)();(0,o.useEffect)((()=>{(()=>{wo(this,void 0,void 0,(function*(){var e,t;if((null===(e=U.current)||void 0===e?void 0:e.id)!==(null==d?void 0:d.id)){if(yield l.getConversationNotice({secUid:L,conversationId:null!==(t=null==d?void 0:d.id)&&void 0!==t?t:""}),U.current){const{mode:e,id:t,isStrangerConversation:n}=U.current;!n&&C.markConversationRead({id:t}),w.w.handleLeaveChat({relation_tag:E,is_stranger:0!==e||n,conversation_id:t})}U.current=d}}))})()}),[L,null==d?void 0:d.id,l,d,E]),(0,o.useEffect)((()=>{(()=>{wo(this,void 0,void 0,(function*(){var e;d&&c.length&&!(null==d?void 0:d.isStrangerConversation)&&(yield C.markConversationRead({id:null!==(e=null==d?void 0:d.id)&&void 0!==e?e:""}))}))})()}),[]);const{isShowContactButton:B,handleOpenCard:V,handleCloseCard:$}=(0,eo.y)(),[G,H]=(0,o.useState)(Io),q=(0,o.useCallback)((e=>{"close-contact-card"===e.data.type&&($(),H(e.data.messageType))}),[$]);(0,o.useEffect)((()=>(window.addEventListener("message",q),()=>{window.removeEventListener("message",q)})),[q]);const W="v2"===(0,Dn.d)("web_dm_list_load_optimize"),K=(0,S._g)((e=>wo(this,void 0,void 0,(function*(){if(!e.currentTarget||!f.hasMore||_)return;const t=e.currentTarget.scrollTop||1e3;(e.currentTarget.scrollHeight||0)-(e.currentTarget.offsetHeight||0)+t<1e3&&j.current>t&&(yield C.loadMoreMessage({conversation:d,abTestVersion:z})),j.current=t}))),[d,C,f.hasMore,_],100),Z=(0,S.d7)((e=>wo(this,void 0,void 0,(function*(){if(!e.target||!f.hasMore||_)return;const t=e.target,n=t.scrollTop||1e3;(t.scrollHeight||0)-(t.offsetHeight||0)+n<1e3&&j.current>n&&(yield C.loadMoreMessage({conversation:d,abTestVersion:z})),j.current=n}))),[d,C,f.hasMore,_],300),J=(0,o.useCallback)((e=>{if(13===e.keyCode)try{window.open(P,"_blank","opener")}catch(e){console.error(e)}}),[P]);return(0,i.Y)(M.t,{isMobile:!1,componentName:"message-chat-box",children:(0,i.FD)(ri,{isBusinessAccount:N,isFullSideNav:r,children:[(0,i.FD)(si,{children:[(null==d?void 0:d.isGroupChat)?(0,i.Y)(li,{tabIndex:0,role:"columnheader","aria-label":s("accessibilityLabels_link_userProfile",{username:A}),children:(0,i.FD)(i.FK,{children:[(0,i.Y)(I.e,{src:O,size:48,e2eTag:"top-chat-avatar",alt:""}),(0,i.FD)(ci,{children:[(0,i.Y)(ui,{children:A}),(0,i.Y)(gi,{children:`${d.participantCount} ${s("group_chat_number_of_members",{num:d.participantCount},"members")}`})]})]})}):(0,i.FD)(li,{tabIndex:0,role:"link",onKeyDown:J,"aria-label":s("accessibilityLabels_link_userProfile",{username:Y}),children:[(0,i.Y)(vi,{to:P,target:"_blank",rel:"opener",tabIndex:-1,"aria-label":s("accessibilityLabels_link_userProfile",{username:Y}),children:(0,i.Y)(I.e,{src:F,size:48,e2eTag:"top-chat-avatar",alt:""})}),(0,i.Y)(vi,{to:P,target:"_blank",rel:"opener",tabIndex:-1,"aria-label":s("accessibilityLabels_link_userProfile",{username:Y}),children:(0,i.FD)(ci,{children:[(0,i.Y)(ui,{children:Y}),(0,i.FD)(pi,{children:["@",D]})]})})]}),B&&(0,i.FD)(Ri,{size:"medium",onClick:()=>{var e;return V(T,D,null!==(e=null==d?void 0:d.shortId)&&void 0!==e?e:"","contact-button",G)},children:[G===Io&&(0,i.Y)(x.Y,{size:20}),(0,i.Y)(Fi,{children:s(G===Io?"WBS_inbox_cc_view":"wbs_inbox_msg_cctos_createcontacts")})]}),(0,i.Y)(Mo,{uniqueId:D})]}),(0,i.Y)(hi,{onScroll:W?Z:K,children:(0,i.FD)(Di,{children:[_&&W&&(0,i.Y)(oi.sgs,{size:"medium",style:{margin:"0 auto"}}),c.map(((t,n)=>{if(49999===t.type||1039===t.type)return null;const a=c[n-1],r=!a||Number(t.createdAt)-Number(a.createdAt)>3e5,s=xn(t.createdAt),l=!t.isFromMe&&(null==d?void 0:d.isGroupChat)&&(r||0===n||a.sender!==t.sender||a.type!==t.type);return(0,i.FD)(o.Fragment,{children:[r&&(0,i.Y)(mi,{isFirst:!a,children:(0,i.Y)("span",{tabIndex:0,children:s})}),(0,i.Y)(zi,{message:t,onReport:e,shouldShowSenderUserName:l,shouldShowSenderAvatar:!0,version:t.version.toString()})]},t.clientId)}))]})}),d&&(0,i.Y)(Qa,{})]})})}));const Ro=(0,o.memo)((function(){const e=(0,u.rl)(),{chatMode:t}=(0,m.g9)((e=>({chatMode:e.chatMode})),v.bN),[{selectedConversation:n},a]=(0,b.VI)((e=>({selectedConversation:e.selectedConversation}))),[r,s]=(0,o.useState)(""),l=(0,o.useRef)(void 0),d=(0,o.useRef)({}),{abTestVersion:c}=(0,y.L$)((0,p.W)((()=>["abTestVersion"]),[])),g=(0,h.Ig)();(0,o.useEffect)((()=>{(()=>{var e,t,i,o;e=this,t=void 0,o=function*(){if(n){if(n!==l.current){const e=null==n?void 0:n.getMessageList(C.U);yield a.setMessageList({list:e,shouldHandleVideoMessage:!0,abTestVersion:c}),l.current=n}d.current[n.id]||(yield a.loadMoreMessage({conversation:n,abTestVersion:c}),d.current[n.id]=!0)}},new((i=void 0)||(i=Promise))((function(n,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))})()}),[n,a,c]),(0,o.useEffect)((()=>{0===t&&s("")}),[t]);const _=(0,o.useCallback)((e=>{s(e.serverId)}),[]);return n?0===t?(0,i.Y)(To,{onReport:_}):(0,i.Y)(qi,{reportMessageId:r}):(0,i.Y)(ri,{isBusinessAccount:g,isFullSideNav:e,children:e?(0,i.Y)(di,{children:(0,i.Y)(oi.wO8,{size:"92",color:"UIShapeNeutral3"})}):null})}));var Fo=n(2365),Do=n(11328);const Yo=(0,E.default)("div",{target:"exr9nz00"})((({theme:{colors:e}})=>({width:"700px",minHeight:"400px",background:e.BGPrimary,boxShadow:"0px 2px 12px rgba(0, 0, 0, 0.12)",borderRadius:"8px"})),"label:DivReasonContainer;"),Lo=(0,E.default)("div",{target:"exr9nz01"})((({theme:e})=>[{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0px 24px",height:"72px","::after":Object.assign({content:'""',background:e.colors.LinePrimary},(0,O.WB)("bottom"))}]),"label:DivReportReasonHeader;"),Eo=(0,E.default)("h2",{target:"exr9nz02"})((({theme:e})=>[(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"bold",typography:"P0"})]),"label:H2Title;"),Oo=(0,E.default)(ai.A,{target:"exr9nz03"})({width:"24px",height:"24px",cursor:"pointer"},"label:StyledCloseIcon;"),Ao=(0,E.default)("div",{target:"exr9nz04"})((({theme:e})=>[{position:"relative",minHeight:"253px","::after":Object.assign({content:'""',background:e.colors.LinePrimary},(0,O.WB)("bottom"))}]),"label:DivReportReasonContent;"),jo=(0,E.default)("div",{target:"exr9nz05"})({padding:"16px 24px 0 24px"},"label:DivSkeletonWrapper;"),Uo=(0,E.default)(Do.eg,{target:"exr9nz06"})({width:"120px",height:"16px"},"label:StyledSkeletonTitle;"),Po=(0,E.default)(Do.eg,{target:"exr9nz07"})({width:"400px",height:"12px",marginTop:"8px"},"label:StyledSkeletonSubTitle;"),zo=(0,E.default)("div",{target:"exr9nz08"})((({theme:e})=>[{padding:"16px 24px"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",typography:"P2"})]),"label:DivReportReasonWhyTitle;"),No=(0,E.default)("div",{target:"exr9nz09"})((({theme:{direction:e}})=>[(0,O.mp)({direction:e,paddingStart:"8px",paddingEnd:"24px"})]),"label:DivReportReasonGroup;"),Bo=(0,E.default)("div",{target:"exr9nz010"})((({theme:e,theme:{direction:t,colors:n,isDark:i},isSelected:a})=>[{display:"inline-block",padding:"12px 16px",background:i?n.BGSecondary2:"#f1f1f1",borderRadius:"24px",cursor:"pointer",marginBottom:"16px"},a?{color:i?"#000":"#fff",background:i?"#fff":"#000"}:null,(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"bold",typography:"P2"}),(0,O.mp)({direction:t,marginStart:"16px"})]),"label:DivReportReasonItem;");Bo.defaultProps=Object.assign(Object.assign({},Bo.defaultProps),{"data-e2e":"dm-report-reason"});const Vo=(0,E.default)("div",{target:"exr9nz011"})({display:"flex",alignItems:"center",flexDirection:"row-reverse",padding:"23px 24px 23px 24px"},"label:DivReportReasonFooter;"),$o=(0,E.default)("div",{target:"exr9nz012"})({display:"flex",alignItems:"center",justifyContent:"space-between",width:"344px"},"label:DivReportReasonButtonContainer;"),Go=(0,E.default)("div",{target:"exr9nz013"})((({theme:{direction:e}})=>(0,O.mp)({direction:e,end:"24px"})),{position:"absolute",top:"20px"},"label:DivCloseIconContainer;");const Ho={audit_type:-1,next_reason:[],option:"",reason_type:-1,special_type:-1,text:"",reason_code:-1},qo=(0,o.memo)((function(){var e,t,n;const a=(0,g.s)(),[r,s]=(0,o.useState)(!1),[{reportReasons:l,isShowReportSelectModal:d,isUsingV3Reasons:c},u]=(0,m.Ks)((e=>({reportReasons:e.reportResons,isShowReportSelectModal:e.isShowReportSelectModal,isUsingV3Reasons:e.isUsingV3Reasons})),v.bN),[h,_]=(0,o.useState)(Ho),[f,C]=(0,o.useState)(Ho),x=(c?h.reason_code>0:h.reason_type>0)&&(null!==(t=null===(e=null==h?void 0:h.next_reason)||void 0===e?void 0:e.length)&&void 0!==t?t:0)>0,k=a("webdm_report_type",{reportreason:h.text}),S=(0,o.useRef)(null),[{recordedFocusOrigin:M}]=(0,b.VI)((e=>({recordedFocusOrigin:e.recordedFocusOrigin})),v.bN),w=(0,o.useCallback)((()=>{s(!1),u.setIsShowReportSelectModal(!1)}),[u]),I=(0,o.useCallback)((e=>{13!==e.keyCode&&32!==e.keyCode||(s(!1),u.setIsShowReportSelectModal(!1))}),[u]),{language:T="en"}=(0,y.L$)((0,p.W)((()=>["language"]),[]));(0,o.useEffect)((()=>{(()=>{var e,t,n,i;e=this,t=void 0,i=function*(){d?d&&0===l.length&&(yield u.getReportReasons(T)):(_(Ho),C(Ho))},new((n=void 0)||(n=Promise))((function(a,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))})()}),[d,l,u,T]);const R=e=>c&&e.reason_code?e.reason_code:e.reason_type,F=(0,o.useCallback)((()=>{if(r){let e=[];e.push(h),R(f)>0&&e.push(f),u.setSelectedReportReasons(e),u.setChatMode(1),w()}}),[r,h,f,u,w]),D=(0,o.useCallback)((e=>()=>{_(e),C(Ho),0===e.next_reason.length?s(!0):s(!1)}),[]),Y=(0,o.useCallback)((e=>t=>{var n;13!==t.keyCode&&32!==t.keyCode||(_(e),C(Ho),setTimeout((()=>{var e,t;const n=null===(e=S.current)||void 0===e?void 0:e.children;null===(t=null==n?void 0:n[0])||void 0===t||t.focus()}),0),0===(null===(n=e.next_reason)||void 0===n?void 0:n.length)?s(!0):s(!1))}),[]),L=(0,o.useCallback)((e=>()=>{C(e),s(!0)}),[]),E=(0,o.useCallback)((e=>t=>{13!==t.keyCode&&32!==t.keyCode||(C(e),s(!0))}),[]),O=(0,o.useCallback)((()=>{setTimeout((()=>{var e;M&&(null===(e=document.querySelector(`#${M}`))||void 0===e||e.focus())}),0)}),[M]);return(0,i.Y)(Xe.aF,{visible:d,maskCloseable:!1,onClose:w,autoFocus:!0,returnFocus:!1,onCloseFocusHandler:O,children:(0,i.FD)(Yo,{role:"dialog","aria-modal":!0,"aria-labelledby":"messages-report-modal-header",children:[(0,i.Y)(Lo,{children:(0,i.Y)(Eo,{id:"messages-report-modal-header",children:a("webdm_report")})}),(0,i.Y)(Ao,{children:0===l.length?(0,i.FD)(jo,{children:[(0,i.Y)(Uo,{}),(0,i.Y)(Po,{})]}):(0,i.FD)("div",{children:[(0,i.Y)(zo,{children:a("webdm_report_why")}),(0,i.Y)(No,{children:l.map((e=>(0,i.Y)(Bo,{isSelected:R(e)===R(h),tabIndex:0,role:"button",onClick:D(e),onKeyDown:Y(e),children:e.text},R(e))))}),x?(0,i.FD)(i.FK,{children:[(0,i.Y)(zo,{children:k}),(0,i.Y)(No,{ref:S,children:null===(n=null==h?void 0:h.next_reason)||void 0===n?void 0:n.map((e=>(0,i.Y)(Bo,{isSelected:R(e)===R(f),tabIndex:0,role:"button",onClick:L(e),onKeyDown:E(e),children:e.text},R(e))))})]}):null]})}),(0,i.Y)(Vo,{children:(0,i.FD)($o,{children:[(0,i.Y)(Qe.y,{size:"medium",onClick:w,children:a("webdm_cancel")}),(0,i.Y)(Qe.y,{size:"medium",buttonTheme:"primary",disabled:!r,"data-e2e":"dm-next-button",onClick:F,children:a("webdm_next")})]})}),(0,i.Y)(Go,{onClick:w,onKeyDown:I,tabIndex:0,role:"button","aria-label":a("Close_button"),children:(0,i.Y)(Oo,{"aria-hidden":"true"})})]})})}));var Wo=n(15162);const Ko=(0,E.default)("div",{target:"enhnw8g0"})((({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"center",width:"400px",padding:"32px",background:e.colors.BGPrimary2,boxShadow:"0 2px 12px rgba(0, 0, 0, .12)",borderRadius:"8px"})),"label:DivReportSuccessContainer;"),Zo=(0,E.default)("p",{target:"enhnw8g1"})((({theme:e})=>[{marginTop:"24px"},(0,O.zy)({theme:e,fontFamily:"TikTokFont",fontWeight:"bold",typography:"P0"})]),"label:PTitle;");Zo.defaultProps=Object.assign(Object.assign({},Zo.defaultProps),{"data-e2e":"dm-report-done-title"});const Jo=(0,E.default)("p",{target:"enhnw8g2"})((({theme:e})=>[{marginTop:"16px"},(0,O.zy)({theme:e,typography:"P2",color:"TextSecondary"})]),"label:PDesc;");Jo.defaultProps=Object.assign(Object.assign({},Jo.defaultProps),{"data-e2e":"dm-report-done-content"});const Xo=(0,E.default)(Qe.y,{target:"enhnw8g3"})({marginTop:"24px",width:"336px",height:"46px"},"label:StyledButtonDone;"),Qo=(0,o.memo)((function(){const e=(0,g.s)(),[{isShowReportSuccessModal:t},n]=(0,m.Ks)((e=>({isShowReportSuccessModal:e.isShowReportSuccessModal})),v.bN),a=(0,o.useCallback)((()=>{n.setIsShowReportSuccessModal(!1)}),[n]);return(0,i.Y)(Xe.aF,{visible:t,maskCloseable:!1,children:(0,i.FD)(Ko,{children:[(0,i.Y)(Wo.A,{width:72,height:72}),(0,i.Y)(Zo,{children:e("webdm_report_popup_title")}),(0,i.Y)(Jo,{children:e("webdm_report_popup_detail")}),(0,i.Y)(Xo,{buttonTheme:"primary","data-e2e":"dm-report-done-btn",onClick:a,children:e("webdm_done")})]})})}));var er=n(70281),tr=n(33543);const nr=(0,E.default)("div",{target:"e1bs9h2k0"})((({theme:{direction:e,isDark:t,colors:n},isInIframe:i})=>[{position:"absolute",left:"0",right:"0",top:`${i?0:(0,er.$)()}px`,bottom:"0",display:"flex",flexDirection:"row",width:"100%",height:`calc(100vh - ${i?0:(0,er.$)()}px)`,justifyContent:"center",padding:i?"unset":"16px 24px 10px 20px",backgroundColor:t?n.BGPrimary:"rgb(248, 248, 248)"},(0,O.mp)({direction:e,margin:"0 20px 0 24px"})]),"label:DivLayout;"),ir=(0,E.default)("div",{target:"e1bs9h2k1"})((({theme:{colors:e}})=>({position:"fixed",left:0,top:0,bottom:0,right:0,zIndex:3001,overflow:"auto",outline:"0px",background:e.SDSecondary})),"label:DivMask;"),ar=(0,E.default)("div",{target:"e1bs9h2k2"})({display:"flex",width:"100%",height:"calc(100vh - 70px)",flexDirection:"column",justifyContent:"center",alignItems:"center"},"label:DivErrorLayout;"),or=(0,E.default)("p",{target:"e1bs9h2k3"})((({theme:e})=>[{margin:"24px 0 8px",fontSize:"24px",lineHeight:"28px"},(0,O.zy)({theme:e,fontFamily:"TikTokDisplayFont",fontWeight:"bold"})]),"label:PErrorTitle;"),rr=(0,E.default)("p",{target:"e1bs9h2k4"})((({theme:e})=>[{maxWidth:"480px",fontSize:"14px",lineHeight:"22px",color:"rgba(22, 24, 35, .75)",textAlign:"center"},(0,O.zy)({theme:e,fontFamily:"TikTokFont"})]),"label:PErrorDesc;"),sr=(0,E.default)("div",{target:"e1bs9h2k5"})({display:"flex",flexDirection:"row",width:`calc(100% - ${tr.dl} - ${tr.dK})`,justifyContent:"center"},"label:DivFullSideNavLayout;");var lr=n(71098);const dr=(0,d.B)((0,_.E)("messages")((0,c.c)("messages")((function({containerID:e,tabIndex:t}){var n;const d=(0,u.rl)(),{user:c}=null!==(n=(0,p.W)((()=>["user"]),[]))&&void 0!==n?n:{},_=(0,s.zy)(),b=(0,g.s)(),{chatMode:y}=(0,m.g9)((e=>({chatMode:e.chatMode})),v.bN),[C,x]=(0,o.useState)(!1),k=1===y,S=(0,h.Ig)();return(0,f.xw)("messages"),(0,gn.$)(),(0,lr.q)(),(0,o.useEffect)((()=>{const{sender_u:e,sender_n:t}=(0,a.parse)(_.search);(e&&(null==c?void 0:c.uniqueId)!==e||t&&(null==c?void 0:c.nickName)!==t)&&x(!0)}),[c,_.search]),C?(0,i.FD)(ar,{id:"main-content-messages",tabIndex:-1,children:[(0,i.Y)(l.A,{fill:"#808285",width:72,height:72}),(0,i.Y)(or,{children:b("dm_stranger_error_message_header")}),(0,i.Y)(rr,{children:b("dm_stranger_error_message_body")})]}):d?(0,i.FD)(i.FK,{children:[(0,i.Y)(r.mg,{children:(0,i.Y)("title",{children:b("SEO_dm_title")})}),(0,i.FD)(sr,{id:e,tabIndex:t,children:[(0,i.Y)(Ro,{}),k&&(0,i.Y)(ir,{})]}),(0,i.Y)(qo,{}),(0,i.Y)(Qo,{})]}):(0,i.FD)(i.FK,{children:[(0,i.Y)(r.mg,{children:(0,i.Y)("title",{children:b("SEO_dm_title")})}),(0,i.FD)(nr,{isInIframe:S,id:e,tabIndex:t,children:[(0,i.Y)(Fo.U,{isFromBusiness:S,ariaLabel:b("Back")}),(0,i.Y)(Ro,{}),k&&(0,i.Y)(ir,{})]}),(0,i.Y)(qo,{}),(0,i.Y)(Qo,{})]})}))))},55462:(e,t,n)=>{n.d(t,{ZP:()=>d,rF:()=>l,sZ:()=>c,yf:()=>s});var i=n(73580),a=n(40099),o=n(11654),r=n(23721);function s(){const{enable:e=!0,enableHeadComponent:t,enableInlineScript:n,enableUseSlardarPageViewHook:i}=(0,a.useContext)(r.ug);return{enable:e,enableHeadComponent:null!=t?t:e,enableInlineScript:null!=n?n:e,enableUseSlardarPageViewHook:null!=i?i:e}}function l({pid:e}){const t=(0,i.Nj)(o.V$),{enableUseSlardarPageViewHook:n}=s();(0,a.useEffect)((()=>{n&&(t.config({pid:e}),t.start(e))}),[e,t,n])}function d(){return(0,i.Nj)(o.V$)}function c(){const{enable:e}=s();return e}},43108:(e,t,n)=>{n.d(t,{c:()=>l});var i=n(24643),a=n(40099),o=n(47172),r=n(60322),s=n(33805);function l(e){return function(t){const n=n=>{const{selfFocusable:r=!1}=n,{pathname:l}=(0,o.useLocation)(),d=(0,a.useMemo)((()=>null!=e?e:(0,s.N2)(l)),[l]),c=(0,a.useMemo)((()=>"unknown"===d?void 0:`main-content-${d}`),[d]),u=(0,a.useMemo)((()=>r?0:void 0),[r]),p=(0,a.useMemo)((()=>Object.assign(Object.assign({},n),{tabIndex:u,containerID:c})),[n,u,c]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(t,Object.assign({},p))})};return n.displayName=`WithA11yFocusManagerHOC(${(0,r.x)(t)})`,n}}}}]);