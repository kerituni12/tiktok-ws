"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[6851],{32329:(e,t,i)=>{i.d(t,{VH:()=>s,yX:()=>c});var o=i(43723),n=i(31209);const s=(0,o.p)("followingRedDotAtom@tiktok/webapp-atoms",{redDotCount:0,hasVisitedFollowing:!1}),{useAtomService:a,useServiceDispatchers:r,useServiceState:l,getStaticApi:c}=(0,n.i)(s,((e,t)=>({setRedDotCount(e){t(s,(t=>Object.assign(Object.assign({},t),{redDotCount:e})))},setHasVisitedFollowing(e){t(s,(t=>Object.assign(Object.assign({},t),{hasVisitedFollowing:e})))}})))},84798:(e,t,i)=>{i.d(t,{BP:()=>l,E4:()=>o,Nr:()=>a,Sb:()=>s,ri:()=>n,zv:()=>r});const o=[500,3,2,6,7],n=[500,505,2,6,7],s={661:{value:661,label:"inbox_all_activity"},47:{value:47,label:"system_notifications_inbox_channel_name_accountupdates"},12:{value:12,label:"system_notifications_inbox_channel_name_tiktok"},61:{value:61,label:"system_notifications_inbox_channel_name_creatormonetization"},21:{value:21,label:"system_notifications_inbox_channel_name_adssupport"},82:{value:82,label:"system_notifications_inbox_channel_name_businessaccount"},81:{value:81,label:"promote_title"},212:{value:212,label:"TTweb_inbox_systemNotificationchannel_brandActivity_name"},215:{value:215,label:"TTweb_inbox_systemNotificationchannel_tiktokPlatform_name"},218:{value:218,label:"TTweb_inbox_systemNotificationchannel_adsFeedback_name"},223:{value:223,label:"TTweb_inbox_systemNotificationchannel_missions_name"},224:{value:224,label:"system_notifications_inbox_channel_name_transactionassistant"},249:{value:249,label:"TTweb_inbox_systemNotificationchannel_creatorProgram_name"},254:{value:254,label:"system_notifications_inbox_channel_name_live"},255:{value:255,label:"TTweb_inbox_systemNotificationchannel_screenTime_name"},256:{value:256,label:"TTweb_inbox_systemNotificationchannel_mlbb_name"},262:{value:262,label:"TTweb_inbox_systemNotificationchannel_series_name"},272:{value:272,label:"TTweb_inbox_systemNotificationchannel_creatorMarketplace_name"},274:{value:274,label:"TTweb_inbox_systemNotificationchannel_effects_name"},399:{value:399,label:"system_notifications_inbox_channel_name_accountupdates"}},a={661:"all",47:"account_updates",12:"tiktok",61:"creator_monetization",21:"ads_support",82:"business_account",81:"promotions",212:"brand_activity",215:"tiktok_platform",218:"ads_feedback",223:"missions",224:"transaction_assistant",249:"creator_program",254:"live",255:"screen_time",256:"mlbb",262:"series",272:"creator_marketplace",274:"effects",399:"video_muted"},r={500:"all",2:"comments",7:"followers",3:"likes",505:"likes",6:"mentions"},l=3},29039:(e,t,i)=>{i.d(t,{wU:()=>f,pz:()=>p,tP:()=>v,I$:()=>h});var o=i(18499),n=i(71281),s=i(22248),a=i(54888),r=i(43723),l=i(31209),c=i(32329),u=i(84798),d=i(56070),m=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((o=o.apply(e,t||[])).next())}))},_=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((o=o.apply(e,t||[])).next())}))};const p=(0,r.p)("inboxCountAtom@tiktok/webapp-atoms",{noticeCount:[],reportInbox:{noticeList:[],count:0},isFooterRequest:!1}),{useAtomService:g,useServiceDispatchers:v,useServiceState:h,getStaticApi:f}=(0,l.i)(p,((e,t)=>({setNoticeCount(e){t(p,(t=>Object.assign(Object.assign({},t),{noticeCount:"function"==typeof e?e(t.noticeCount):e})))},setIsFooterRequest(e){t(p,(t=>Object.assign(Object.assign({},t),{isFooterRequest:e})))},setReportInboxNoticeList(e){t(p,(t=>Object.assign(Object.assign({},t),{reportInbox:Object.assign(Object.assign({},t.reportInbox),{noticeList:e})})))},setReportInboxNoticeCount(e){t(p,(t=>Object.assign(Object.assign({},t),{reportInbox:Object.assign(Object.assign({},t.reportInbox),{count:e})})))},updateNoticeList(e){var t,i;if(0===e.status_code){const s="v0"!==(null!==(t=(0,n.d)("webapp_repost_notice"))&&void 0!==t?t:"v0");let a=0;const r=(null!==(i=e.notice_count)&&void 0!==i?i:[]).filter((e=>(5===e.group&&e.count>0&&(a=e.count),!!(661===e.group||s&&509===e.group)||(s?u.ri:u.E4).indexOf(e.group)>=0&&500!==e.group)));(0,o.unstable_batchedUpdates)((()=>{this.setNoticeCount(r),this.setIsFooterRequest(!0),(0,c.yX)().setRedDotCount(a)}))}},fetchNoticeCount(){return _(this,void 0,void 0,(function*(){try{const e=yield function(){return m(this,void 0,void 0,(function*(){return d.h.get("/api/inbox/notice_count/",{baseUrlType:2})}))}();(0,s.G)(e.status_code,[0]),this.updateNoticeList(e)}catch(e){}}))},fetchReportInbox(t){var i;return _(this,void 0,void 0,(function*(){const{region:n="",language:s=""}=t,{bizContext:r}=e(a.A);try{const{notice_lists:e}=yield function(e){return m(this,void 0,void 0,(function*(){return d.h.get("/aweme/v1/report/inbox/notice",{query:e,baseUrlType:2})}))}({request_tag_from:(null==r?void 0:r.isMobile)?"h5":"pc",carrier_region:n,sys_region:n,current_region:n,locale:s});if(!e)return;const{notice_list:t}=e[0];if(!t)return;const a=!1===(null===(i=t[0])||void 0===i?void 0:i.has_read)?1:0;(0,o.unstable_batchedUpdates)((()=>{this.setReportInboxNoticeList(t),this.setReportInboxNoticeCount(a)}))}catch(e){}}))},updateUnreadCount(e,t){const i=new Set([500]);switch(e){case 33:case 23:i.add(7);break;case 31:i.add(2);break;case 261:case 41:i.add(505);break;case 45:i.add(6);break;case 228:case 302:i.add(509)}const o="unread"===t?1:-1;this.setNoticeCount((e=>e.map((e=>i.has(e.group)?Object.assign(Object.assign({},e),{count:Math.max(e.count+o,0)}):e))))},_clearUnreadCount(e){const t=new Set(e);this.setNoticeCount((e=>e.map((e=>t.has(e.group)?Object.assign(Object.assign({},e),{count:0}):e))))},clearActivityNotifUnreadCount(){return this._clearUnreadCount([...u.ri,509])},clearSystemNotifUnreadCount(){return this._clearUnreadCount([661])}})))},22224:(e,t,i)=>{i.d(t,{Hp:()=>u,eh:()=>a,i7:()=>c,jx:()=>l,nG:()=>r});var o,n=i(31209),s=i(43723);!function(e){e.Main="main",e.ReportInbox="report-inbox",e.SystemNotif="system-notif"}(o||(o={}));const a=(0,s.p)("inboxAtom@tiktok/webapp-atoms",{activePage:"main",activeGroup:500,isShowing:!1,isFollowRequestShowing:!1,expandedLikeItem:null}),{useAtomService:r,useServiceState:l,useServiceDispatchers:c,getStaticApi:u}=(0,n.i)(a,((e,t)=>({setActivePage(e){t(a,(t=>Object.assign(Object.assign({},t),{activePage:e})))},setActiveGroup(e){t(a,(t=>Object.assign(Object.assign({},t),{activeGroup:e})))},setIsShowing(e){t(a,(t=>Object.assign(Object.assign({},t),{isShowing:e})))},setIsFollowRequestShowing(e){t(a,(t=>Object.assign(Object.assign({},t),{isFollowRequestShowing:e})))},setExpandedLikeItem(e){t(a,(t=>Object.assign(Object.assign({},t),{expandedLikeItem:e})))}})))},73611:(e,t,i)=>{i.d(t,{Ap:()=>l,K5:()=>r,PS:()=>c});var o=i(31209),n=i(43723);const s={isDrawerOpen:!1,isNavFullOpen:!0,drawerType:void 0,defaultDrawerType:void 0,moreDrawerNestedMenu:3,isDrawerAlwaysOpen:!1},a=(0,n.p)("leftNavDrawerAtom@tiktok/webapp-atoms",s),{useAtomService:r,useServiceState:l,useServiceDispatchers:c}=(0,o.i)(a,((e,t)=>({closeDrawer(){const{isDrawerAlwaysOpen:i,defaultDrawerType:o}=e(a);t(a,i?e=>Object.assign(Object.assign({},e),{moreDrawerNestedMenu:3,drawerType:o}):e=>Object.assign(Object.assign({},e),{isDrawerOpen:!1,moreDrawerNestedMenu:3,isNavFullOpen:!0}))},completeCloseDrawer(){t(a,s)},openDrawer(i){const o=e(a);t(a,(()=>Object.assign(Object.assign({},o),{isDrawerOpen:!0,drawerType:i})))},completeOpenDrawer(){t(a,(e=>Object.assign(Object.assign({},e),{isNavFullOpen:!1})))},changeMoreNestedMenu(i){const o=e(a);t(a,(()=>Object.assign(Object.assign({},o),{moreDrawerNestedMenu:i})))},setIsDrawerAlwaysOpenAndDefaultDrawerType({isDrawerAlwaysOpen:i,defaultDrawerType:o}){const n=e(a);t(a,(()=>Object.assign(Object.assign({},n),{defaultDrawerType:o,isDrawerAlwaysOpen:i}))),o&&this.openDrawer(o)}})))},18271:(e,t,i)=>{i.d(t,{A:()=>k});var o=i(24643),n=i(40099),s=i(93608),a=i(58542),r=i(47172),l=i(2584),c=i(25754),u=i(30023),d=i(84908),m=i(60072),_=i(7089),p=i(25616),g=i(60484),v=i(49057),h=i(5441),f=i(32125);const b="Inbox_Message",y={[-1]:"Follow",0:"Follow",1:"Following",3:"requested",2:"friends",4:"webapp_unblocked_button1",5:"Follow",6:"Inbox_Follow_back"};var w=i(88114),N=i(93240);const x={Follow:"follow_back_button",Following:"unfollow_button",friends:"friends_button",webapp_unblocked_button1:"unblock_button",requested:void 0,Inbox_Follow_back:"follow_back_button",Inbox_Message:"message_button"},k=(0,n.memo)((({isPopup:e,user:t})=>{var i,k;const j=(0,n.useContext)(N.V),S=(0,n.useCallback)((t=>{const i=x[t];s.f.sendEvent("click_notification",{enter_method:e?"notification_popup":"notification_panel",click_section:i})}),[e]),{handleFollow:I,isFollowing:C,text:q,relation:L}=function({uniqueId:e,followerStatus:t,prevent:i,onNeedLogin:o,teaParams:s={},isInLiveCard:a=!1,liveCardTeaParams:w={},liveFollowStatus:N,uidForMessage:x,onClickFollow:k}){const j=(0,p.s)(),S=(0,r.useHistory)(),{user:I,language:C="en"}=(0,g.L$)((0,v.W)((()=>["user","language"]),[])),q=Boolean(I),L=Boolean(x),A=function({lang:e,uid:t}){const i=(0,_.VR)((e=>e.businessPermission),f.bN),{isElectronApp:o}=(0,h.B)();return{path:i.message?`/business-suite/messages?from=homepage&lang=${e}&u=${t}`:`/messages?lang=${e}&u=${t}`,target:o&&i.message?"_blank":void 0}}({lang:C,uid:x}),[{relation:O,secUid:F},R]=(0,d.JY)((t=>{var i,o,n,s;return{relation:null!==(o=null===(i=t.users[e])||void 0===i?void 0:i.relation)&&void 0!==o?o:-1,secUid:null!==(s=null===(n=t.users[e])||void 0===n?void 0:n.secUid)&&void 0!==s?s:""}}),f.bN),D=((e,t,i=!1)=>{if(i&&(1===e||2===e))return b;if(1===t){if(e<1)return"Inbox_Follow_back";if(1===e)return y[2]}return y[e]})(O,t,L),T=j(D);(0,n.useEffect)((()=>{a&&R.setUserRelation({uniqueId:e,relation:Number(null!=N?N:0)})}),[]);const P=(0,m.mG)(),{play_mode:M,group_id:U}=s,B=(0,n.useCallback)((t=>{var n;return i&&(t.preventDefault(),t.stopPropagation()),null==k||k(D),l.O.handleGeneralClick("follow",{scene:null!==(n=s.scene)&&void 0!==n?n:"video_feed",group_id:U,play_mode:M}),q?4===O?R.blockOrUnblockUser({uniqueId:e,secUid:F,isBlock:!0}):D===b?(c.w.handleEnterChatList(void 0,"click_noti"),void(A.target?window.open(A.path,A.target):S.push(A.path))):(R.postCommitFollowUser(Object.assign(Object.assign({},s),{uniqueId:e,useFollowV2:!1})),1!==O&&P.addMlModelTrainData({id:s.group_id,action:"follow"}),void(a&&(1===O?u.YH.handleUnFollow(w):u.YH.handleFollow(w)))):null==o?void 0:o()}),[i,k,D,s,U,M,q,O,R,e,a,o,F,A.target,A.path,S,P,w]);return{isFollowing:1===O||2===O,text:T,handleFollow:B,relation:O}}({uniqueId:null!==(i=null==t?void 0:t.uniqueId)&&void 0!==i?i:"",followerStatus:null===(k=null==t?void 0:t.extraInfo)||void 0===k?void 0:k.followerStatus,prevent:!0,teaParams:{enter_from:s.f.commonParams.page_name},uidForMessage:e?null==t?void 0:t.id:void 0,onClickFollow:S}),A=(0,n.useCallback)((e=>{var t;null===(t=null==j?void 0:j.onInteract)||void 0===t||t.call(j),I(e)}),[I,j]),O=(0,n.useCallback)((e=>{var t;"Enter"!==e.key&&" "!==e.key||(null===(t=null==j?void 0:j.onInteract)||void 0===t||t.call(j),I(e))}),[j,I]);return e?(0,o.jsx)(a.I05,{"data-e2e":2===L?"":"follow-back",label:q,shape:"borderless",size:"xsmall",onClick:A,onKeyDown:O,disabled:3===L}):(0,o.jsxs)(w.MI,{"data-e2e":2===L?"":"follow-back",onClick:A,onKeyDown:O,size:"tiny",buttonTheme:C?"default":"primary",children:[2===L?(0,o.jsx)(a.nDe,{}):null,q]})}))},84951:(e,t,i)=>{i.d(t,{A4:()=>d,DW:()=>c,VQ:()=>l,i8:()=>m,xB:()=>u});var o=i(40099),n=i(57431),s=i(93608),a=i(82535),r=i(93240);function l({uniqueId:e,onClick:t,enterMethod:i,enterFrom:l,previousPage:c,shouldHandleDom:u,notifClickParams:d}){const m=(0,o.useContext)(r.V),_=(0,o.useMemo)((()=>(0,n.x)().user),[]),p=(null==_?void 0:_.uniqueId)===e;return(0,o.useCallback)((e=>{var o,n;let r=i;u&&(r=null!==(o=function(e){let t=e.target;for(;t&&!t.dataset.method&&t!==e.currentTarget;)t=t.parentElement;return null==t?void 0:t.dataset.method}(e))&&void 0!==o?o:i),null==t||t(e),null===(n=null==m?void 0:m.onInteract)||void 0===n||n.call(m),d&&s.f.sendEvent("click_notification",{enter_method:d.enterMethod,click_section:d.clickSection});const _=s.f.commonParams.page_name,g={enter_method:r,page_name:null!=l?l:_,enter_from:null!=l?l:_,previous_page:null!=c?c:_};p?a.q.handleEnterProfile(g):a.q.handleEnterUser(g)}),[i,u,t,m,d,l,c,p])}function c({onClick:e,isPopup:t}){const i=(0,o.useContext)(r.V);return(0,o.useCallback)((o=>{var n;o.preventDefault(),o.stopPropagation(),s.f.sendEvent("click_notification",{enter_method:t?"notification_popup":"notification_panel",click_section:"other_places"}),e&&(e(o),null===(n=null==i?void 0:i.onInteract)||void 0===n||n.call(i))}),[i,t,e])}function u({itemId:e,authorId:t}){return(0,o.useCallback)((()=>{a.q.handleEnterVideo({enter_method:"click_noti",group_id:e,to_group_id:e,to_author_id:t})}),[e,t])}function d({isPopup:e,itemId:t,authorId:i}){const n=(0,o.useContext)(r.V),a=u({itemId:t,authorId:i});return(0,o.useCallback)((t=>{var i;t.stopPropagation(),s.f.sendEvent("click_notification",{enter_method:e?"notification_popup":"notification_panel",click_section:"video_cover"}),null===(i=null==n?void 0:n.onInteract)||void 0===i||i.call(n),a()}),[n,e,a])}function m(){return(0,o.useMemo)((()=>{const{language:e}=(0,n.x)();return"ja-JP"===e||"zh-Hant-TW"===e||"zh-Hans"===e?"ã€‚":"."}),[])}},88114:(e,t,i)=>{i.d(t,{AZ:()=>u,Cw:()=>g,MI:()=>N,Oo:()=>v,PF:()=>_,VO:()=>f,aV:()=>d,e8:()=>h,h$:()=>m,ki:()=>b,ou:()=>p,qe:()=>w,xG:()=>y});var o=i(75431),n=i(62186),s=i(97397),a=i(67963),r=i(26290);const l=o.AH`
  --mask: radial-gradient(12px at calc(100% - 9px) calc(100% - 9px), #0000 98%, #000);
  mask: var(--mask);
`,c=o.AH`
  display: flex;
  overflow: hidden;
`,u=(0,n.default)("div",{target:"efggbpu0"})((()=>({position:"relative",height:"3rem",width:"3rem"})),"label:DivAvatarContainer;"),d=(0,n.default)("div",{target:"efggbpu1"})((({hasNoticeTypeIcon:e})=>e&&l),"label:DivAvatarInnerContainer;"),m=(0,n.default)("div",{target:"efggbpu2"})((({size:e})=>({position:"absolute",bottom:0,right:0,height:e,width:e})),"label:NoticeTypeIconContainer;"),_=(0,n.default)("div",{target:"efggbpu3"})((()=>({display:"flex",justifyContent:"space-between",alignTtems:"center",paddingBlockDtart:"14px",paddingInline:"16px"})),"label:DivNoticeHeader;"),p=(0,n.default)("div",{target:"efggbpu4"})((()=>[c,{flexDirection:"column",width:"var(--width)"}]),"label:DivNoticeContainerWithHeader;"),g=(0,n.default)("div",{target:"efggbpu5"})((()=>[c,{paddingInlineEnd:"52px",justifyContent:"space-between",width:"var(--width)"}]),"label:DivNoticeContainerWithoutHeader;"),v=(0,n.default)("div",{target:"efggbpu6"})((({$contentClickable:e})=>[c,{justifyContent:"space-between",paddingInline:"16px",paddingBlock:"12px",minHeight:"5rem",gap:"1rem",width:"100%",cursor:e?"pointer":"auto"}]),"label:DivNoticeContentContainer;"),h=(0,n.default)("div",{target:"efggbpu7"})((()=>[c,{alignItems:"center",gap:"1rem",flexGrow:1}]),"label:DivNoticeMainContainer;"),f=(0,n.default)("div",{target:"efggbpu8"})((()=>[c,{alignItems:"center",justifyContent:"center"}]),"label:DivNoticeActionContainer;"),b=(0,n.default)("div",{target:"efggbpu9"})((()=>[c,{flexGrow:1,flexDirection:"column",gap:"2px"}]),"label:DivNoticeTextContainer;"),y=(0,n.default)(r.F.P1,{target:"efggbpu10"})((()=>({overflow:"hidden",textOverflow:"ellipsis",wordBreak:"break-word",display:"-webkit-box","-webkit-line-clamp":2,"-webkit-box-orient":"vertical"})),"label:TextNoticeMessage;"),w=(0,n.default)(a.N_,{target:"efggbpu11"})((()=>({flex:"0 0 56px",width:"56px",height:"80px",background:"center no-repeat",backgroundSize:"cover",borderRadius:"6px"})),"label:StyledLinkVideoCover;"),N=(0,n.default)(s.y,{target:"efggbpu12"})({alignSelf:"center",flex:"0 0 auto","& > svg":{marginRight:"6px"}},"label:StyledFollowButtonInPanel;")},59909:(e,t,i)=>{i.d(t,{g:()=>v});var o=i(40099),n=i(47172),s=i(57431),a=i(84908),r=i(7089),l=i(60484),c=i(25616),u=i(5441),d=i(10646),m=i(97164),_=i(32125),p=i(69795),g=i(84951);function v({item:e,isPopup:t}){var i,v,h;const f=(0,l.L$)(e.comment.aweme),b=(0,o.useMemo)((()=>(0,s.x)().user),[]),y=(0,a.nW)((t=>{var i;return t.users[null!==(i=e.comment.comment.user.unique_id)&&void 0!==i?i:""]}),_.bN),w=(0,r.VR)((e=>e.businessPermission),_.bN),N=(0,n.useHistory)(),x=(0,c.s)(),{isElectronApp:k}=(0,u.B)(),j=(0,g.xB)({itemId:f.aweme_id,authorId:f.author.uid}),S=null===(h=null===(v=null===(i=f.video)||void 0===i?void 0:i.cover)||void 0===v?void 0:v.url_list)||void 0===h?void 0:h[0],I=(0,o.useMemo)((()=>w.comment&&f.author.uid===(null==b?void 0:b.uid)?`/business-suite/comments?video_id=${f.aweme_id}&comment_id=${e.comment.comment.cid}&from=homepage`:(0,p.TG)({uid:f.author.uid,awemeId:f.aweme_id,awemeType:f.aweme_type})),[w.comment,f.author.uid,f.aweme_id,f.aweme_type,e.comment.comment.cid,null==b?void 0:b.uid]),C=(0,o.useMemo)((()=>{var t,i;const{comment:o}=e,{comment_type:n,reply_comment:s}=o,a=null===(t=null==s?void 0:s.user)||void 0===t?void 0:t.uid;if(2===n||11===n){const e=a===(null==b?void 0:b.uid);return`${x(e?"Inbox_replied_to_your_comment":"Inbox_commented").replace(/%(s|@)/g,"")}${e?": ":""}${null!==(i=o.comment.text)&&void 0!==i?i:""}`}return 17===n||18===n?x("inbox_videoreply"):`${x("Inbox_commented").replace(/%(s|@)/g,"")}${o.comment.text}`}),[e,null==b?void 0:b.uid,x]),q=(0,o.useCallback)((e=>{d.Qq.setItem("highlight_comment",{id:e.comment.comment.cid,groupId:e.comment.aweme.aweme_id,uid:null==y?void 0:y.id,uniqueId:null==y?void 0:y.uniqueId,show:!0}),j();const t=`${I}?cid=${(0,m.X)(e.comment.comment.cid)}`;k?window.open(t,"_blank"):N.push(t,{browserMode:!0,cid:e.comment.comment.cid,vid:e.comment.aweme.aweme_id})}),[null==y?void 0:y.id,null==y?void 0:y.uniqueId,j,I,k,N]),L=(0,g.DW)({isPopup:t,onClick:(0,o.useCallback)((()=>{q(e)}),[e,q])}),A=(0,g.A4)({isPopup:t,itemId:f.aweme_id,authorId:f.author.uid});return{user:y,content:C,itemHref:I,coverUrl:S,handleClickNotice:L,handleClickVideoCover:A}}},39383:(e,t,i)=>{i.d(t,{U:()=>m});var o=i(24643),n=i(40099),s=i(47172),a=i(84908),r=i(25616),l=i(95868),c=i(32125),u=i(18271),d=i(84951);function m({item:e,isPopup:t}){var i;const m=(0,a.nW)((t=>{var i;return t.users[null!==(i=e.follow.from_user.unique_id)&&void 0!==i?i:""]}),c.bN),_=(0,s.useHistory)(),p=(0,r.s)(),g=(0,d.i8)(),v=(0,l.fJ)({uniqueId:null!==(i=null==m?void 0:m.uniqueId)&&void 0!==i?i:"",secUid:null==m?void 0:m.secUid}),h=(0,n.useMemo)((()=>0===e.follow.follow_button_type?p("Inbox_is_following_you").replace(/%s/g,"")+g:p("web_inappNotifs_startedFollowing",{s_nickname:""}).trim()),[e.follow.follow_button_type,g,p]),f=(0,n.useMemo)((()=>(0,o.jsx)(u.A,{user:m,isPopup:t})),[]),b=(0,d.VQ)({uniqueId:null==m?void 0:m.uniqueId,enterMethod:t?"notification_popup":"click_noti"}),y=(0,d.DW)({isPopup:t,onClick:(0,n.useCallback)((e=>{b(e),_.push(v)}),[_,b,v])});return{user:m,userHref:v,content:h,followButton:f,handleClickNotice:y}}},52757:(e,t,i)=>{i.d(t,{w:()=>f});var o=i(40099),n=i(47172),s=i(93608),a=i(81125),r=i(22224),l=i(73611),c=i(84908),u=i(60484),d=i(25616),m=i(10646),_=i(97164),p=i(32125),g=i(69795),v=i(84951),h=i(93240);function f({item:e,isPopup:t}){var i,f,b;const y=(0,u.L$)(e.digg.aweme),w=(0,o.useContext)(h.V),[N,x]=(0,r.nG)((e=>e.activeGroup)),k=(0,l.PS)(),j=(0,c.nW)((t=>{var i,o;return null!==(o=null===(i=e.digg.from_user)||void 0===i?void 0:i.flatMap((({unique_id:e})=>t.users[null!=e?e:""]||[])))&&void 0!==o?o:[]}),p.bN),S=(0,n.useHistory)(),I=(0,d.s)(),C=(0,v.i8)(),q=(0,v.xB)({itemId:y.aweme_id,authorId:y.author.uid}),L=null===(f=null===(i=y.video)||void 0===i?void 0:i.cover.url_list)||void 0===f?void 0:f[0],A=a.b.getInstance(),O=(0,o.useMemo)((()=>(0,g.TG)({uid:y.author.uid,awemeId:y.aweme_id,awemeType:y.aweme_type})),[y.author.uid,y.aweme_id,y.aweme_type]),F=(0,o.useMemo)((()=>{var t,i,o,n;if(1===e.digg.digg_type){if(void 0!==y.image_post_info){const e=null!==(o=null===(i=null===(t=y.image_post_info)||void 0===t?void 0:t.images)||void 0===i?void 0:i.length)&&void 0!==o?o:0;return I("photomode_inbox_liked",{num:e})}return`${I("Inbox_liked_your_video").replace(/%s/g,"")}${C}`}return 3===e.digg.digg_type?`${I("Inbox_liked_your_comment").replace(/%s/g,"")}: ${null===(n=e.digg.comment)||void 0===n?void 0:n.text}`:""}),[e.digg.digg_type,null===(b=e.digg.comment)||void 0===b?void 0:b.text,y.image_post_info,I,C]),R=(0,o.useCallback)((()=>{var i;t&&s.f.sendEvent("notification_panel_show",{enter_method:"notification_popup"}),A.handleEnterFold({tab_name:500===N?"all":"likes",group_id:null!==(i=e.digg.aweme.aweme_id)&&void 0!==i?i:""})}),[N,t,e.digg.aweme.aweme_id,A]),D=(0,o.useCallback)((e=>{var i,o,n;if(!e)return;const s=null!==(o=null===(i=e.digg.from_user)||void 0===i?void 0:i.length)&&void 0!==o?o:0;if(3===e.digg.digg_type||1===s){let t,i=O;3===e.digg.digg_type&&(null===(n=e.digg.comment)||void 0===n?void 0:n.cid)&&(m.Qq.setItem("highlight_comment",{id:e.digg.comment.cid,groupId:y.aweme_id,show:!0}),t={browserMode:!0,cid:e.digg.comment.cid,vid:y.aweme_id},i=`${O}?cid=${(0,_.X)(e.digg.comment.cid)}`),q(),S.push(i,t)}else s>1&&(t&&(null==w||w.dismissAll(),x.setIsFollowRequestShowing(!1),k.openDrawer(0),x.setIsShowing(!0)),x.setExpandedLikeItem(e),R())}),[O,q,S,y.aweme_id,t,x,R,w,k]),T=(0,v.DW)({isPopup:t,onClick:(0,o.useCallback)((()=>{D(e)}),[e,D])}),P=(0,v.A4)({isPopup:t,itemId:y.aweme_id,authorId:y.author.uid});return{users:j,content:F,itemHref:O,coverUrl:L,handleClickNotice:T,handleClickVideoCover:P}}},70836:(e,t,i)=>{i.d(t,{h:()=>_});var o=i(40099),n=i(47172),s=i(84908),a=i(60484),r=i(25616),l=i(10646),c=i(97164),u=i(32125),d=i(69795),m=i(84951);function _({item:e,isPopup:t}){var i,_,p,g,v,h,f;const b=(0,a.L$)(e.at.aweme),y=(0,s.nW)((t=>{var i,o;return t.users[null!==(o=null===(i=e.at.user_info)||void 0===i?void 0:i.unique_id)&&void 0!==o?o:""]}),u.bN),w=(0,n.useHistory)(),N=(0,r.s)(),x=(0,m.xB)({itemId:b.aweme_id,authorId:null!==(_=null===(i=b.author)||void 0===i?void 0:i.uid)&&void 0!==_?_:""}),k=null===(v=null===(g=null===(p=b.video)||void 0===p?void 0:p.cover)||void 0===g?void 0:g.url_list)||void 0===v?void 0:v[0],j=(0,o.useMemo)((()=>{var e,t;return(0,d.TG)({uid:null===(e=b.author)||void 0===e?void 0:e.uid,awemeId:null!==(t=b.aweme_id)&&void 0!==t?t:"",awemeType:b.aweme_type})}),[b.author.uid,b.aweme_id,b.aweme_type]),S=(0,o.useMemo)((()=>{var t,i,o;const{at:n}=e,{sub_type:s,content:a,aweme:r}=n,l=void 0!==(null==r?void 0:r.image_post_info);if(1===s){if(l){const e=null!==(o=null===(i=null===(t=r.image_post_info)||void 0===t?void 0:t.images)||void 0===i?void 0:i.length)&&void 0!==o?o:0;return N("in_app_push_mention_in_photo",{num:e})}return N("Inbox_mentioned_you_in_a_video").replace(/%(s|#)/g,"")}return 2===s?`${N("Inbox_mentioned_you_in_a_comment").replace("%@"," ").replace("%#","")}${a}`:5===s?`${N("Inbox_replied_to_your_comment").replace("%s","")}${a}`:""}),[e,N]),I=(0,o.useCallback)((e=>{var t,i,o;const{schema_url:n}=e.at,s=(null!==(t=null==n?void 0:n.match(/cid=(\d+)/))&&void 0!==t?t:[])[1],a=(null!==(i=null==n?void 0:n.match(/detail\/(\d+)/))&&void 0!==i?i:[])[1];let r;s&&(l.Qq.setItem("highlight_comment",{id:s,groupId:a,show:!0}),r={browserMode:!0,cid:s,vid:a}),x();let u=j;(null===(o=e.at.comment)||void 0===o?void 0:o.cid)&&(u=`${j}?cid=${(0,c.X)(e.at.comment.cid)}`),w.push(u,r)}),[x,j,w]),C=(0,m.DW)({isPopup:t,onClick:(0,o.useCallback)((()=>{I(e)}),[I,e])}),q=(0,m.A4)({isPopup:t,itemId:b.aweme_id,authorId:null!==(f=null===(h=b.author)||void 0===h?void 0:h.uid)&&void 0!==f?f:""});return{user:y,content:S,itemHref:j,coverUrl:k,handleClickNotice:C,handleClickVideoCover:q}}},91505:(e,t,i)=>{i.d(t,{A:()=>d});var o=i(40099),n=i(47172),s=i(84908),a=i(25616),r=i(32125),l=i(69795),c=i(84951);const u={228:"pcWeb_inbox_repostedSame",261:"pcWeb_inbox_likedRepost",302:"pcWeb_inbox_repostedYour"};function d({item:e,isPopup:t}){const i=(0,s.nW)((t=>{var i,o,n,s;return null!==(s=null===(n=null===(o=null===(i=e.template_notice.notice)||void 0===i?void 0:i.title)||void 0===o?void 0:o.from_users)||void 0===n?void 0:n.flatMap((({unique_id:e})=>t.users[null!=e?e:""]||[])))&&void 0!==s?s:[]}),r.bN),d=(0,n.useHistory)(),m=(0,a.s)(),{awemeId:_,authorId:p,coverUrl:g,isPhotoMode:v}=(0,l.c)(e),h=(0,c.xB)({itemId:null!=_?_:"",authorId:null!=p?p:""}),f=(0,o.useMemo)((()=>(0,l.TG)({uid:null!=p?p:"",awemeId:null!=_?_:"",awemeType:v?150:void 0})),[p,_,v]),b=(0,o.useMemo)((()=>228===e.type||261===e.type||302===e.type?m(u[e.type]):""),[e,m]),y=(0,c.DW)({isPopup:t,onClick:(0,o.useCallback)((()=>{h(),d.push(f)}),[h,d,f])}),w=(0,c.A4)({isPopup:t,itemId:null!=_?_:"",authorId:null!=p?p:""});return{users:i,content:b,itemHref:f,coverUrl:g,handleClickVideoCover:w,handleClickNotice:y}}},93240:(e,t,i)=>{i.d(t,{V:()=>s,p:()=>a});var o=i(24643),n=i(40099);const s=(0,n.createContext)(void 0),a=e=>{var{toastId:t,notification:i,dismiss:a,dismissAll:r,onInteract:l}=e,c=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(i[o[n]]=e[o[n]])}return i}(e,["toastId","notification","dismiss","dismissAll","onInteract"]);const u=(0,n.useCallback)((()=>{null==l||l(i)}),[l,i]),d=(0,n.useMemo)((()=>({toastId:t,notification:i,dismiss:a,dismissAll:r,onInteract:u})),[t,i,a,r,u]);return(0,o.jsx)(s.Provider,Object.assign({value:d},c))}},29055:(e,t,i)=>{var o;i.d(t,{d:()=>o}),function(e){e.Language="language"}(o||(o={}))},6520:(e,t,i)=>{i.d(t,{h:()=>ne});var o=i(24643),n=i(48514),s=i(40099),a=i(47172),r=i(93608),l=i(58542),c=i(25616),u=i(26290),d=i(69795),m=i(88114),_=i(46803),p=i(58305),g=i(95868),v=i(67963),h=i(84951);const f="1.125rem",b={41:(0,o.jsx)(l.Twf,{size:f}),45:(0,o.jsx)(l.HEM,{size:f}),302:(0,o.jsx)(l.lqC,{size:f}),31:(0,o.jsx)(l.rs3,{size:f})},y=(0,s.memo)((({noticeType:e})=>e in b?(0,o.jsx)(m.h$,{size:f,children:b[e]}):null)),w=(0,s.memo)((({noticeType:e,users:t})=>{var i,n;const s=(0,c.s)(),a=(0,h.VQ)({uniqueId:null===(i=t[0])||void 0===i?void 0:i.uniqueId,enterMethod:"click_head",notifClickParams:{enterMethod:"notification_popup",clickSection:"profile_picture"}});if(0===t.length)return null;const r=e in b,u=r?(0,o.jsx)(y,{noticeType:e}):null;if(1===t.length){const{uniqueId:e="",secUid:i,nickname:c}=null!==(n=t[0])&&void 0!==n?n:{},d=(0,g.fJ)({uniqueId:e,secUid:i});return(0,o.jsx)(m.AZ,{onClick:p.dG,children:(0,o.jsxs)(v.N_,{to:d,onClick:a,"aria-label":s("accessibilityLabels_link_userProfile",{username:c}),children:[(0,o.jsx)(m.aV,{"data-e2e":"notice-avatar",hasNoticeTypeIcon:r,children:(0,o.jsx)(l.pfZ,{src:t[0].avatarThumb,alt:s("editprofile_editpage_photo"),size:48})}),u]})})}return(0,o.jsxs)(m.AZ,{onClick:p.dG,children:[(0,o.jsx)(m.aV,{"data-e2e":"notice-avatar-multiple",hasNoticeTypeIcon:r,children:(0,o.jsx)(l.pmp,{frontImageSrc:t[0].avatarThumb,backImageSrc:t[1].avatarThumb,alt:s("editprofile_editpage_photo"),size:48})}),u]})})),N=(0,s.memo)((function({user:e}){const t=(0,c.s)(),i=(0,h.VQ)({uniqueId:null==e?void 0:e.uniqueId,enterMethod:"click_name",notifClickParams:{enterMethod:"notification_popup",clickSection:"user_name"}});if(!e)return null;const{uniqueId:n,secUid:s,nickname:a}=e,r=(0,g.fJ)({uniqueId:n,secUid:s});return(0,o.jsx)(v.N_,{to:r,onClick:i,"aria-label":t("accessibilityLabels_link_userProfile",{username:a}),children:e.nickname})})),x=(0,s.memo)((({users:e,mergeCount:t})=>{const i=(0,c.s)(),n=e[1]?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(N,{user:e[0]}),", ",(0,o.jsx)(N,{user:e[1]}),t>2&&(0,o.jsxs)(o.Fragment,{children:[" ",i("Inbox_and")," ",i("Inbox_others").replace(/%d/,String(t-2))]})]}):(0,o.jsx)(N,{user:e[0]});return(0,o.jsx)("div",{"data-e2e":"notice-title",onClick:p.dG,children:(0,o.jsx)(u.F.H4,{weight:"medium",children:n})})})),k=(0,s.memo)((({users:e,content:t,createTime:i,mergeCount:n,onClick:s,action:a,noticeType:r})=>{const{timeTranslator:l}=(0,_.T)();return(0,o.jsxs)(m.Oo,{"data-e2e":"notice-list-item",onClick:s,$contentClickable:void 0!==s,children:[(0,o.jsxs)(m.e8,{children:[(0,o.jsx)(w,{noticeType:r,users:e}),(0,o.jsxs)(m.ki,{"data-e2e":"notice-main",children:[(0,o.jsx)(x,{users:e,mergeCount:null!=n?n:e.length}),(0,o.jsx)(m.xG,{children:t}),(0,o.jsx)(u.F.P1,{color:"UIText3",children:l(1e3*Number(i))})]})]}),a&&(0,o.jsx)(m.VO,{onClick:p.dG,children:a})]})}));var j=i(59909);const S=(0,s.memo)((({item:e})=>{const{user:t,content:i,itemHref:n,coverUrl:s,handleClickNotice:a,handleClickVideoCover:r}=(0,j.g)({item:e,isPopup:!0});return t?(0,o.jsx)(k,{noticeType:e.type,users:[t],content:i,createTime:e.create_time,action:s?(0,o.jsx)(m.qe,{onClick:r,to:n,style:{backgroundImage:`url(${s})`}}):null,onClick:a}):null}));var I=i(39383);const C=(0,s.memo)((({item:e})=>{const{user:t,content:i,followButton:n}=(0,I.U)({item:e,isPopup:!0});return t?(0,o.jsx)(k,{noticeType:e.type,users:[t],content:i,createTime:e.create_time,action:n}):null}));var q=i(84908),L=i(32125);const A=(0,s.memo)((({item:e})=>{const{user:t,content:i}=function({item:e}){const t=(0,q.nW)((t=>{var i;return t.users[null!==(i=e.follow_request_approve.from_user.unique_id)&&void 0!==i?i:""]}),L.bN),i=(0,c.s)(),o=(0,h.i8)();return{user:t,content:(0,s.useMemo)((()=>i("Inbox_approved_your_follow_request").replace(/%s/g,"")+o),[o,i])}}({item:e});return t?(0,o.jsx)(k,{noticeType:e.type,users:[t],content:i,createTime:e.create_time}):null}));var O=i(81125),F=i(22224),R=i(73611),D=i(93240),T=i(56070),P=i(26325),M=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((o=o.apply(e,t||[])).next())}))};const U=(0,s.memo)((({user:e,onAccept:t})=>{const i=(0,s.useContext)(D.V),n=(0,q.eI)(),a=(0,c.s)(),[u,d]=(0,s.useState)(!1),m=O.b.getInstance(),_=(0,s.useCallback)((e=>M(void 0,void 0,void 0,(function*(){m.handleFollowRequestAction({action:"accept",to_user_id:e}),yield function(e){return M(this,void 0,void 0,(function*(){return T.h.post("/api/commit/follow/request/approve/",{query:{from_user_id:e,from:33},headers:{[P.nk]:T.h.csrfToken}})}))}(e)}))),[m]),p=(0,s.useCallback)(((o,s)=>M(void 0,void 0,void 0,(function*(){var a;r.f.sendEvent("click_notification",{enter_method:"notification_popup",click_section:"accept_button"}),o.stopPropagation(),o.preventDefault(),e&&(null===(a=null==i?void 0:i.onInteract)||void 0===a||a.call(i),d(!0),n.setUserRelation({uniqueId:e.uniqueId,relation:1===e.relation?2:6,shouldUpdateFollowed:!0}),t(),yield _(s))}))),[e,i,n,t,_]),g=(0,s.useCallback)(((e,t)=>M(void 0,void 0,void 0,(function*(){"Enter"!==e.key&&" "!==e.key||(yield p(e,t))}))),[p]);return e?(0,o.jsx)(l.I05,{"data-e2e":"inbox-request-accept",label:a("inbox_request_accept"),"aria-label":a("inbox_request_accept"),shape:"borderless",size:"xsmall",onClick:t=>p(t,e.id),onKeyDown:t=>g(t,e.id),disabled:u}):null}));var B=i(18271);const G=(0,s.memo)((({item:e})=>{const{users:t,content:i,followButton:n,handleClickNotice:a}=function({item:e}){const t=(0,s.useContext)(D.V),i=(0,F.i7)(),n=(0,R.PS)(),a=(0,q.nW)((t=>e.users.flatMap((e=>t.users[e]||[]))),L.bN),l=(0,c.s)(),[u,d]=(0,s.useState)(!1),m=O.b.getInstance(),_=(0,s.useCallback)((()=>{r.f.sendEvent("notification_panel_show",{enter_method:"notification_popup"}),m.handleEnterFollow({request_cnt:Number(e.total)})}),[e.total,m]),p=(0,s.useMemo)((()=>l("web_inappNotifs_followRequest",{s_nickname:""}).trim()),[l]),g=(0,s.useMemo)((()=>1!==a.length?null:u?(0,o.jsx)(B.A,{user:a[0],isPopup:!0}):(0,o.jsx)(U,{user:a[0],onAccept:()=>d(!0)})),[u,a]),v=(0,s.useCallback)((()=>{var e;null==t||t.dismissAll(),null===(e=null==t?void 0:t.onInteract)||void 0===e||e.call(t),n.openDrawer(0),i.setIsShowing(!0),i.setIsFollowRequestShowing(!0),_()}),[t,n,i,_]),f=(0,h.DW)({isPopup:!0,onClick:v});return{users:a,content:p,followButton:g,handleClickNotice:a.length>1?f:void 0}}({item:e});return 0===t.length?null:(0,o.jsx)(k,{noticeType:33,users:t,mergeCount:Number(e.total),content:i,createTime:Date.now()/1e3,action:n,onClick:a})}));var E=i(52757);const $=(0,s.memo)((({item:e})=>{const{users:t,content:i,itemHref:n,coverUrl:s,handleClickNotice:a,handleClickVideoCover:r}=(0,E.w)({item:e,isPopup:!0});return 0===t.length?null:(0,o.jsx)(k,{noticeType:e.type,users:t,mergeCount:e.digg.merge_count,content:i,createTime:e.create_time,action:s?(0,o.jsx)(m.qe,{onClick:r,to:n,style:{backgroundImage:`url(${s})`}}):null,onClick:a})}));var H=i(70836);const V=(0,s.memo)((({item:e})=>{const{user:t,content:i,itemHref:n,coverUrl:s,handleClickNotice:a,handleClickVideoCover:r}=(0,H.h)({item:e,isPopup:!0});return t?(0,o.jsx)(k,{noticeType:e.type,users:[t],content:i,createTime:e.create_time,action:s?(0,o.jsx)(m.qe,{onClick:r,to:n,style:{backgroundImage:`url(${s})`}}):null,onClick:a}):null}));var z=i(91505);const W=(0,s.memo)((({item:e})=>{var t,i,n;const{users:s,content:a,itemHref:r,coverUrl:l,handleClickNotice:c,handleClickVideoCover:u}=(0,z.A)({item:e,isPopup:!0});return 0===s.length?null:(0,o.jsx)(k,{noticeType:e.type,users:s,mergeCount:null!==(n=null===(i=null===(t=e.template_notice.notice)||void 0===t?void 0:t.title)||void 0===i?void 0:i.merge_count)&&void 0!==n?n:0,content:a,createTime:e.create_time,action:l?(0,o.jsx)(m.qe,{onClick:u,to:r,style:{backgroundImage:`url(${l})`}}):null,onClick:c})}));var J=i(90161),Z=i(57431),X=i(4929);const K=(0,i(62186).default)("div",{target:"ej05cyr0"})((()=>({display:"flex",position:"relative",width:"48px",height:"48px",borderRadius:"50%",overflow:"hidden",flexShrink:0,backgroundColor:l.Tj4.UIPageGrouped3,justifyContent:"center",alignItems:"center"})),"label:DivIconContainer;"),Q=(0,s.memo)((()=>{const e=(0,c.s)(),{language:t}=(0,Z.x)(),i=e(X.d4.includes(t)?"addLangs_notif_noSettV1_body":"addLangs_notif_noSettV2_body");return(0,o.jsx)(m.Oo,{"data-e2e":"notice-list-item",$contentClickable:!1,children:(0,o.jsxs)(m.e8,{children:[(0,o.jsx)(K,{children:(0,o.jsx)(J.c,{size:24})}),(0,o.jsxs)(m.ki,{"data-e2e":"notice-main",children:[(0,o.jsx)(u.F.H4,{weight:"medium",children:e("inbox_filter_channelname_system_notifications")}),(0,o.jsx)(m.xG,{children:i})]})]})})})),Y=({notification:e})=>d.BS.isFollowRequest(e)?(0,o.jsx)(G,{item:e}):d.BS.isFollowNotice(e)?(0,o.jsx)(C,{item:e}):d.BS.isFollowApprovalNotice(e)?(0,o.jsx)(A,{item:e}):d.BS.isLikeNotice(e)?(0,o.jsx)($,{item:e}):d.BS.isCommentNotice(e)?(0,o.jsx)(S,{item:e}):d.BS.isMentionNotice(e)?(0,o.jsx)(V,{item:e}):d.BS.isRepostInboxNotice(e)?(0,o.jsx)(W,{item:e}):d.BS.isSystemLanguageNotice(e)?(0,o.jsx)(Q,{}):null,ee=e=>{const t=(0,c.s)();return(0,o.jsxs)(m.ou,{children:[(0,o.jsx)(m.PF,{children:(0,o.jsx)(u.F.H3,{weight:"medium",children:t("web_inappNotifs_Notification_header")})}),(0,o.jsx)(Y,Object.assign({},e))]})},te=e=>(0,o.jsxs)(m.Cw,{children:[(0,o.jsx)(Y,Object.assign({},e)),(0,o.jsx)("div",{children:(0,o.jsx)(l.hIm,{direction:"vertical"})})]}),ie=(0,s.memo)((({id:e,dismiss:t,dismissAll:i,onInteract:n,layoutType:s,notification:a})=>{const r="withHeader"===s?ee:te;return(0,o.jsx)(D.p,{toastId:e,notification:a,dismiss:t,dismissAll:i,onInteract:n,children:(0,o.jsx)(r,{notification:a})})}));let oe=1;function ne(e){const t=(0,a.useHistory)(),i=(0,s.useRef)({}),l=(0,s.useCallback)((({item:e})=>{const t=(0,d.uV)(e);r.f.sendEvent("notification_popup_show",{popup_type:t})}),[]),c=(0,s.useCallback)((({enterMethod:e,toastId:t})=>{const o=i.current[t];if(o){const n=(0,d.uV)(o);r.f.sendEvent("close_notification_popup",{enter_method:e,popup_type:n}),delete i.current[t]}}),[]),u=(0,s.useCallback)((e=>{c({enterMethod:"user_close",toastId:Number(e.id)})}),[c]),m=(0,s.useCallback)((e=>{c({enterMethod:"auto_close",toastId:Number(e.id)})}),[c]),_=(0,s.useCallback)((e=>{c({enterMethod:"user_close",toastId:Number(e)}),n.oR.dismiss(e)}),[c]),p=(0,s.useCallback)((()=>{Object.keys(i.current).forEach((e=>{c({enterMethod:"user_leaves_page",toastId:Number(e)})})),n.oR.dismiss()}),[c]),g=(0,s.useCallback)((t=>{const s=oe++;i.current[s]=t.notification,l({item:t.notification}),(0,n.oR)((0,o.jsx)(ie,Object.assign(Object.assign(Object.assign({},e),t),{id:s,dismiss:()=>_(s),dismissAll:p})),{id:s,onDismiss:u,onAutoClose:m})}),[e,p,_,l,m,u]);return(0,s.useEffect)((()=>t.listen(p)),[p,c,t]),(0,s.useMemo)((()=>({show:g,dismissAll:p})),[g,p])}},69795:(e,t,i)=>{i.d(t,{BS:()=>l,TG:()=>c,c:()=>u,uV:()=>d});var o=i(57431),n=i(95868),s=i(60484),a=i(29055);const r=[228,261,302],l={isFollowRequest:e=>!("type"in e)&&"users"in e,isFollowNotice:e=>"type"in e&&33===e.type&&Boolean(e.follow),isFollowApprovalNotice:e=>"type"in e&&23===e.type&&Boolean(e.follow_request_approve),isLikeNotice:e=>"type"in e&&41===e.type&&Boolean(e.digg),isCommentNotice:e=>"type"in e&&31===e.type&&Boolean(e.comment),isDuetNotice:e=>"type"in e&&21===e.type&&Boolean(e.duet),isMentionNotice:e=>"type"in e&&45===e.type&&Boolean(e.at),isReportInboxNotice:e=>"type"in e&&213===e.type&&Boolean(e.template_notice),isRepostInboxNotice:e=>"type"in e&&r.includes(e.type)&&Boolean(e.template_notice),isSystemLanguageNotice:e=>"section"in e&&e.section===a.d.Language};function c({uid:e,awemeId:t,awemeType:i}){return(0,n.yw)({uniqueId:e,secUid:e,itemId:t,isPhoto:150===i})}function u(e){var t,i,n,s,a,r;const l=null===(t=e.template_notice.extra_data)||void 0===t?void 0:t.nudge_info,c=e.template_notice.notice;let{aweme_id:u,author_id:d,cover_url:m,aweme_type:_}=null!=l?l:{};if(m||(m=null===(n=null===(i=null==c?void 0:c.image_url)||void 0===i?void 0:i.url_list)||void 0===n?void 0:n[0]),u||(u=null===(a=null===(s=null==c?void 0:c.right_schema_url)||void 0===s?void 0:s.match(/\/detail\/(\d+)/))||void 0===a?void 0:a[1]),!d&&302===e.type){const{user:e}=(0,o.x)();d=null==e?void 0:e.uid}return{isPhotoMode:150===_||null!==(r=null==m?void 0:m.includes("photomode"))&&void 0!==r&&r,awemeId:u,authorId:d,coverUrl:m}}function d(e){var t;if(l.isLikeNotice(e))return void 0!==(0,s.L$)(e.digg.aweme).image_post_info?"photo_like":3===e.digg.digg_type?"comment_like":"video_like";if(l.isCommentNotice(e)){const{comment:i}=e,{comment_type:n,reply_comment:s}=i,a=null===(t=null==s?void 0:s.user)||void 0===t?void 0:t.uid;if(2===n||11===n){const e=(0,o.x)().user;return a===(null==e?void 0:e.uid)?"reply_to_comment":"video_comment"}return"video_comment"}if(l.isMentionNotice(e)){const{at:t}=e,{sub_type:i}=t;if(1===i)return"tagged_in_video";if(2===i)return"tagged_in_comment";if(5===i)return"reply_to_comment"}return l.isRepostInboxNotice(e)?"repost_video":l.isFollowRequest(e)?"follow_request":l.isFollowNotice(e)?"follow":l.isFollowApprovalNotice(e)?"accept_follow_request":"unknown"}},16851:(e,t,i)=>{i.d(t,{Cp:()=>me,P4:()=>ue,Kd:()=>_e});var o=i(58632),n=i(40099),s=i(6520),a=i(26263),r=i(6585),l=i(69795),c=i(57431),u=i(16085),d=i(29039),m=i(32125),_=i(88920),p=i(41271),g=i(46682),v=i(19442),h=i(84798),f=i(18499),b=i(300),y=i.n(b),w=i(81125),N=i(22248),x=i(22224),k=i(84908),j=i(8800),S=i(71111),I=i(31209),C=i(56070),q=i(26325);function L(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return C.h.get("/api/notice/multi/",{query:e,baseUrlType:2})}))}function A(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return C.h.get("/api/inbox/notice_list/",{query:e,baseUrlType:2})}))}var O=i(40858);const F=1,R={has_more:1,max_time:0,min_time:0,notice_list:[],loading:!1},D={diggList:{users:[],loading:!1,has_more:1,max_cursor:0,min_cursor:0},activeSystemNoticeGroup:null,noticeList:R,followRequest:{has_more:!1,min_time:0,total:0,users:[],loading:!1},latestSystemNotice:null},T=(0,S.atom)(D),P=(0,S.atom)((e=>Object.assign(Object.assign({},e(T)),{inboxTabShowing:e(x.eh).isShowing,activeGroup:e(x.eh).activeGroup})),((e,t)=>{t(T,D)}));let M;P.debugLabel="noticeAtom";const{useAtomService:U,useServiceState:B,useServiceDispatchers:G,getStaticApi:E}=(0,I.i)(P,((e,t)=>({setInboxTabShowing(e){(0,x.Hp)().setIsShowing(e)},setActiveGroup(e){(0,x.Hp)().setActiveGroup(e)},setActiveSystemNoticeGroup(e){t(T,(t=>Object.assign(Object.assign({},t),{activeSystemNoticeGroup:e})))},setNoticeList(e){t(T,(t=>Object.assign(Object.assign({},t),{noticeList:e})))},setNoticeListLoading(e){t(T,(t=>Object.assign(Object.assign({},t),{noticeList:Object.assign(Object.assign({},t.noticeList),{loading:e})})))},setLatestSystemNotice(e){t(T,(t=>Object.assign(Object.assign({},t),{latestSystemNotice:e})))},changeActiveGroup({group:e}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){M||(M=w.b.getInstance()),M.handleChangeTab({to_tab_name:h.zv[e]}),(0,f.unstable_batchedUpdates)((()=>{this.setActiveGroup(e),this.setNoticeList(R)}));const t=[this.fetchNoticeData()];500===e&&t.push(this.fetchLatestSystemNotice()),yield Promise.all(t)}))},changeActiveSystemNoticeGroup(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){M||(M=w.b.getInstance()),M.handleChangeSystemNotificationTab({to_tab_name:h.Nr[e]}),(0,f.unstable_batchedUpdates)((()=>{this.setActiveSystemNoticeGroup(e),this.setNoticeList(R)})),yield this.fetchSystemNoticeData()}))},fetchNoticeData(t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeGroup:o,noticeList:n}=e(P),{fetchLatest:s,markAsRead:a=F}=null!=t?t:{};if(a&&(0,d.wU)().clearActivityNotifUnreadCount(),n.loading||!s&&!n.has_more)return;const r={count:20,is_mark_read:a?1:0,group:o,max_time:s?0:n.max_time,min_time:s?n.max_time:n.min_time};this.setNoticeListLoading(!0);try{const e=yield L({aid:1988,group_list:JSON.stringify([r])});if((0,N.G)(e.status_code,[0]),0===e.status_code){const{notice_lists:t}=e;if(null==t?void 0:t.length){const{has_more:e,max_time:o,min_time:a,notice_list:r=[]}=t[0];r.forEach((e=>{(0,O.mX)(e)}));const l=y()([...null!==(i=n.notice_list)&&void 0!==i?i:[],...r].sort(((e,t)=>Number(BigInt(t.create_time)-BigInt(e.create_time)))),(e=>{var t;return null!==(t=e.nid_str)&&void 0!==t?t:e.nid}));(0,f.unstable_batchedUpdates)((()=>{(0,k.Gp)().multiSetUser(this.getNoticeUsers(r)),s?this.setNoticeList({has_more:n.has_more,max_time:l[0].create_time,min_time:n.min_time,notice_list:l,loading:!1}):this.setNoticeList({has_more:e,max_time:o,min_time:a,notice_list:l,loading:!1})}))}else this.setNoticeList({has_more:0,min_time:n.min_time,max_time:n.max_time,notice_list:n.notice_list,loading:!1})}}catch(e){this.setNoticeListLoading(!1)}}))},markAsRead(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t={count:1,is_mark_read:1,group:500,max_time:Number(e.create_time)+.001,min_time:e.create_time},i=(0,d.wU)();try{i.updateUnreadCount(e.type,"read");const{status_code:o}=yield L({aid:1988,group_list:JSON.stringify([t])});(0,N.G)(o,[0]),0!==o&&i.updateUnreadCount(e.type,"unread")}catch(e){}}))},fetchSystemNoticeData(){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeSystemNoticeGroup:i,noticeList:o}=e(P);if((0,d.wU)().clearSystemNotifUnreadCount(),!o.loading&&o.has_more&&null!=i){this.setNoticeListLoading(!0);try{const e=yield A({aid:1988,group_list:JSON.stringify([{count:20,is_mark_read:F,group:i,max_time:o.max_time,min_time:o.min_time}])});if(0!==e.status_code)return void this.setNoticeListLoading(!1);const{notice_lists:n}=e;if(null==n?void 0:n.length){const{has_more:e,max_time:i,min_time:s,notice_list:a=[]}=n[0];this.setNoticeList({has_more:e?1:0,max_time:i,min_time:s,notice_list:[...null!==(t=o.notice_list)&&void 0!==t?t:[],...a],loading:!1})}else this.setNoticeList({has_more:0,min_time:o.min_time,max_time:o.max_time,notice_list:o.notice_list,loading:!1})}catch(e){}this.setNoticeListLoading(!1)}}))},fetchLatestSystemNotice(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield A({aid:1988,group_list:JSON.stringify([{count:1,is_mark_read:0,group:661,max_time:0,min_time:0}])});if(0!==i.status_code)return;const{notice_lists:o}=i;(null==o?void 0:o.length)?this.setLatestSystemNotice(null!==(t=null===(e=o[0].notice_list)||void 0===e?void 0:e[0])&&void 0!==t?t:null):this.setLatestSystemNotice(null)}))},setDiggList(e){t(T,(t=>Object.assign(Object.assign({},t),{diggList:Object.assign(Object.assign({},t.diggList),{users:e})})))},setDiggListLoading(e){t(T,(t=>Object.assign(Object.assign({},t),{diggList:Object.assign(Object.assign({},t.diggList),{loading:e})})))},fetchDiggListData({ref_id:t}){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{diggList:n}=e(P);if(n.loading||!n.has_more)return;const s={count:20,max_cursor:n.max_cursor,min_cursor:n.min_cursor,digg_type:1,ref_id:t,aid:1988};this.setDiggListLoading(!0);const a=yield function(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return C.h.get("/api/notice/digg/list/",{query:e,baseUrlType:2})}))}(s),r=(null!==(i=a.digg_infos)&&void 0!==i?i:[]).map((({simple_user:e})=>(0,j.bg)(e)));(0,f.unstable_batchedUpdates)((()=>{(0,k.Gp)().multiSetUser(r),this.setDiggList(r.map((({uniqueId:e})=>e))),this.setDiggListLoading(!1)}))}))},setNoticeFollowRequest(e){t(T,(t=>Object.assign(Object.assign({},t),{followRequest:e})))},setNoticeFollowRequestLoading(e){t(T,(t=>Object.assign(Object.assign({},t),{followRequest:Object.assign(Object.assign({},t.followRequest),{loading:e})})))},fetchNoticeFollowRequest({uid:t,refresh:i}){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{followRequest:s}=e(P),a={user_id:t,count:20,max_time:i?0:s.min_time,aid:1988};this.setNoticeFollowRequestLoading(!0);try{const e=yield function(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return C.h.get("/api/user/following/request/list/",{query:e,baseUrlType:2})}))}(a);if((0,N.G)(e.status_code,[0]),0===e.status_code){const t=(null!==(n=e.request_users)&&void 0!==n?n:[]).map((e=>(0,j.bg)(e))),o=t.map((({uniqueId:e})=>e));(0,f.unstable_batchedUpdates)((()=>{(0,k.Gp)().multiSetUser(t),this.setNoticeFollowRequest({has_more:e.has_more,loading:!1,min_time:e.min_time,total:e.total,users:i?o:s.users.concat(o),from:"fetchNoticeFollowRequest"})}))}}catch(e){this.setNoticeFollowRequestLoading(!1)}}))},setNoticeFollowRequestReply(i){const{followRequest:o}=e(P),n=o.users.indexOf(i);n>=0&&t(T,(e=>{let t=e.followRequest.total;return"string"==typeof t?t=t.replace(/(.+?)(\d0*$)/,((e,t,i)=>t+String(Number(i)-1))):t-=1,Object.assign(Object.assign({},e),{followRequest:Object.assign(Object.assign({},e.followRequest),{users:e.followRequest.users.filter(((e,t)=>t!==n)),total:t})})}))},postFollowReply(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{approveOrReject:t,uniqueId:i,uid:n=""}=e;M||(M=w.b.getInstance()),M.handleFollowRequestAction({action:0===t?"accept":"delete",to_user_id:n});const s=0===t?function(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return C.h.post("/api/commit/follow/request/approve/",{query:{from_user_id:e,from:33},headers:{[q.nk]:C.h.csrfToken}})}))}(n):function(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return C.h.post("/api/commit/follow/request/reject/",{query:{from_user_id:e,from:33},headers:{[q.nk]:C.h.csrfToken}})}))}(n);yield s,this.setNoticeFollowRequestReply(i)}))},getNoticeUsers:e=>e.reduce(((e,t)=>{var i,o,n,s;return O.BS.isFollowNotice(t)&&e.push((0,j.bg)(t.follow.from_user)),O.BS.isFollowApprovalNotice(t)&&e.push((0,j.bg)(t.follow_request_approve.from_user)),O.BS.isLikeNotice(t)&&(null===(i=t.digg.from_user)||void 0===i||i.forEach((t=>e.push((0,j.bg)(t))))),O.BS.isCommentNotice(t)&&e.push((0,j.bg)(t.comment.comment.user)),O.BS.isDuetNotice(t)&&e.push((0,j.bg)(t.duet.aweme.author)),O.BS.isMentionNotice(t)&&t.at.user_info&&e.push((0,j.bg)(t.at.user_info)),O.BS.isRepostInboxNotice(t)&&(null===(s=null===(n=null===(o=t.template_notice.notice)||void 0===o?void 0:o.title)||void 0===n?void 0:n.from_users)||void 0===s||s.forEach((t=>e.push((0,j.bg)(Object.assign({short_id:"",gender:0,birthday:""},t)))))),e}),[])})));var $=i(64162),H=i(4126),V=i(93995),z=i(23999),W=i(46657),J=i(26324),Z=i(95719),X=i(8536),K=i(24451),Q=i(72916),Y=i(74690),ee=i(80339),te=i(35572),ie=i(8453),oe=i(55322),ne=i(55306),se=i(7672),ae=i(55099);let re=class{constructor(e){this.fetch=e}getNoticeGroupData(e){return this.fetch.get("/api/notice/multi/",{query:e,baseUrlType:2})}getSystemNoticeGroupData(e){return this.fetch.get("/api/inbox/notice_list/",{query:e,baseUrlType:2})}getNoticeDiggList(e){return this.fetch.get("/api/notice/digg/list/",{query:e,baseUrlType:2})}getNoticeFollowRequestList(e){return this.fetch.get("/api/user/following/request/list/",{query:e,baseUrlType:2})}postFollowReplyApprove(e){return this.fetch.post("/api/commit/follow/request/approve/",{query:{from_user_id:e,from:33},headers:{[q.nk]:this.fetch.csrfToken}})}postFollowReplyReject(e){return this.fetch.post("/api/commit/follow/request/reject/",{query:{from_user_id:e,from:33},headers:{[q.nk]:this.fetch.csrfToken}})}};re=(0,o.__decorate)([(0,se._)(),(0,o.__metadata)("design:paramtypes",[ae.p])],re);let le=class extends $.E{constructor(e,t,i){super(),this.report=e,this.service=t,this.user=i,this.defaultNoticeList={has_more:1,max_time:0,min_time:0,notice_list:[],loading:!1},this.defaultFollowRequest={has_more:!1,min_time:0,total:0,users:[],loading:!1},this.defaultState={diggList:{users:[],loading:!1,has_more:1,max_cursor:0,min_cursor:0},inboxTabShowing:!1,activeGroup:500,activeSystemNoticeGroup:null,noticeList:this.defaultNoticeList,followRequest:this.defaultFollowRequest,latestSystemNotice:null}}setInboxTabShowing(e,t){e.inboxTabShowing=t}setActiveGroup(e,t){e.activeGroup=t}setActiveSystemNoticeGroup(e,t){e.activeSystemNoticeGroup=t}setNoticeList(e,t){e.noticeList=t}setNoticeListLoading(e,t){e.noticeList.loading=t}setLatestSystemNotice(e,t){e.latestSystemNotice=t}changeActiveGroup(e){return e.pipe((0,Z.M)((({group:e})=>{this.report.handleChangeTab({to_tab_name:h.zv[e]})})),(0,X.Z)((({group:e})=>(0,z.of)(this.getActions().setActiveGroup(e),this.getActions().setNoticeList(this.defaultNoticeList),this.getActions().fetchNoticeData(),500===e?this.getActions().fetchLatestSystemNotice():this.noop()))))}changeActiveSystemNoticeGroup(e){return e.pipe((0,Z.M)((e=>{this.report.handleChangeSystemNotificationTab({to_tab_name:h.Nr[e]})})),(0,X.Z)((e=>(0,z.of)(this.getActions().setActiveSystemNoticeGroup(e),this.getActions().setNoticeList(this.defaultNoticeList),this.getActions().fetchSystemNoticeData()))))}fetchNoticeData(e){return e.pipe((0,K.E)(this.state$),(0,Q.n)((([e,{activeGroup:t,noticeList:i}])=>{if(i.loading||!i.has_more)return W.w;const o={count:20,is_mark_read:1,group:t,max_time:i.max_time,min_time:i.min_time};return this.service.getNoticeGroupData({aid:1988,group_list:JSON.stringify([o])}).pipe((0,Z.M)((e=>{(0,N.G)(e.status_code,[0])})),(0,X.Z)((e=>{var t;if(0===e.status_code){const{notice_lists:o}=e;if(!(null==o?void 0:o.length))return(0,z.of)(this.getActions().setNoticeList({has_more:0,min_time:i.min_time,max_time:i.max_time,notice_list:i.notice_list,loading:!1}));const{has_more:n,max_time:s,min_time:a,notice_list:r=[]}=o[0];return r.forEach((e=>{(0,O.mX)(e)})),(0,z.of)(this.user.getActions().multiSetUser(this.getNoticeUsers(r)),this.getActions().setNoticeList({has_more:n,max_time:s,min_time:a,notice_list:[...null!==(t=i.notice_list)&&void 0!==t?t:[],...r],loading:!1}))}return(0,z.of)(this.noop())})),(0,Y.Z)(this.getActions().setNoticeListLoading(!0)),(0,ee.q)(this.getActions().setNoticeListLoading(!1)),(0,oe.n)({}))})))}fetchSystemNoticeData(e){return e.pipe((0,K.E)(this.state$),(0,Q.n)((([e,{activeSystemNoticeGroup:t,noticeList:i}])=>i.loading||!i.has_more||null==t?W.w:this.service.getSystemNoticeGroupData({aid:1988,group_list:JSON.stringify([{count:20,is_mark_read:1,group:t,max_time:i.max_time,min_time:i.min_time}])}).pipe((0,X.Z)((e=>{var t;if(0!==e.status_code)return(0,z.of)(this.noop());const{notice_lists:o}=e;if(!(null==o?void 0:o.length))return(0,z.of)(this.getActions().setNoticeList({has_more:0,min_time:i.min_time,max_time:i.max_time,notice_list:i.notice_list,loading:!1}));const{has_more:n,max_time:s,min_time:a,notice_list:r=[]}=o[0];return(0,z.of)(this.getActions().setNoticeList({has_more:n?1:0,max_time:s,min_time:a,notice_list:[...null!==(t=i.notice_list)&&void 0!==t?t:[],...r],loading:!1}))})),(0,Y.Z)(this.getActions().setNoticeListLoading(!0)),(0,ee.q)(this.getActions().setNoticeListLoading(!1)),(0,oe.n)({})))))}fetchLatestSystemNotice(e){return e.pipe((0,Q.n)((e=>this.service.getSystemNoticeGroupData({aid:1988,group_list:JSON.stringify([{count:1,is_mark_read:0,group:661,max_time:0,min_time:0}])}).pipe((0,X.Z)((e=>{var t,i;if(0!==e.status_code)return(0,z.of)(this.noop());const{notice_lists:o}=e;return(null==o?void 0:o.length)?(0,z.of)(this.getActions().setLatestSystemNotice(null!==(i=null===(t=o[0].notice_list)||void 0===t?void 0:t[0])&&void 0!==i?i:null)):(0,z.of)(this.getActions().setLatestSystemNotice(null))}))))))}setDiggList(e,t){e.diggList.users=t}setDiggListLoading(e,t){e.diggList.loading=t}fetchDiggListData(e){return e.pipe((0,K.E)(this.state$),(0,te.p)((([{ref_id:e},{diggList:t}])=>{if(t.loading||!t.has_more)return W.w;const i={count:20,max_cursor:t.max_cursor,min_cursor:t.min_cursor,digg_type:1,ref_id:e,aid:1988};return this.service.getNoticeDiggList(i).pipe((0,X.Z)((e=>{var t;const i=(null!==(t=e.digg_infos)&&void 0!==t?t:[]).map((({simple_user:e})=>(0,j.bg)(e)));return(0,z.of)(this.user.getActions().multiSetUser(i),this.getActions().setDiggList(i.map((({uniqueId:e})=>e))))})),(0,Y.Z)(this.getActions().setDiggListLoading(!0)),(0,ee.q)(this.getActions().setDiggListLoading(!1)))})))}setNoticeFollowRequest(e,t){e.followRequest=t}setNoticeFollowRequestLoading(e,t){e.followRequest.loading=t}fetchNoticeFollowRequest(e){return e.pipe((0,K.E)(this.state$),(0,X.Z)((([{uid:e,refresh:t},{followRequest:i}])=>{const o={user_id:e,count:20,max_time:t?0:i.min_time,aid:1988};return this.service.getNoticeFollowRequestList(o).pipe((0,Z.M)((e=>{(0,N.G)(e.status_code,[0])})),(0,X.Z)((e=>{var o;if(0===e.status_code){const n=(null!==(o=e.request_users)&&void 0!==o?o:[]).map((e=>(0,j.bg)(e))),s=n.map((({uniqueId:e})=>e));return(0,z.of)(this.user.getActions().multiSetUser(n),this.getActions().setNoticeFollowRequest({has_more:e.has_more,loading:!1,min_time:e.min_time,total:e.total,users:t?s:i.users.concat(s),from:"fetchNoticeFollowRequest"}))}return(0,z.of)(this.noop())})),(0,Y.Z)(this.getActions().setNoticeFollowRequestLoading(!0)),(0,ee.q)(this.getActions().setNoticeFollowRequestLoading(!1)),(0,oe.n)({}))})))}setNoticeFollowRequestReply(e,t){const i=e.followRequest.users.indexOf(t);if(i>=0){e.followRequest.users.splice(i,1);const{total:t}=e.followRequest;e.followRequest.total="string"==typeof t?t.replace(/(.+?)(\d0*$)/,((e,t,i)=>t+String(Number(i)-1))):t-1}}postFollowReply(e){return e.pipe((0,Z.M)((({approveOrReject:e,uid:t=""})=>{this.report.handleFollowRequestAction({action:0===e?"accept":"delete",to_user_id:t})})),(0,X.Z)((({approveOrReject:e,uniqueId:t,uid:i=""})=>(0===e?this.service.postFollowReplyApprove(i):this.service.postFollowReplyReject(i)).pipe((0,ie.u)(this.getActions().setNoticeFollowRequestReply(t))))))}getNoticeUsers(e){return e.reduce(((e,t)=>{var i,o,n,s;return O.BS.isFollowNotice(t)&&e.push((0,j.bg)(t.follow.from_user)),O.BS.isLikeNotice(t)&&(null===(i=t.digg.from_user)||void 0===i||i.forEach((t=>e.push((0,j.bg)(t))))),O.BS.isCommentNotice(t)&&e.push((0,j.bg)(t.comment.comment.user)),O.BS.isDuetNotice(t)&&e.push((0,j.bg)(t.duet.aweme.author)),O.BS.isMentionNotice(t)&&t.at.user_info&&e.push((0,j.bg)(t.at.user_info)),O.BS.isRepostInboxNotice(t)&&(null===(s=null===(n=null===(o=t.template_notice.notice)||void 0===o?void 0:o.title)||void 0===n?void 0:n.from_users)||void 0===s||s.forEach((t=>e.push((0,j.bg)(Object.assign({short_id:"",gender:0,birthday:""},t)))))),e}),[])}};(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Boolean]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setInboxTabShowing",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Number]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setActiveGroup",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Number]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setActiveSystemNoticeGroup",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Object]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setNoticeList",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Boolean]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setNoticeListLoading",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Object]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setLatestSystemNotice",null),(0,o.__decorate)([(0,H.Mj)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[J.c]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"changeActiveGroup",null),(0,o.__decorate)([(0,H.Mj)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[J.c]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"changeActiveSystemNoticeGroup",null),(0,o.__decorate)([(0,H.Mj)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[J.c]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"fetchNoticeData",null),(0,o.__decorate)([(0,H.Mj)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[J.c]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"fetchSystemNoticeData",null),(0,o.__decorate)([(0,H.Mj)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[J.c]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"fetchLatestSystemNotice",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Array]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setDiggList",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Boolean]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setDiggListLoading",null),(0,o.__decorate)([(0,H.Mj)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[J.c]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"fetchDiggListData",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Object]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setNoticeFollowRequest",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,Boolean]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setNoticeFollowRequestLoading",null),(0,o.__decorate)([(0,H.Mj)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[J.c]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"fetchNoticeFollowRequest",null),(0,o.__decorate)([(0,H.h5)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[Object,String]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"setNoticeFollowRequestReply",null),(0,o.__decorate)([(0,H.Mj)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[J.c]),(0,o.__metadata)("design:returntype",void 0)],le.prototype,"postFollowReply",null),le=(0,o.__decorate)([(0,V.n)("Notice"),(0,o.__metadata)("design:paramtypes",[w.b,re,ne.U])],le);var ce=i(58305);const{useSigiOrJotaiService:ue,useSigiOrJotaiState:de,useSigiOrJotaiDispatchers:me}=function(e,t,i){function o(o,s,a){const r=e(),l=i.useServiceState(o,null!=s?s:m.bN),c=(0,p.P)(t,{selector:o,dependencies:null!=a?a:[]});return(0,n.useMemo)((()=>r?l:c),[r,l,c])}function s(){const o=e(),s=i.useServiceDispatchers(),a=(0,g.w)(t);return(0,n.useMemo)((()=>o?s:a),[o,s,a])}return{useSigiOrJotaiService:function(e,t,i){const a=o(e,t,i),r=s();return(0,n.useMemo)((()=>[a,r]),[a,r])},useSigiOrJotaiState:o,useSigiOrJotaiDispatchers:s}}((()=>(0,_.$4)().isInAppNotificationEnabled),le,{useServiceState:B,useServiceDispatchers:G});function _e(e=1e4){const{layoutType:t}=(0,_.mf)(),i=(0,n.useRef)(null),p=(0,n.useRef)(!1),g=(0,n.useRef)(!0),f=(0,n.useRef)(!0),b=(0,v.JD)((e=>e.showingBrowserMode),m.bN),y=(0,u.Z9)((e=>e.isOpen),m.bN),[{noticeList:w,followRequest:N},x]=U((e=>({noticeList:e.noticeList,followRequest:e.followRequest})),m.bN),k=(0,d.tP)(),{user:j,wid:S=""}=(0,n.useMemo)(c.x,[]),I=(0,n.useMemo)((()=>{var e;return{uid:null!==(e=null==j?void 0:j.uid)&&void 0!==e?e:"",wid:S,refresh:!0}}),[null==j?void 0:j.uid,S]),C=(0,n.useCallback)((e=>{"type"in e&&x.markAsRead(e)}),[x]),q=(0,s.h)({layoutType:t,onInteract:C}),L=()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!b&&!y&&g.current)try{yield Promise.all([x.fetchNoticeData({fetchLatest:!0,markAsRead:!1}),x.fetchNoticeFollowRequest(I)]),p.current=!0}catch(e){}i.current=setTimeout(L,e)})),A=(0,n.useRef)(L);A.current=L,(0,n.useEffect)((()=>{var e,t,i,o,n,s,c,u,d,m;if(!p.current||!(null==j?void 0:j.uid)||w.loading||N.loading)return;const _=(0,a.Y)(r.H.InAppNotificationShown),g=(0,a.Y)(r.H.InAppNotificationSettings),v=null!==(e=_.getLocalStorage())&&void 0!==e?e:{},b=null!==(t=v[j.uid])&&void 0!==t?t:{followRequests:[],lastActivityCreatedAt:0},y=new Set(b.followRequests),x=b.lastActivityCreatedAt,S=null!==(o=(null!==(i=g.getLocalStorage())&&void 0!==i?i:{})[j.uid])&&void 0!==o?o:{},I=new Set(Object.keys(S).filter((e=>!1===S[e]))),C=N.users.filter((e=>!y.has(e))),L=[];let A=h.BP;!I.has("followPush")&&C.length>0&&(L.push(Object.assign(Object.assign({},N),{users:C})),A-=1);const O=null!==(s=null===(n=w.notice_list)||void 0===n?void 0:n.filter((e=>Number(e.create_time)>x&&!1===e.has_read)))&&void 0!==s?s:[],F=null!==(c=O.filter((e=>!(l.BS.isCommentNotice(e)&&I.has("commentPush")||(l.BS.isFollowNotice(e)||l.BS.isFollowRequest(e)||l.BS.isFollowApprovalNotice(e))&&I.has("followPush")||l.BS.isLikeNotice(e)&&I.has("diggPush")||l.BS.isMentionNotice(e)&&I.has("mentionPush")||l.BS.isRepostInboxNotice(e)&&I.has("repostPush")))).slice(0,A).reverse())&&void 0!==c?c:[];[...L,...F].forEach((e=>q.show({notification:e}))),f.current?f.current=!1:O.forEach((e=>k.updateUnreadCount(e.type,"unread"))),_.setLocalStorage(Object.assign(Object.assign({},v),{[j.uid]:{followRequests:N.users,lastActivityCreatedAt:Math.max(Number(null!==(m=null===(d=null===(u=w.notice_list)||void 0===u?void 0:u[0])||void 0===d?void 0:d.create_time)&&void 0!==m?m:0),x)}}))}),[N,N.loading,N.users,k,w.loading,w.notice_list,q,null==j?void 0:j.uid]),(0,n.useEffect)((()=>{(b||y)&&q.dismissAll()}),[y,q,b]),(0,n.useEffect)((()=>(g.current=!document.hidden,(0,ce.Gz)((()=>{g.current=!1}),(()=>{g.current=!0})))),[]),(0,n.useEffect)((()=>(!i.current&&j&&(i.current=setTimeout(A.current,0)),()=>{i.current&&(clearTimeout(i.current),i.current=null)})),[])}},40858:(e,t,i)=>{i.d(t,{BS:()=>I,mX:()=>C,G6:()=>A,fG:()=>q,Bl:()=>F,Eo:()=>O});var o=i(94204),n=i(15328),s=i(90161),a=i(18490),r=i(91446),l=i(78954),c=i(80469),u=i(93823),d=i(77360),m=i(45068),_=i(62015),p=i(45209),g=i(33165),v=i(95649),h=i(6156),f=i(93418),b=i(86107),y=i(50389),w=i(61124),N=i(4474);const x=({src:e})=>{const t=/^https?:\/\/[a-zA-Z0-9-]+-sg/.test(e)?"t.tiktok.com":"m.tiktok.com";return(0,N.stringifyUrl)({url:`https://${t}/node-a/video/playsv`,query:{play_url:e}})};var k=i(88920),j=i(84798);const S=[228,261,302],I={isFollowNotice:e=>33===e.type&&Boolean(e.follow),isFollowApprovalNotice:e=>"type"in e&&23===e.type&&Boolean(e.follow_request_approve),isLikeNotice:e=>41===e.type&&Boolean(e.digg),isCommentNotice:e=>31===e.type&&Boolean(e.comment),isDuetNotice:e=>21===e.type&&Boolean(e.duet),isMentionNotice:e=>45===e.type&&Boolean(e.at),isReportInboxNotice:e=>213===e.type&&Boolean(e.template_notice),isRepostInboxNotice:e=>S.includes(e.type)&&Boolean(e.template_notice)},C=e=>{var t,i,o,n,s,a,r,l,c,u,d,m,_,p,g,v,h,f,b,y;if(I.isLikeNotice(e)){const a=null===(o=null===(i=null===(t=e.digg.aweme)||void 0===t?void 0:t.video)||void 0===i?void 0:i.cover)||void 0===o?void 0:o.url_list;if(0!==(null===(s=null===(n=e.digg.aweme)||void 0===n?void 0:n.status)||void 0===s?void 0:s.private_status)&&a){const e=x({src:a[0]});a[0]=e}}if(I.isCommentNotice(e)){const t=null===(l=null===(r=null===(a=e.comment.aweme)||void 0===a?void 0:a.video)||void 0===r?void 0:r.cover)||void 0===l?void 0:l.url_list;if(0!==(null===(u=null===(c=e.comment.aweme)||void 0===c?void 0:c.status)||void 0===u?void 0:u.private_status)&&t){const e=x({src:t[0]});t[0]=e}}if(I.isDuetNotice(e)){const t=null===(_=null===(m=null===(d=e.duet.aweme)||void 0===d?void 0:d.video)||void 0===m?void 0:m.cover)||void 0===_?void 0:_.url_list;if(0!==(null===(g=null===(p=e.duet.aweme)||void 0===p?void 0:p.status)||void 0===g?void 0:g.private_status)&&t){const e=x({src:t[0]});t[0]=e}}if(I.isMentionNotice(e)){const t=null===(f=null===(h=null===(v=e.at.aweme)||void 0===v?void 0:v.video)||void 0===h?void 0:h.cover)||void 0===f?void 0:f.url_list;if(0!==(null===(y=null===(b=e.at.aweme)||void 0===b?void 0:b.status)||void 0===y?void 0:y.private_status)&&t){const e=x({src:t[0]});t[0]=e}}};function q(e){switch(e){case 661:return o.A;case 47:case 399:return n.A;case 12:return s.A;case 61:return a.A;case 21:return r.A;case 82:return l.A;case 81:return c.A;case 212:return u.A;case 215:return d.A;case 218:return m.A;case 223:return _.A;case 224:return p.A;case 249:return g.A;case 254:return v.A;case 255:return h.A;case 256:return f.A;case 262:return b.A;case 272:return y.A;case 274:return w.A;default:return}}const L={2:47,6:21};function A(e){var t;return null!==(t=L[e])&&void 0!==t?t:e}function O(e){try{return"object"==typeof JSON.parse(e)}catch(e){return!1}}function F(){const{isRepostNoticeEnabled:e}=(0,k.Fl)();return e?j.ri:j.E4}},81125:(e,t,i)=>{i.d(t,{b:()=>d});var o,n=i(58632),s=i(94999),a=i(7672),r=i(71510),l=i.n(r),c=i(93608);const u="homepage_message";let d=o=class{handlePopShow(e){c.f.sendEvent("message_pop_notice_show",e)}handleChangeTab(e){c.f.sendEvent("change_notification_tab",this.getNoticeParams(e))}handleEnterFollow(e){c.f.sendEvent("enter_follow_request",this.getNoticeParams(e))}handleFollowRequestAction(e){c.f.sendEvent("follow_request_action",l()(e,{enter_from:"follow_request_page",previous_page:"homepage_message"}))}handleEnterFold(e){c.f.sendEvent("enter_folded_message",l()(e,{enter_from:u,account_type:"like"}))}handleSystemNotificationShow(){c.f.sendEvent("system_notification_show",this.getNoticeParams({}))}handleSystemNotificationClick(e){c.f.sendEvent("system_notification_click",this.getNoticeParams({enter_from:"system_notification_page",enter_method:e.enter_method}))}handleChangeSystemNotificationTab(e){c.f.sendEvent("change_system_notification_tab",this.getNoticeParams(e))}getNoticeParams(e){return l()(e,{enter_from:u,page_name:u,previous_page:c.f.commonParams.page_name})}};d.getInstance=()=>s.l.getInstance(o),d=o=(0,n.__decorate)([(0,a._)()],d)}}]);